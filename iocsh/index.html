
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="SLAC National Accelerator Laboratory">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.7">
    
    
      
        <title>IOC Shell-Related - whatrecord</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="lightblue" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#ioc-shell-related" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="whatrecord" class="md-header__button md-logo" aria-label="whatrecord" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            whatrecord
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              IOC Shell-Related
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="lightblue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      whatrecord
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../parsers/" class="md-tabs__link">
      Parsers
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../cli/" class="md-tabs__link">
      CLI
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../server_client/" class="md-tabs__link">
      Server / client
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../plugins/" class="md-tabs__link">
      Plugins
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../utilities/" class="md-tabs__link">
      Shared / Utilities
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      IOC Shell-Related
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lcls/" class="md-tabs__link">
      LCLS
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../tests/" class="md-tabs__link">
      Tests
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="whatrecord" class="md-nav__button md-logo" aria-label="whatrecord" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6z"/></svg>

    </a>
    whatrecord
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        whatrecord
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parsers/" class="md-nav__link">
        Parsers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../server_client/" class="md-nav__link">
        Server / client
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Shared / Utilities
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          IOC Shell-Related
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        IOC Shell-Related
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav" aria-label="API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn" class="md-nav__link">
    asyn
  </a>
  
    <nav class="md-nav" aria-label="asyn">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AdsAsynPort" class="md-nav__link">
    AdsAsynPort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynIPPort" class="md-nav__link">
    AsynIPPort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynMotor" class="md-nav__link">
    AsynMotor
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynPort" class="md-nav__link">
    AsynPort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynPortDevice" class="md-nav__link">
    AsynPortDevice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynPortMultiDevice" class="md-nav__link">
    AsynPortMultiDevice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynPortOption" class="md-nav__link">
    AsynPortOption
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynSerialPort" class="md-nav__link">
    AsynSerialPort
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynState" class="md-nav__link">
    AsynState
  </a>
  
    <nav class="md-nav" aria-label="AsynState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.asyn.AsynState-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.iocsh" class="md-nav__link">
    iocsh
  </a>
  
    <nav class="md-nav" aria-label="iocsh">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.iocsh-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.iocsh.parse_iocsh_line" class="md-nav__link">
    parse_iocsh_line()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.motor" class="md-nav__link">
    motor
  </a>
  
    <nav class="md-nav" aria-label="motor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.motor-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.motor.MotorState" class="md-nav__link">
    MotorState
  </a>
  
    <nav class="md-nav" aria-label="MotorState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.motor.MotorState-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell" class="md-nav__link">
    shell
  </a>
  
    <nav class="md-nav" aria-label="shell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.IocLoadFailure" class="md-nav__link">
    IocLoadFailure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.IocLoadResult" class="md-nav__link">
    IocLoadResult
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.LoadedIoc" class="md-nav__link">
    LoadedIoc
  </a>
  
    <nav class="md-nav" aria-label="LoadedIoc">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.LoadedIoc-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.ScriptContainer" class="md-nav__link">
    ScriptContainer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.ShellState" class="md-nav__link">
    ShellState
  </a>
  
    <nav class="md-nav" aria-label="ShellState">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.ShellState-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.ShellState-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.async_load_ioc" class="md-nav__link">
    async_load_ioc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.load_cached_ioc" class="md-nav__link">
    load_cached_ioc()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.shell.load_startup_scripts_with_metadata" class="md-nav__link">
    load_startup_scripts_with_metadata()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lcls/" class="md-nav__link">
        LCLS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="ioc-shell-related">IOC Shell-Related</h1>
<h2 id="api">API</h2>


  <div class="doc doc-object doc-module">



<h3 id="whatrecord.asyn" class="doc doc-heading">
        <code>whatrecord.asyn</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">






<h4 id="whatrecord.asyn-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AdsAsynPort" class="doc doc-heading">
        <code>
whatrecord.asyn.AdsAsynPort            (<a title="whatrecord.asyn.AsynPort" href="#whatrecord.asyn.AsynPort">AsynPort</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AdsAsynPort(context: 'FullLoadContext', name: 'str', options: 'Dict[str, AsynPortOption]' = <factory>, metadata: 'Dict[str, str]' = <factory>, motors: 'Dict[str, AsynMotor]' = <factory>, ipaddr: 'str' = '', amsaddr: 'str' = '', amsport: 'int' = 0, asynParamTableSize: 'int' = 0, priority: 'int' = 0, noAutoConnect: 'int' = 0, defaultSampleTimeMS: 'int' = 0, maxDelayTimeMS: 'int' = 0, adsTimeoutMS: 'int' = 0, defaultTimeSource: 'str' = '')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AdsAsynPort</span><span class="p">(</span><span class="n">AsynPort</span><span class="p">):</span>
    <span class="n">ipaddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">amsaddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">amsport</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">asynParamTableSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">noAutoConnect</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">defaultSampleTimeMS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">maxDelayTimeMS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">adsTimeoutMS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">defaultTimeSource</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="n">AsynPort</span><span class="o">.</span><span class="n">_jinja_format_</span><span class="p">[</span><span class="s2">&quot;console&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    ipaddr: {{ipaddr}}</span>
<span class="s2">    amsaddr: {{amsaddr}}</span>
<span class="s2">    amsport: {{amsport}}</span>
<span class="s2">    asynParamTableSize: {{asynParamTableSize}}</span>
<span class="s2">    priority: {{priority}}</span>
<span class="s2">    noAutoConnect: {{noAutoConnect}}</span>
<span class="s2">    defaultSampleTimeMS: {{defaultSampleTimeMS}}</span>
<span class="s2">    maxDelayTimeMS: {{maxDelayTimeMS}}</span>
<span class="s2">    adsTimeoutMS: {{adsTimeoutMS}}</span>
<span class="s2">    defaultTimeSource: {{defaultTimeSource}}</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynIPPort" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynIPPort            (<a title="whatrecord.asyn.AsynPort" href="#whatrecord.asyn.AsynPort">AsynPort</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynIPPort(context: 'FullLoadContext', name: 'str', options: 'Dict[str, AsynPortOption]' = <factory>, metadata: 'Dict[str, str]' = <factory>, motors: 'Dict[str, AsynMotor]' = <factory>, hostInfo: 'str' = '', priority: 'str' = '', noAutoConnect: 'str' = '', noProcessEos: 'str' = '')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynIPPort</span><span class="p">(</span><span class="n">AsynPort</span><span class="p">):</span>
    <span class="n">hostInfo</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">noAutoConnect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">noProcessEos</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynMotor" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynMotor            (<a title="whatrecord.common.AsynPortBase" href="../utilities/#whatrecord.common.AsynPortBase">AsynPortBase</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynMotor(context: 'FullLoadContext', name: 'str', metadata: 'Dict[str, Union[str, int, float]]' = <factory>, parent: 'Optional[str]' = None)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynMotor</span><span class="p">(</span><span class="n">AsynPortBase</span><span class="p">):</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynPort" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynPort            (<a title="whatrecord.common.AsynPortBase" href="../utilities/#whatrecord.common.AsynPortBase">AsynPortBase</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynPort(context: 'FullLoadContext', name: 'str', options: 'Dict[str, AsynPortOption]' = <factory>, metadata: 'Dict[str, str]' = <factory>, motors: 'Dict[str, AsynMotor]' = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynPort</span><span class="p">(</span><span class="n">AsynPortBase</span><span class="p">):</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynPortOption</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">motors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynMotor</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">{{obj|classname}}:</span>
<span class="s2">    name: {{name}}</span>
<span class="s2">    options: {{options}}</span>
<span class="s2">    metadata: {{metadata}}</span>
<span class="s2">    Defined:</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or ctx in context %}</span>
<span class="s2">        * {{ctx}}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or motor in motors %}</span>
<span class="s2">{</span><span class="si">% s</span><span class="s2">et motor_text = render_object(motor, &quot;console&quot;) %}</span>
<span class="s2">        {{ motor_text | indent(8)}}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>

    <span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynPortDevice" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynPortDevice            (<a title="whatrecord.common.AsynPortBase" href="../utilities/#whatrecord.common.AsynPortBase">AsynPortBase</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynPortDevice(context: 'FullLoadContext', name: 'str' = '', options: 'Dict[str, AsynPortOption]' = <factory>, metadata: 'Dict[str, str]' = <factory>, motors: 'Dict[str, AsynMotor]' = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynPortDevice</span><span class="p">(</span><span class="n">AsynPortBase</span><span class="p">):</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynPortOption</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">motors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynMotor</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynPortMultiDevice" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynPortMultiDevice            (<a title="whatrecord.common.AsynPortBase" href="../utilities/#whatrecord.common.AsynPortBase">AsynPortBase</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynPortMultiDevice(context: 'FullLoadContext', name: 'str', metadata: 'dict' = <factory>, motors: 'Dict[str, AsynMotor]' = <factory>, devices: 'Dict[str, AsynPortDevice]' = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynPortMultiDevice</span><span class="p">(</span><span class="n">AsynPortBase</span><span class="p">):</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">motors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynMotor</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynPortDevice</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynPortOption" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynPortOption        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynPortOption(context: 'FullLoadContext', key: 'str', value: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynPortOption</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">key</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynSerialPort" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynSerialPort            (<a title="whatrecord.asyn.AsynPort" href="#whatrecord.asyn.AsynPort">AsynPort</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>AsynSerialPort(context: 'FullLoadContext', name: 'str', options: 'Dict[str, AsynPortOption]' = <factory>, metadata: 'Dict[str, str]' = <factory>, motors: 'Dict[str, AsynMotor]' = <factory>, ttyName: 'str' = '', priority: 'str' = '', noAutoConnect: 'str' = '', noProcessEos: 'str' = '')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynSerialPort</span><span class="p">(</span><span class="n">AsynPort</span><span class="p">):</span>
    <span class="n">ttyName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">noAutoConnect</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">noProcessEos</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.asyn.AsynState" class="doc doc-heading">
        <code>
whatrecord.asyn.AsynState            (<a title="whatrecord.common.ShellStateHandler" href="../utilities/#whatrecord.common.ShellStateHandler">ShellStateHandler</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Asyn IOC shell state handler / container.</p>
<p>Contains hooks for asyn-related commands and state information.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>ports</code></td>
        <td><code>Dict[str, asyn.AsynPortBase]</code></td>
        <td><p>Asyn ports defined by name.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AsynState</span><span class="p">(</span><span class="n">ShellStateHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asyn IOC shell state handler / container.</span>

<span class="sd">    Contains hooks for asyn-related commands and state information.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ports : Dict[str, asyn.AsynPortBase]</span>
<span class="sd">        Asyn ports defined by name.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metadata_key</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;asyn&quot;</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynPortBase</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_drvAsynSerialPortConfigure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">portName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ttyName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">noAutoConnect</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">noProcessEos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># SLAC-specific, but doesn&#39;t hurt anyone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">portName</span><span class="p">]</span> <span class="o">=</span> <span class="n">AsynSerialPort</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">portName</span><span class="p">,</span>
            <span class="n">ttyName</span><span class="o">=</span><span class="n">ttyName</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span>
            <span class="n">noAutoConnect</span><span class="o">=</span><span class="n">noAutoConnect</span><span class="p">,</span>
            <span class="n">noProcessEos</span><span class="o">=</span><span class="n">noProcessEos</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_drvAsynIPPortConfigure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">portName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">hostInfo</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">noAutoConnect</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">noProcessEos</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># SLAC-specific, but doesn&#39;t hurt anyone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">portName</span><span class="p">]</span> <span class="o">=</span> <span class="n">AsynIPPort</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">portName</span><span class="p">,</span>
            <span class="n">hostInfo</span><span class="o">=</span><span class="n">hostInfo</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span>
            <span class="n">noAutoConnect</span><span class="o">=</span><span class="n">noAutoConnect</span><span class="p">,</span>
            <span class="n">noProcessEos</span><span class="o">=</span><span class="n">noProcessEos</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_asynSetOption</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">addr</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">AsynPortOption</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">AsynPortMultiDevice</span><span class="p">):</span>
            <span class="n">port</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">addr</span><span class="p">]</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">port</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>

    <span class="k">def</span> <span class="nf">get_port_from_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AsynPort</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Given a record, return its related asyn port.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">rec_field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RecordField</span><span class="p">]</span>
        <span class="n">rec_field</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;INP&quot;</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OUT&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rec_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec_field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># No PVAccess links just yet</span>
            <span class="k">return</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">rec_field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@asyn&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">asyn_args</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@asyn&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; ()&quot;</span><span class="p">)</span>
                <span class="n">asyn_port</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">asyn_args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">asyn_port</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Failed to parse asyn string&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_port_from_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_port</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">port_</span> <span class="k">for</span> <span class="n">port_</span> <span class="ow">in</span> <span class="p">[</span><span class="n">parent_port</span><span class="p">,</span> <span class="n">port</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">port_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ports&quot;</span><span class="p">:</span> <span class="n">ports</span><span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









<h6 id="whatrecord.asyn.AsynState-methods">Methods</h6>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.asyn.AsynState.annotate_record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">asyn</span><span class="o">.</span><span class="n">AsynState</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Annotate the given record's metadata with state-related information.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_port_from_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">port</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parent_port</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ports</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">port_</span> <span class="k">for</span> <span class="n">port_</span> <span class="ow">in</span> <span class="p">[</span><span class="n">parent_port</span><span class="p">,</span> <span class="n">port</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">port_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;ports&quot;</span><span class="p">:</span> <span class="n">ports</span><span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.asyn.AsynState.get_port_from_record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">asyn</span><span class="o">.</span><span class="n">AsynState</span><span class="o">.</span><span class="n">get_port_from_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AsynPort</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Given a record, return its related asyn port.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/asyn.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_port_from_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inst</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AsynPort</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Given a record, return its related asyn port.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">inst</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">rec_field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RecordField</span><span class="p">]</span>
    <span class="n">rec_field</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;INP&quot;</span><span class="p">,</span> <span class="n">inst</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;OUT&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">rec_field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rec_field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># No PVAccess links just yet</span>
        <span class="k">return</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">rec_field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@asyn&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">asyn_args</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;@asyn&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; ()&quot;</span><span class="p">)</span>
            <span class="n">asyn_port</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">asyn_args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">asyn_port</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Failed to parse asyn string&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>








  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.iocsh" class="doc doc-heading">
        <code>whatrecord.iocsh</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">







<h4 id="whatrecord.iocsh-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.iocsh.parse_iocsh_line" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">iocsh</span><span class="o">.</span><span class="n">parse_iocsh_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">LoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;epics&gt;&#39;</span><span class="p">,</span> <span class="n">macro_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">epicsmacrolib</span><span class="o">.</span><span class="n">macro</span><span class="o">.</span><span class="n">MacroContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">string_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;latin-1&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshResult</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Parse an IOC shell line into an IocshResult.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>line</code></td>
        <td><code>str</code></td>
        <td><p>The line to parse.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>context</code></td>
        <td><code>Optional[whatrecord.common.LoadContext]</code></td>
        <td><p>The load context to populate the result with.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>prompt</code></td>
        <td><code>str</code></td>
        <td><p>Replicating the EPICS source code, specify the state of the prompt
here.  Defaults to "epics&gt;".  If unset as in prior to IOC init,
lines that do not start with "#-" will be eched.</p></td>
        <td><code>&#39;epics&gt;&#39;</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>IocshResult</code></td>
      <td><p>A partially filled IocshResult, ready for interpreting by a
higher-level function.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/iocsh.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parse_iocsh_line</span><span class="p">(</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epics&gt;&quot;</span><span class="p">,</span>
    <span class="n">macro_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">MacroContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">string_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latin-1&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshResult</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse an IOC shell line into an IocshResult.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    line : str</span>
<span class="sd">       The line to parse.</span>

<span class="sd">    context : LoadContext, optional</span>
<span class="sd">       The load context to populate the result with.</span>

<span class="sd">    prompt : str, optional</span>
<span class="sd">       Replicating the EPICS source code, specify the state of the prompt</span>
<span class="sd">       here.  Defaults to &quot;epics&gt;&quot;.  If unset as in prior to IOC init,</span>
<span class="sd">       lines that do not start with &quot;#-&quot; will be eched.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IocshResult</span>
<span class="sd">       A partially filled IocshResult, ready for interpreting by a</span>
<span class="sd">       higher-level function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">IocshResult</span><span class="p">(</span>
       <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
       <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Skip leading whitespace</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#-&quot;</span><span class="p">):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
        <span class="c1"># Echo non-empty lines read from a script.</span>
        <span class="c1"># Comments delineated with &#39;#-&#39; aren&#39;t echoed.</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">if</span> <span class="n">macro_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">macro_context</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># * Skip leading white-space coming from a macro</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>

    <span class="c1"># * Echo non-empty lines read from a script.</span>
    <span class="c1"># * Comments delineated with &#39;#-&#39; aren&#39;t echoed.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#-&#39;</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

    <span class="c1"># * Ignore lines that became a comment or empty after macro expansion</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">split</span> <span class="o">=</span> <span class="n">split_iocsh_line</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">string_encoding</span><span class="o">=</span><span class="n">string_encoding</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">argv</span>

    <span class="c1"># Only set the following if necessary; apischema can skip serialization</span>
    <span class="c1"># otherwise.</span>
    <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">redirects</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">redirects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">split</span><span class="o">.</span><span class="n">redirects</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">split</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">error</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.motor" class="doc doc-heading">
        <code>whatrecord.motor</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">





<h4 id="whatrecord.motor-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.motor.MotorState" class="doc doc-heading">
        <code>
whatrecord.motor.MotorState            (<a title="whatrecord.common.ShellStateHandler" href="../utilities/#whatrecord.common.ShellStateHandler">ShellStateHandler</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Motor record support IOC shell state handler / container.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/motor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MotorState</span><span class="p">(</span><span class="n">ShellStateHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Motor record support IOC shell state handler / container.&quot;&quot;&quot;</span>

    <span class="n">metadata_key</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;motor&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">asyn</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">asyn</span><span class="o">.</span><span class="n">AsynState</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Asyn instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Requires a primary handler&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span><span class="o">.</span><span class="n">asyn</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ports</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AsynPortBase</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Asyn ports.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asyn</span><span class="o">.</span><span class="n">ports</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_A3200AsynConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">task_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">linear_move_commands</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_A3200AsynSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ACRCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">acr_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_AG_CONEXCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">serial_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">controller_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_AG_UCCreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">has_limits</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">forward_amplitude</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">reverse_amplitude</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_AG_UCCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">serial_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ANC150AsynConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ANC150AsynSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maximum_of_controllers</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ANF2CreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">hex_config</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">base_speed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">homing_timeout</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ANF2CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">anf2_in_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">anf2_out_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ANF2StartPoller</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ANG1CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ang1_in_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ang1_out_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_AcsMotionConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">acs_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_polling_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">idle_polling_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_C300CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">c300_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_EMC18011Config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_EMC18011Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ESP300Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ESP300Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_EnsembleAsynConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_EnsembleAsynSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_HXPCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_Hytec8601Configure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">cardnum</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">carrier</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ipslot</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">vector</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">useencoder</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">encoder_ratio0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">encoder_ratio1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">encoder_ratio2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">encoder_ratio3</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_IM483PLConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_IM483PLSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_IM483SMConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_IM483SMSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ImsMDrivePlusCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">io_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">device_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_LinmotCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">linmot_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MAXvConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">configuration_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">absolute_encoder_flags</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">grey_code_flags</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MAXvSetup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">vme_address_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">base_address_on_4_k_0x1000_boundary</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">valid_vectors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interrupt_level_1_6</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">polling_rate_hz</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MCB4BConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MCB4BCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mcb_4_b_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MCB4BSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MCDC2805Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">modules_on_this_serial_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MCDC2805Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MCS2CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mcs2_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MDT695Config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MDT695Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MDriveConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MDriveSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MM3000Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MM300Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MM4000AsynConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MM4000AsynSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MM4000Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MM4000Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MMC200CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mmc_200_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ignore_limit_flag</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MVP2001CreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">encoder_lines_per_rev</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_current_ma</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">limit_polarity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MVP2001CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mvp_2001_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MXmotorSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_motor</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">mx_data_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MicosConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MicosSetup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_motor_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MicroMoConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_MicroMoSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_OmsPC68Config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_OmsPC68Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maximum_of_cards</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate_hz</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PC6KConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PC6KSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PC6KUpLoad</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">controller_card</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">upload_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">program_name_null_immediate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC630Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ch_1_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_2_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_3_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_4_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_5_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_6_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_7_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_8_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ch_9_current_setting</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC630Setup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_groups</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_axes_per_group</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC662Config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC662Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC663Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC663Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC844Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC844Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC848Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC848Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC862Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIC862Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE516Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE516Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE517Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE517Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE710Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE710Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE816Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIE816Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIJEDSConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PIJEDSSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PI_GCS2_CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">stack_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_polling_time_msec</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_polling_time_msec</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PM304Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PM304Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PM500Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PM500Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PMNC87xxConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_PMNC87xxSetup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">max_drivers_per_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SC800Config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address_gpib</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SC800Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maximum_of_cards</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate_hz</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMC100Config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMC100CreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">smc100_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">eg_us_per_step</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMC100Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMCcorvusChangeResolution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">smc_corvus_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis_resolution</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMCcorvusCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">smc_corvus_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMChydraChangeResolution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">smc_hydra_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis_resolution</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SMChydraCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">smc_hydra_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SPiiPlusConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">command_mode_bu_ffer_co_nnect_di_rect</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SPiiPlusSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ScriptAxisConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ScriptControllerConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">control_script</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_ScriptMotorReload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SmartMotorConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SmartMotorSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SoloistConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">asyn_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">asyn_address</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_SoloistSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSAuxConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">polling_period</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_being_configured</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSConfigAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">axis_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">steps_per_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">no_disabled_error</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSCreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">axis_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">steps_per_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ip_port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">enable_set_position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">set_position_settling_time_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSCreateProfile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">max_points</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ftp_username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ftp_password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSDisableAutoEnable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSDisablePoll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_disable_poll_value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSEnableMoveToHome</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">card_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSEnableMovingMode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSEnableSetPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_position_flag</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSGathering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interelement_period</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSInterpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSNoDisableError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSSetPosSleepTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">set_position_sleep_time</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_XPSSetup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_xps_controllers</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_asynMotorEnableMoveToHome</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_listMovingMotors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_moving_motors</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_motorSimConfigAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">post_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">high_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">low_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">home_position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start_posn</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_motorSimCreate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">card</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">signal</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">high_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">low_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">home_position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_cards</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">num_signals</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">start_posn</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_motorSimCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">stack_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_motorUtilInit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ioc_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_nf874xCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nf874x_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_oms58Setup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_card</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">addrs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">int_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">scan_rate</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_omsMAXnetConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">asyn_motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_serial_tcp_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_omsMAXvConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number_of_card</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_omsMAXvConfig2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">slot_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">address_type_a16_a24_a32</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">board_address_on_4_k_0x1000_boundary</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interrupt_vector_noninterrupting_0_64_255</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interrupt_level_1_6</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">task_priority_0_medium</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">stack_size_0_medium</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_omsMAXvEncFuncConfig</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number_of_card</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_omsMAXvEncFuncConfig2</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">slot_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">address_type_a16_a24_a32</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">board_address_on_4_k_0x1000_boundary</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interrupt_vector_noninterrupting_0_64_255</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interrupt_level_1_6</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">asyn_motor_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">task_priority_0_medium</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">stack_size_0_medium</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initstring</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_omsMAXvSetup</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_controller_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">vme_address_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">base_address_on_4_k_0x1000_boundary</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">noninterrupting_0_valid_vectors_64_255</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">interrupt_level_1_6</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_phytronCreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">controller_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">module_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis_index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_phytronCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">phytron_axis_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">moving_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">idle_poll_period_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">timeout_ms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_printChIDlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_motor_util_chid_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_setIdlePollPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_setMovingPollPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_smarActMCSCreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number_int</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">channel_int</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_smarActMCSCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">i_o_port_name_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes_int</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_s_double</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">idle_poll_period_s_double</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_smarActSCUCreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">controller_port_name_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_number_int</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">channel_int</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_smarActSCUCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">i_o_port_name_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">number_of_axes_int</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">moving_poll_period_s_double</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">idle_poll_period_s_double</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_tclcall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tcl_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function_args</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_xps_gathering</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element_period_10_4</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span><span class="p">(</span><span class="n">stub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_EthercatMCCreateAxis</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">motor_port</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_num</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">amplifier_flags</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">axis_config</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_adsAsynPortDriverConfigure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">portName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">ipaddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">amsaddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">amsport</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">asynParamTableSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">noAutoConnect</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">defaultSampleTimeMS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">maxDelayTimeMS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">adsTimeoutMS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">defaultTimeSource</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># SLAC-specific, but doesn&#39;t hurt anyone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">portName</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyn</span><span class="o">.</span><span class="n">AdsAsynPort</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">portName</span><span class="p">,</span>
            <span class="n">ipaddr</span><span class="o">=</span><span class="n">ipaddr</span><span class="p">,</span>
            <span class="n">amsaddr</span><span class="o">=</span><span class="n">amsaddr</span><span class="p">,</span>
            <span class="n">amsport</span><span class="o">=</span><span class="n">amsport</span><span class="p">,</span>
            <span class="n">asynParamTableSize</span><span class="o">=</span><span class="n">asynParamTableSize</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="n">priority</span><span class="p">,</span>
            <span class="n">noAutoConnect</span><span class="o">=</span><span class="n">noAutoConnect</span><span class="p">,</span>
            <span class="n">defaultSampleTimeMS</span><span class="o">=</span><span class="n">defaultSampleTimeMS</span><span class="p">,</span>
            <span class="n">maxDelayTimeMS</span><span class="o">=</span><span class="n">maxDelayTimeMS</span><span class="p">,</span>
            <span class="n">adsTimeoutMS</span><span class="o">=</span><span class="n">adsTimeoutMS</span><span class="p">,</span>
            <span class="n">defaultTimeSource</span><span class="o">=</span><span class="n">defaultTimeSource</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_drvAsynMotorConfigure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">port_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">driver_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">card_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">num_axes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">port_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyn</span><span class="o">.</span><span class="n">AsynMotor</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">port_name</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">num_axes</span><span class="o">=</span><span class="n">num_axes</span><span class="p">,</span>
                <span class="n">card_num</span><span class="o">=</span><span class="n">card_num</span><span class="p">,</span>
                <span class="n">driver_name</span><span class="o">=</span><span class="n">driver_name</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_EthercatMCCreateController</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">motor_port</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">asyn_port</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">num_axes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">move_poll_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="n">idle_poll_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># SLAC-specific</span>
        <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">asyn_port</span><span class="p">]</span>
        <span class="n">motor</span> <span class="o">=</span> <span class="n">asyn</span><span class="o">.</span><span class="n">AsynMotor</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">motor_port</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">asyn_port</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
                <span class="n">num_axes</span><span class="o">=</span><span class="n">num_axes</span><span class="p">,</span>
                <span class="n">move_poll_rate</span><span class="o">=</span><span class="n">move_poll_rate</span><span class="p">,</span>
                <span class="n">idle_poll_rate</span><span class="o">=</span><span class="n">idle_poll_rate</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Tie it to both the original asyn port (as a motor) and also the</span>
        <span class="c1"># top-level asyn ports.</span>
        <span class="n">port</span><span class="o">.</span><span class="n">motors</span><span class="p">[</span><span class="n">motor_port</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ports</span><span class="p">[</span><span class="n">motor_port</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="whatrecord.motor.MotorState-attributes">Attributes</h6>

  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.motor.MotorState.asyn" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">MotorState</span><span class="o">.</span><span class="n">asyn</span><span class="p">:</span> <span class="n">AsynState</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Asyn instance.</p>
    </div>

  </div>




  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.motor.MotorState.ports" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">motor</span><span class="o">.</span><span class="n">MotorState</span><span class="o">.</span><span class="n">ports</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">AsynPortBase</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Asyn ports.</p>
    </div>

  </div>


































































































































































  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.shell" class="doc doc-heading">
        <code>whatrecord.shell</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">






<h4 id="whatrecord.shell-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.shell.IocLoadFailure" class="doc doc-heading">
        <code>
whatrecord.shell.IocLoadFailure        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocLoadFailure(ex_class: 'str', ex_message: 'str', traceback: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocLoadFailure</span><span class="p">:</span>
    <span class="n">ex_class</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ex_message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">traceback</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.shell.IocLoadResult" class="doc doc-heading">
        <code>
whatrecord.shell.IocLoadResult        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocLoadResult(identifier: 'Union[int, str]', load_time: 'float', cache_hit: 'bool', result: 'Union[IocLoadFailure, str]')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocLoadResult</span><span class="p">:</span>
    <span class="n">identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
    <span class="n">load_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cache_hit</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">IocLoadFailure</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.shell.LoadedIoc" class="doc doc-heading">
        <code>
whatrecord.shell.LoadedIoc        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>LoadedIoc(name: 'str', path: 'pathlib.Path', metadata: 'IocMetadata', shell_state: 'ShellState', script: 'IocshScript', load_failure: 'bool' = False, pv_relations: 'PVRelations' = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LoadedIoc</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">path</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">IocMetadata</span>
    <span class="n">shell_state</span><span class="p">:</span> <span class="n">ShellState</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">IocshScript</span>
    <span class="n">load_failure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pv_relations</span><span class="p">:</span> <span class="n">PVRelations</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {{ render_object(script, &quot;file&quot;) }}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {{ obj | classname }}:</span>
<span class="sd">            path: {{ path }}</span>
<span class="sd">            metadata: {% set metadata = render_object(metadata, &quot;console&quot;) %}</span>
<span class="sd">            {{ metadata | indent(4) }}</span>
<span class="sd">            shell_state: {% set shell_state = render_object(shell_state, &quot;console&quot;) %}</span>
<span class="sd">            {{ shell_state | indent(4) }}</span>
<span class="sd">            script:</span>
<span class="sd">            {% set script = render_object(script, &quot;console&quot;) %}</span>
<span class="sd">                {{ script | indent(4) }}</span>
<span class="sd">            load_failure: {{ load_failure }}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="s2">&quot;console-verbose&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {{ obj | classname }}:</span>
<span class="sd">            path: {{ path }}</span>
<span class="sd">            metadata: {% set metadata = render_object(metadata, &quot;console-verbose&quot;) %}</span>
<span class="sd">            {{ metadata | indent(4) }}</span>
<span class="sd">            shell_state: {% set shell_state = render_object(shell_state, &quot;console-verbose&quot;) %}</span>
<span class="sd">            {{ shell_state | indent(4) }}</span>
<span class="sd">            script:</span>
<span class="sd">            {% set script = render_object(script, &quot;console-verbose&quot;) %}</span>
<span class="sd">            {{ script | indent(4) }}</span>
<span class="sd">            load_failure: {{ load_failure }}</span>
<span class="sd">            pv_relations: {{ pv_relations }}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_json_from_cache</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load the serialized JSON from the cache for the given IOC.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        md : IocMetadata</span>
<span class="sd">            The metadata that identifies the IOC.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict or None</span>
<span class="sd">            The cached JSON, if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">ioc_cache_filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="c1"># Truncated output file, perhaps</span>
            <span class="o">...</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_cache</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoadedIoc</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If available, load the cached data about the provided IOC.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        md : IocMetadata</span>
<span class="sd">            The metadata that identifies the IOC.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        LoadedIoc or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_json_from_cache</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">json_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Save this instance to the application cache.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">ioc_cache_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_errored_load</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">load_failure</span><span class="p">:</span> <span class="n">IocLoadFailure</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadedIoc</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a LoadedIoc from a failed load, as indicated by IocLoadFailure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        md : IocMetadata</span>
<span class="sd">            The metadata that was used to load the IOC.</span>
<span class="sd">        load_failure : IocLoadFailure</span>
<span class="sd">            The load failure information.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        LoadedIoc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exception_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">load_failure</span><span class="o">.</span><span class="n">ex_class</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">load_failure</span><span class="o">.</span><span class="n">ex_message</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">error_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">exception_line</span><span class="p">]</span> <span class="o">+</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">traceback</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">script</span> <span class="o">=</span> <span class="n">IocshScript</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">),</span>
            <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
                <span class="n">IocshResult</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),))</span>
                <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">error_lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">ex_class</span>
        <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;exception_message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">ex_message</span>
        <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;traceback&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">traceback</span>
        <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;load_failure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
            <span class="n">shell_state</span><span class="o">=</span><span class="n">ShellState</span><span class="p">(),</span>
            <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
            <span class="n">load_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_metadata</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadedIoc</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a LoadedIoc by interpreting the startup script.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        md : IocMetadata</span>
<span class="sd">            The metadata from the IOC.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        LoadedIoc</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">ShellState</span><span class="p">(</span><span class="n">ioc_info</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">startup_directory</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="o">**</span><span class="n">md</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
        <span class="n">sh</span><span class="o">.</span><span class="n">standin_directories</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">standin_directories</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="c1"># It&#39;s not enough to chdir, as we can rely on the environment variable</span>
        <span class="c1"># in shell scripts:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PWD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">startup_directory</span><span class="p">)</span>

        <span class="n">script</span> <span class="o">=</span> <span class="n">IocshScript</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">sh</span><span class="o">=</span><span class="n">sh</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">path</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
            <span class="n">shell_state</span><span class="o">=</span><span class="n">sh</span><span class="p">,</span>
            <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
            <span class="n">pv_relations</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">build_database_relations</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">database</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">whatrec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_pva</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WhatRecord</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get record information, optionally including PVAccess results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rec : str</span>
<span class="sd">            The record name (excluding any field).</span>
<span class="sd">        field : Optional[str], optional</span>
<span class="sd">            An optional field name, such as ``DESC``.  Currently unused.</span>
<span class="sd">        include_pva : bool, optional</span>
<span class="sd">            Include PVAccess results in the query.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Optional[WhatRecord]</span>
<span class="sd">            Information about the provided record, if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell_state</span>
        <span class="n">v3_inst</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rec</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pva_inst</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pva_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">include_pva</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v3_inst</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pva_inst</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">what</span> <span class="o">=</span> <span class="n">WhatRecord</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span>
            <span class="n">ioc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">pva_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">v3_inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="o">.</span><span class="n">database_definition</span><span class="p">:</span>
                <span class="n">defn</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defn</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">record_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">v3_inst</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="n">what</span><span class="o">.</span><span class="n">menus</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">menus</span>
                <span class="c1"># but what about device types and such?</span>

            <span class="n">state</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="n">v3_inst</span><span class="p">)</span>
            <span class="n">what</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">RecordDefinitionAndInstance</span><span class="p">(</span><span class="n">defn</span><span class="p">,</span> <span class="n">v3_inst</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pva_inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">what</span><span class="o">.</span><span class="n">pva_group</span> <span class="o">=</span> <span class="n">pva_inst</span>

        <span class="k">return</span> <span class="n">what</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














<h6 id="whatrecord.shell.LoadedIoc-methods">Methods</h6>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.LoadedIoc.from_cache" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">LoadedIoc</span><span class="o">.</span><span class="n">from_cache</span><span class="p">(</span><span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoadedIoc</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>If available, load the cached data about the provided IOC.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>md</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>The metadata that identifies the IOC.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_cache</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoadedIoc</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If available, load the cached data about the provided IOC.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    md : IocMetadata</span>
<span class="sd">        The metadata that identifies the IOC.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    LoadedIoc or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">json_dict</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_json_from_cache</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">json_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_dict</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.LoadedIoc.from_errored_load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">LoadedIoc</span><span class="o">.</span><span class="n">from_errored_load</span><span class="p">(</span><span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">load_failure</span><span class="p">:</span> <span class="n">IocLoadFailure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadedIoc</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Create a LoadedIoc from a failed load, as indicated by IocLoadFailure.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>md</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>The metadata that was used to load the IOC.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>load_failure</code></td>
        <td><code>IocLoadFailure</code></td>
        <td><p>The load failure information.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_errored_load</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">load_failure</span><span class="p">:</span> <span class="n">IocLoadFailure</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadedIoc</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a LoadedIoc from a failed load, as indicated by IocLoadFailure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    md : IocMetadata</span>
<span class="sd">        The metadata that was used to load the IOC.</span>
<span class="sd">    load_failure : IocLoadFailure</span>
<span class="sd">        The load failure information.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    LoadedIoc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">exception_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">load_failure</span><span class="o">.</span><span class="n">ex_class</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">load_failure</span><span class="o">.</span><span class="n">ex_message</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">error_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">exception_line</span><span class="p">]</span> <span class="o">+</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">traceback</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">IocshScript</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">),</span>
        <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
            <span class="n">IocshResult</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">lineno</span><span class="p">),))</span>
            <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">error_lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;exception_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">ex_class</span>
    <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;exception_message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">ex_message</span>
    <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;traceback&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">load_failure</span><span class="o">.</span><span class="n">traceback</span>
    <span class="n">md</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;load_failure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
        <span class="n">shell_state</span><span class="o">=</span><span class="n">ShellState</span><span class="p">(),</span>
        <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
        <span class="n">load_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.LoadedIoc.from_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">LoadedIoc</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadedIoc</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Generate a LoadedIoc by interpreting the startup script.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>md</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>The metadata from the IOC.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_metadata</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadedIoc</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a LoadedIoc by interpreting the startup script.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    md : IocMetadata</span>
<span class="sd">        The metadata from the IOC.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    LoadedIoc</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">ShellState</span><span class="p">(</span><span class="n">ioc_info</span><span class="o">=</span><span class="n">md</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">startup_directory</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="o">**</span><span class="n">md</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
    <span class="n">sh</span><span class="o">.</span><span class="n">standin_directories</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">standin_directories</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="c1"># It&#39;s not enough to chdir, as we can rely on the environment variable</span>
    <span class="c1"># in shell scripts:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PWD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">startup_directory</span><span class="p">)</span>

    <span class="n">script</span> <span class="o">=</span> <span class="n">IocshScript</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">sh</span><span class="o">=</span><span class="n">sh</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
        <span class="n">shell_state</span><span class="o">=</span><span class="n">sh</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
        <span class="n">pv_relations</span><span class="o">=</span><span class="n">graph</span><span class="o">.</span><span class="n">build_database_relations</span><span class="p">(</span><span class="n">sh</span><span class="o">.</span><span class="n">database</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.LoadedIoc.save_to_cache" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">LoadedIoc</span><span class="o">.</span><span class="n">save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Save this instance to the application cache.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Save this instance to the application cache.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">ioc_cache_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.LoadedIoc.whatrec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">LoadedIoc</span><span class="o">.</span><span class="n">whatrec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_pva</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WhatRecord</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Get record information, optionally including PVAccess results.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>rec</code></td>
        <td><code>str</code></td>
        <td><p>The record name (excluding any field).</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>field</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>An optional field name, such as <code>DESC</code>.  Currently unused.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>include_pva</code></td>
        <td><code>bool</code></td>
        <td><p>Include PVAccess results in the query.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[WhatRecord]</code></td>
      <td><p>Information about the provided record, if available.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">whatrec</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">rec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">include_pva</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WhatRecord</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get record information, optionally including PVAccess results.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    rec : str</span>
<span class="sd">        The record name (excluding any field).</span>
<span class="sd">    field : Optional[str], optional</span>
<span class="sd">        An optional field name, such as ``DESC``.  Currently unused.</span>
<span class="sd">    include_pva : bool, optional</span>
<span class="sd">        Include PVAccess results in the query.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Optional[WhatRecord]</span>
<span class="sd">        Information about the provided record, if available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell_state</span>
    <span class="n">v3_inst</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">rec</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">pva_inst</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pva_database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">include_pva</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v3_inst</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pva_inst</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">what</span> <span class="o">=</span> <span class="n">WhatRecord</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">rec</span><span class="p">,</span>
        <span class="n">ioc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">pva_group</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">v3_inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="o">.</span><span class="n">database_definition</span><span class="p">:</span>
            <span class="n">defn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">defn</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">record_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">v3_inst</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">what</span><span class="o">.</span><span class="n">menus</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">menus</span>
            <span class="c1"># but what about device types and such?</span>

        <span class="n">state</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="n">v3_inst</span><span class="p">)</span>
        <span class="n">what</span><span class="o">.</span><span class="n">record</span> <span class="o">=</span> <span class="n">RecordDefinitionAndInstance</span><span class="p">(</span><span class="n">defn</span><span class="p">,</span> <span class="n">v3_inst</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pva_inst</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">what</span><span class="o">.</span><span class="n">pva_group</span> <span class="o">=</span> <span class="n">pva_inst</span>

    <span class="k">return</span> <span class="n">what</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.shell.ScriptContainer" class="doc doc-heading">
        <code>
whatrecord.shell.ScriptContainer        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Aggregate container for any number of LoadedIoc instances.</p>
<p>Combines databases, sets of loaded files ease of querying.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ScriptContainer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate container for any number of LoadedIoc instances.</span>

<span class="sd">    Combines databases, sets of loaded files ease of querying.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">pva_database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">scripts</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">LoadedIoc</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">startup_script_to_ioc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1">#: absolute filename path to sha</span>
    <span class="n">loaded_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">pv_relations</span><span class="p">:</span> <span class="n">PVRelations</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_loaded_ioc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loaded</span><span class="p">:</span> <span class="n">LoadedIoc</span><span class="p">):</span>
        <span class="n">ioc_name</span> <span class="o">=</span> <span class="n">loaded</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="p">[</span><span class="n">ioc_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">loaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_script_to_ioc</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">script</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ioc_name</span>

        <span class="c1"># TODO: IOCs will have conflicting definitions of records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">database_definition</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_types</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">record_types</span>
            <span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">combine_relations</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pv_relations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="n">loaded</span><span class="o">.</span><span class="n">pv_relations</span><span class="p">,</span> <span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">record_types</span><span class="p">,</span>
            <span class="n">aliases</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pva_database</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">pva_database</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loaded</span><span class="o">.</span><span class="n">shell_state</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">whatrec</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">field</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">include_pva</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">format_option</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;console&quot;</span><span class="p">,</span>
        <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">WhatRecord</span><span class="p">]:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">FormatContext</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">loaded</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scripts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">info</span><span class="p">:</span> <span class="n">WhatRecord</span> <span class="o">=</span> <span class="n">loaded</span><span class="o">.</span><span class="n">whatrec</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">include_pva</span><span class="o">=</span><span class="n">include_pva</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">info</span><span class="o">.</span><span class="n">ioc</span> <span class="o">=</span> <span class="n">loaded</span><span class="o">.</span><span class="n">metadata</span>
                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="p">[</span><span class="n">info</span><span class="o">.</span><span class="n">record</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">pva_group</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">match</span><span class="p">,</span> <span class="n">format_option</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.shell.ShellState" class="doc doc-heading">
        <code>
whatrecord.shell.ShellState            (<a title="whatrecord.common.ShellStateHandler" href="../utilities/#whatrecord.common.ShellStateHandler">ShellStateHandler</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IOC shell state container.</p>
<p>Contains hooks for commands and state information.</p>
<p>This base state handler should only handle epics base-defined IOC shell
commands, including: paths, variables, database loading, and IOC
initialization.</p>
<p>It is the top-level state container, which sub handlers should rely on for
things like loading files and other core state information.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>prompt</code></td>
        <td><code>str</code></td>
        <td><p>The prompt - PS1 - as in "epics&gt;".</p></td>
      </tr>
      <tr>
        <td><code>variables</code></td>
        <td><code>dict</code></td>
        <td><p>Shell variables (not environment variables).</p></td>
      </tr>
      <tr>
        <td><code>string_encoding</code></td>
        <td><code>str</code></td>
        <td><p>String encoding for byte strings and files.</p></td>
      </tr>
      <tr>
        <td><code>macro_context</code></td>
        <td><code>MacroContext</code></td>
        <td><p>Macro context for commands that are evaluated.</p></td>
      </tr>
      <tr>
        <td><code>standin_directories</code></td>
        <td><code>dict</code></td>
        <td><p>Rewrite hard-coded directory prefixes by setting::</p>
<pre><code>standin_directories = {"/replace_this/": "/with/this"}
</code></pre></td>
      </tr>
      <tr>
        <td><code>loaded_files</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Files loaded, mapped to a hash of their contents.</p></td>
      </tr>
      <tr>
        <td><code>working_directory</code></td>
        <td><code>pathlib.Path</code></td>
        <td><p>Current working directory.</p></td>
      </tr>
      <tr>
        <td><code>database_definition</code></td>
        <td><code>Database</code></td>
        <td><p>Loaded database definition (dbd).</p></td>
      </tr>
      <tr>
        <td><code>database</code></td>
        <td><code>Dict[str, RecordInstance]</code></td>
        <td><p>The IOC database of records.</p></td>
      </tr>
      <tr>
        <td><code>pva_database</code></td>
        <td><code>Dict[str, RecordInstance]</code></td>
        <td><p>The IOC database of PVAccess groups.</p></td>
      </tr>
      <tr>
        <td><code>aliases</code></td>
        <td><code>Dict[str, str]</code></td>
        <td><p>Alias name to record name.</p></td>
      </tr>
      <tr>
        <td><code>load_context</code></td>
        <td><code>List[MutableLoadContext]</code></td>
        <td><p>Current loading context stack (e.g., <code>st.cmd</code> then
<code>common_startup.cmd</code>).  Modified in place as scripts are evaluated.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ShellState</span><span class="p">(</span><span class="n">ShellStateHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    IOC shell state container.</span>

<span class="sd">    Contains hooks for commands and state information.</span>

<span class="sd">    This base state handler should only handle epics base-defined IOC shell</span>
<span class="sd">    commands, including: paths, variables, database loading, and IOC</span>
<span class="sd">    initialization.</span>

<span class="sd">    It is the top-level state container, which sub handlers should rely on for</span>
<span class="sd">    things like loading files and other core state information.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    prompt : str</span>
<span class="sd">        The prompt - PS1 - as in &quot;epics&gt;&quot;.</span>
<span class="sd">    variables : dict</span>
<span class="sd">        Shell variables (not environment variables).</span>
<span class="sd">    string_encoding : str</span>
<span class="sd">        String encoding for byte strings and files.</span>
<span class="sd">    macro_context : MacroContext</span>
<span class="sd">        Macro context for commands that are evaluated.</span>
<span class="sd">    standin_directories : dict</span>
<span class="sd">        Rewrite hard-coded directory prefixes by setting::</span>

<span class="sd">            standin_directories = {&quot;/replace_this/&quot;: &quot;/with/this&quot;}</span>
<span class="sd">    loaded_files : Dict[str, str]</span>
<span class="sd">        Files loaded, mapped to a hash of their contents.</span>
<span class="sd">    working_directory : pathlib.Path</span>
<span class="sd">        Current working directory.</span>
<span class="sd">    database_definition : Database</span>
<span class="sd">        Loaded database definition (dbd).</span>
<span class="sd">    database : Dict[str, RecordInstance]</span>
<span class="sd">        The IOC database of records.</span>
<span class="sd">    pva_database : Dict[str, RecordInstance]</span>
<span class="sd">        The IOC database of PVAccess groups.</span>
<span class="sd">    aliases : Dict[str, str]</span>
<span class="sd">        Alias name to record name.</span>
<span class="sd">    load_context : List[MutableLoadContext]</span>
<span class="sd">        Current loading context stack (e.g., ``st.cmd`` then</span>
<span class="sd">        ``common_startup.cmd``).  Modified in place as scripts are evaluated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;epics&gt;&quot;</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">string_encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;latin-1&quot;</span>
    <span class="n">ioc_initialized</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">working_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">database_definition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Database</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">pva_database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">load_context</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MutableLoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">loaded_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">macro_context</span><span class="p">:</span> <span class="n">MacroContext</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">MacroContext</span><span class="p">)</span>
    <span class="n">ioc_info</span><span class="p">:</span> <span class="n">IocMetadata</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">IocMetadata</span><span class="p">)</span>
    <span class="n">db_add_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">database_grammar_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="c1"># Sub-state handlers:</span>
    <span class="n">access_security</span><span class="p">:</span> <span class="n">AccessSecurityState</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">AccessSecurityState</span><span class="p">)</span>
    <span class="n">asyn</span><span class="p">:</span> <span class="n">AsynState</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">AsynState</span><span class="p">)</span>
    <span class="n">autosave</span><span class="p">:</span> <span class="n">AutosaveState</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">AutosaveState</span><span class="p">)</span>
    <span class="n">motor</span><span class="p">:</span> <span class="n">MotorState</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">MotorState</span><span class="p">)</span>
    <span class="n">streamdevice</span><span class="p">:</span> <span class="n">StreamDeviceState</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">StreamDeviceState</span><span class="p">)</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {{ obj | classname }}:</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="s2">&quot;console-verbose&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {{ obj | classname }}:</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">string_encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">string_encoding</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sub_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ShellStateHandler</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Handlers which contain their own state.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">access_security</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">asyn</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autosave</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">motor</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">streamdevice</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Load a file, record its hash, and return its contents.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">shasum</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">read_text_file_with_hash</span><span class="p">(</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">string_encoding</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">shasum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">shasum</span>
        <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span>

    <span class="k">def</span> <span class="nf">_handle_input_redirect</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">redir</span><span class="p">:</span> <span class="n">IocshRedirect</span><span class="p">,</span>
        <span class="n">shresult</span><span class="p">:</span> <span class="n">IocshResult</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">redir</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">shresult</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">redir</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">yield</span> <span class="n">shresult</span>
            <span class="k">return</span>

        <span class="k">yield</span> <span class="n">shresult</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_script_text</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">filename</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">interpret_shell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpret a single shell script line.&quot;&quot;&quot;</span>
        <span class="n">shresult</span> <span class="o">=</span> <span class="n">parse_iocsh_line</span><span class="p">(</span>
            <span class="n">line</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">macro_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="p">,</span>
            <span class="n">string_encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">string_encoding</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">input_redirects</span> <span class="o">=</span> <span class="p">[</span><span class="n">redir</span> <span class="k">for</span> <span class="n">redir</span> <span class="ow">in</span> <span class="n">shresult</span><span class="o">.</span><span class="n">redirects</span> <span class="k">if</span> <span class="n">redir</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">shresult</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">shresult</span>
        <span class="k">elif</span> <span class="n">input_redirects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_input_redirect</span><span class="p">(</span>
                    <span class="n">input_redirects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">shresult</span><span class="p">,</span>
                    <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
                    <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">shresult</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_command</span><span class="p">(</span><span class="o">*</span><span class="n">shresult</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="c1"># Only set if not-None to speed up serialization</span>
                    <span class="n">shresult</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                    <span class="k">raise</span>
                <span class="n">ex_details</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="n">shresult</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to execute: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">ex_details</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">yield</span> <span class="n">shresult</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shresult</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">IocshCmdArgs</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_line</span><span class="p">(</span>
                    <span class="n">shresult</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Otherwise, nothing to do</span>
            <span class="k">yield</span> <span class="n">shresult</span>

    <span class="k">def</span> <span class="nf">interpret_shell_script</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Load and interpret a shell script named ``filename``.&quot;&quot;&quot;</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_script_text</span><span class="p">(</span>
            <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
            <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">interpret_shell_script_text</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
        <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Interpret a shell script named ``name`` with ``lines`` of text.&quot;&quot;&quot;</span>
        <span class="n">load_ctx</span> <span class="o">=</span> <span class="n">MutableLoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load_ctx</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">load_ctx</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">lineno</span>
                <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_line</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span>
                    <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
                    <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">load_ctx</span><span class="p">)</span>

        <span class="c1"># for rec in list(self.database.values()) + list(self.pva_database.values()):</span>
        <span class="c1">#     try:</span>
        <span class="c1">#         self.annotate_record(rec)</span>
        <span class="c1">#     except Exception:</span>
        <span class="c1">#         logger.exception(&quot;Failed to annotate record: %s&quot;, rec.name)</span>

    <span class="k">def</span> <span class="nf">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a FullLoadContext tuple representing where we are now.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">to_load_context</span><span class="p">()</span> <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle IOC shell &#39;command&#39; with provided arguments.&quot;&quot;&quot;</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unhandled</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fix_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes filename an absolute path with respect to the working directory.</span>

<span class="sd">        Also replaces standin directories, if provided an absolute path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">from_</span><span class="p">,</span> <span class="n">to</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">from_</span><span class="p">):</span>
                    <span class="n">_</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">from_</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">to</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">/</span> <span class="n">filename</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">db_include_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Database include paths (EPICS_DB_INCLUDE_PATH).&quot;&quot;&quot;</span>
        <span class="n">env_paths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paths_from_env_var</span><span class="p">(</span><span class="s2">&quot;EPICS_DB_INCLUDE_PATH&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">env_paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_add_paths</span>
        <span class="k">return</span> <span class="n">env_paths</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_add_paths</span>

    <span class="k">def</span> <span class="nf">paths_from_env_var</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">env_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Paths from an environment variable (or macro).&quot;&quot;&quot;</span>
        <span class="n">env_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_var</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">/</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
            <span class="c1"># TODO: this is actually OS-dependent (: on linux, ; on Windows)</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">env_var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fix_path_with_search_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
        <span class="n">include_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Given a list of paths, find ``filename``.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_paths</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="c1"># Include path unset or even something resembling a nested path</span>
            <span class="c1"># automatically is used as-is</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">include_paths</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>
            <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">option</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">option</span>

        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">filename</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span>

        <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">include_paths</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">filename</span><span class="si">!r}</span><span class="s2"> not found in search path: </span><span class="si">{</span><span class="n">paths</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">unhandled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="o">...</span>
        <span class="c1"># return f&quot;No handler for handle_{command}&quot;</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_iocshRegisterVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Registered variable: </span><span class="si">{</span><span class="n">variable</span><span class="si">!r}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">env_set_EPICS_BASE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c1"># TODO: slac-specific</span>
        <span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
        <span class="n">version_prefixes</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;/reg/g/pcds/epics/base/&quot;</span><span class="p">,</span>
            <span class="s2">&quot;/cds/group/pcds/epics/base/&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">version_prefixes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
                <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">version</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">base_version</span> <span class="o">==</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="n">version</span>
                    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Set base version: </span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found version (</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">) but version already specified:&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">base_version</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_epicsEnvSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">define</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">variable</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
        <span class="n">hook</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;env_set_</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hook</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="n">hook</span><span class="p">):</span>
            <span class="n">hook_result</span> <span class="o">=</span> <span class="n">hook</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hook_result</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;hook&quot;</span><span class="p">:</span> <span class="n">hook_result</span><span class="p">,</span>
                <span class="p">}</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_epicsEnvShow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">get_macros</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_iocshCmd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
        <span class="c1"># TODO: odd return type, used below</span>
        <span class="k">return</span> <span class="n">IocshCmdArgs</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span> <span class="n">command</span><span class="o">=</span><span class="n">command</span><span class="p">)</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_cd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid directory path, ignored&quot;</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
            <span class="n">new_dir</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">/</span> <span class="n">path</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path does not exist: </span><span class="si">{</span><span class="n">new_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">=</span> <span class="n">new_dir</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PWD&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;New working directory: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">}</span>

    <span class="n">handle_chdir</span> <span class="o">=</span> <span class="n">handle_cd</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_iocInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_initialized</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Already initialized&quot;</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
            <span class="n">handler_result</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">pre_ioc_init</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">handler_result</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ioc_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
            <span class="n">handler_result</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">post_ioc_init</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">handler_result</span> <span class="ow">or</span> <span class="p">{})</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_dbLoadDatabase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Database cannot be loaded after iocInit&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="p">:</span>
            <span class="c1"># TODO: technically this is allowed; we&#39;ll need to update</span>
            <span class="c1"># raise RuntimeError(&quot;dbd already loaded&quot;)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;whatrecord: TODO multiple dbLoadDatabase&quot;</span>
            <span class="p">}</span>

        <span class="n">dbd_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path_with_search_list</span><span class="p">(</span><span class="n">dbd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_include_paths</span><span class="p">)</span>
        <span class="n">fn</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">dbd_path</span><span class="p">)</span>
        <span class="n">macro_context</span> <span class="o">=</span> <span class="n">MacroContext</span><span class="p">(</span><span class="n">use_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">macro_context</span><span class="o">.</span><span class="n">define_from_string</span><span class="p">(</span><span class="n">substitutions</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">database_version_spec</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
                <span class="n">contents</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                <span class="n">macro_context</span><span class="o">=</span><span class="n">macro_context</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">lark</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ParseError</span> <span class="k">as</span> <span class="n">original_ex</span><span class="p">:</span>
            <span class="c1"># Our guess about the EPICS version may have been wrong.</span>
            <span class="c1"># Let&#39;s see if the dbd is valid for the other version.</span>
            <span class="n">other_spec</span> <span class="o">=</span> <span class="p">{</span>
                <span class="mi">3</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="mi">4</span><span class="p">:</span> <span class="mi">3</span>
            <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
                    <span class="n">contents</span><span class="p">,</span>
                    <span class="n">version</span><span class="o">=</span><span class="n">other_spec</span><span class="p">,</span>
                    <span class="n">filename</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                    <span class="n">macro_context</span><span class="o">=</span><span class="n">macro_context</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DatabaseLoadFailure</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Database definition file failed to load. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempted to load with grammar version </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and fallback version </span><span class="si">{</span><span class="n">other_spec</span><span class="si">}</span><span class="s2"> unsuccessfully.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span> <span class="nn">original_ex</span>

            <span class="c1"># Our initial guess was wrong... Load further database files with</span>
            <span class="c1"># the adjusted version.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span> <span class="o">=</span> <span class="n">other_spec</span>

        <span class="k">for</span> <span class="n">addpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">addpaths</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">addpath</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>  <span class="c1"># TODO: OS-dependent</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_add_paths</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dbd_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">LoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fn</span><span class="p">),</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;Loaded database&quot;</span><span class="p">,</span>
            <span class="s2">&quot;grammar_version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span><span class="p">,</span>
            <span class="s2">&quot;record_types&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">record_types</span><span class="p">)),</span>
            <span class="s2">&quot;drivers&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">drivers</span><span class="p">)),</span>
            <span class="s2">&quot;functions&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">functions</span><span class="p">)),</span>
            <span class="s2">&quot;breaktables&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="o">.</span><span class="n">breaktables</span><span class="p">)),</span>
        <span class="p">}</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_dbLoadTemplate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path_with_search_list</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_include_paths</span><span class="p">)</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># TODO this should be multiple load calls for the purposes of context</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">LoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s2">&quot;total_records&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;total_groups&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;loaded_files&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="n">template</span> <span class="o">=</span> <span class="n">dbtemplate</span><span class="o">.</span><span class="n">TemplateSubstitution</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">template</span><span class="o">.</span><span class="n">substitutions</span><span class="p">:</span>
            <span class="n">database_contents</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">expand_file</span><span class="p">(</span><span class="n">search_paths</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_include_paths</span><span class="p">)</span>
            <span class="c1"># TODO loading file twice (ensure it gets added to the loaded_files list)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_database</span><span class="p">(</span>
                <span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span>
                <span class="n">contents</span><span class="o">=</span><span class="n">database_contents</span><span class="p">,</span>
                <span class="n">macros</span><span class="o">=</span><span class="n">macros</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">()</span> <span class="o">+</span> <span class="n">sub</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">LoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sub</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="mi">0</span><span class="p">)],</span>
                <span class="s2">&quot;macros&quot;</span><span class="p">:</span> <span class="n">sub</span><span class="o">.</span><span class="n">macros</span><span class="p">,</span>
                <span class="s2">&quot;records&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">records</span><span class="p">),</span>
                <span class="s2">&quot;groups&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">pva_groups</span><span class="p">),</span>
                <span class="s2">&quot;lint&quot;</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">lint</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;total_records&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">records</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;total_groups&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">pva_groups</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;loaded_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_load_database</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">macros</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Database</span><span class="p">:</span>
        <span class="n">macro_context</span> <span class="o">=</span> <span class="n">MacroContext</span><span class="p">(</span><span class="n">use_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">macros</span> <span class="o">=</span> <span class="n">macro_context</span><span class="o">.</span><span class="n">define_from_string</span><span class="p">(</span><span class="n">macros</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
                <span class="n">contents</span><span class="p">,</span>
                <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
                <span class="n">dbd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="p">,</span>
                <span class="n">macro_context</span><span class="o">=</span><span class="n">macro_context</span><span class="p">,</span>
                <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database_grammar_version</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="c1"># TODO move this around</span>
            <span class="k">raise</span> <span class="n">DatabaseLoadFailure</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to load </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">ex</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">context</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">context</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">context</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
                <span class="c1"># entry.owner = self.ioc_info.name ?</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">pva_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pva_database</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pva_database</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">context</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">context</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">context</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
                <span class="c1"># entry.owner = self.ioc_info.name ?</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">addpath</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">addpaths</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">addpath</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>  <span class="c1"># TODO: OS-dependent</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_add_paths</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">db</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">db</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_dbLoadRecords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_definition</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;dbd not yet loaded&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ioc_initialized</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Records cannot be loaded after iocInit&quot;</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path_with_search_list</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_include_paths</span><span class="p">)</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_database</span><span class="p">(</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">contents</span><span class="o">=</span><span class="n">contents</span><span class="p">,</span>
            <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># TODO: add option to annotate all records without requiring</span>
        <span class="c1"># per-record whatrecord queries</span>
        <span class="c1"># if self.annotate_all:</span>
        <span class="c1">#     for record in db.records.values():</span>
        <span class="c1">#         self.annotate_record(record)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">LoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s2">&quot;num_records&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">records</span><span class="p">),</span>
            <span class="s2">&quot;num_pva_groups&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">pva_groups</span><span class="p">),</span>
            <span class="s2">&quot;lint&quot;</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">lint</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Hook to annotate a record after being loaded.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">annotation</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="s2">&quot;Record annotation failed for </span><span class="si">%s</span><span class="s2"> with handler </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">record</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">handler</span><span class="o">.</span><span class="n">metadata_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_dbl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtyp</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="o">...</span>

    <span class="nd">@_handler</span>
    <span class="k">def</span> <span class="nf">handle_NDPvaConfigure</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">portName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queueSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">blockingCallbacks</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">NDArrayPort</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">NDArrayAddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">pvName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">maxBuffers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">maxMemory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">stackSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implicitly creates a PVA group named ``pvName``.&quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;portName&quot;</span><span class="p">:</span> <span class="n">portName</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;queueSize&quot;</span><span class="p">:</span> <span class="n">queueSize</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;blockingCallbacks&quot;</span><span class="p">:</span> <span class="n">blockingCallbacks</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NDArrayPort&quot;</span><span class="p">:</span> <span class="n">NDArrayPort</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NDArrayAddr&quot;</span><span class="p">:</span> <span class="n">NDArrayAddr</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pvName&quot;</span><span class="p">:</span> <span class="n">pvName</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;maxBuffers&quot;</span><span class="p">:</span> <span class="n">maxBuffers</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;maxMemory&quot;</span><span class="p">:</span> <span class="n">maxMemory</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">priority</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stackSize&quot;</span><span class="p">:</span> <span class="n">stackSize</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pva_database</span><span class="p">[</span><span class="n">pvName</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecordInstance</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">pvName</span><span class="p">,</span>
            <span class="n">record_type</span><span class="o">=</span><span class="s2">&quot;PVA&quot;</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">is_pva</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;areaDetector&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">metadata</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="whatrecord.shell.ShellState-attributes">Attributes</h6>









  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.shell.ShellState.db_include_paths" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">db_include_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Database include paths (EPICS_DB_INCLUDE_PATH).</p>
    </div>

  </div>














  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.shell.ShellState.sub_handlers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ShellStateHandler</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Handlers which contain their own state.</p>
    </div>

  </div>






<h6 id="whatrecord.shell.ShellState-methods">Methods</h6>





  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.annotate_record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Hook to annotate a record after being loaded.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Hook to annotate a record after being loaded.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">annotation</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="s2">&quot;Record annotation failed for </span><span class="si">%s</span><span class="s2"> with handler </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">handler</span><span class="o">.</span><span class="n">metadata_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">annotation</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.get_load_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Get a FullLoadContext tuple representing where we are now.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get a FullLoadContext tuple representing where we are now.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">to_load_context</span><span class="p">()</span> <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.handle_NDPvaConfigure" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">handle_NDPvaConfigure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">portName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queueSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">blockingCallbacks</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">NDArrayPort</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">NDArrayAddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">pvName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">maxBuffers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxMemory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stackSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Implicitly creates a PVA group named <code>pvName</code>.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@_handler</span>
<span class="k">def</span> <span class="nf">handle_NDPvaConfigure</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">portName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queueSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">blockingCallbacks</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">NDArrayPort</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">NDArrayAddr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">pvName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">maxBuffers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">maxMemory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">stackSize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Implicitly creates a PVA group named ``pvName``.&quot;&quot;&quot;</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;portName&quot;</span><span class="p">:</span> <span class="n">portName</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;queueSize&quot;</span><span class="p">:</span> <span class="n">queueSize</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;blockingCallbacks&quot;</span><span class="p">:</span> <span class="n">blockingCallbacks</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NDArrayPort&quot;</span><span class="p">:</span> <span class="n">NDArrayPort</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NDArrayAddr&quot;</span><span class="p">:</span> <span class="n">NDArrayAddr</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pvName&quot;</span><span class="p">:</span> <span class="n">pvName</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maxBuffers&quot;</span><span class="p">:</span> <span class="n">maxBuffers</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maxMemory&quot;</span><span class="p">:</span> <span class="n">maxMemory</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">priority</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stackSize&quot;</span><span class="p">:</span> <span class="n">stackSize</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pva_database</span><span class="p">[</span><span class="n">pvName</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecordInstance</span><span class="p">(</span>
        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">pvName</span><span class="p">,</span>
        <span class="n">record_type</span><span class="o">=</span><span class="s2">&quot;PVA&quot;</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">is_pva</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;areaDetector&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">metadata</span>
</code></pre></div>
        </details>
    </div>

  </div>














  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.interpret_shell_line" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">interpret_shell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">recurse</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">raise_on_error</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Interpret a single shell script line.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">interpret_shell_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interpret a single shell script line.&quot;&quot;&quot;</span>
    <span class="n">shresult</span> <span class="o">=</span> <span class="n">parse_iocsh_line</span><span class="p">(</span>
        <span class="n">line</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(),</span>
        <span class="n">prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">macro_context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="p">,</span>
        <span class="n">string_encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">string_encoding</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">input_redirects</span> <span class="o">=</span> <span class="p">[</span><span class="n">redir</span> <span class="k">for</span> <span class="n">redir</span> <span class="ow">in</span> <span class="n">shresult</span><span class="o">.</span><span class="n">redirects</span> <span class="k">if</span> <span class="n">redir</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">shresult</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">shresult</span>
    <span class="k">elif</span> <span class="n">input_redirects</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_input_redirect</span><span class="p">(</span>
                <span class="n">input_redirects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">shresult</span><span class="p">,</span>
                <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
                <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">shresult</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_command</span><span class="p">(</span><span class="o">*</span><span class="n">shresult</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="c1"># Only set if not-None to speed up serialization</span>
                <span class="n">shresult</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">raise_on_error</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">ex_details</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">shresult</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to execute: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">ex_details</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">yield</span> <span class="n">shresult</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shresult</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">IocshCmdArgs</span><span class="p">):</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_line</span><span class="p">(</span>
                <span class="n">shresult</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Otherwise, nothing to do</span>
        <span class="k">yield</span> <span class="n">shresult</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.interpret_shell_script" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">interpret_shell_script</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Load and interpret a shell script named <code>filename</code>.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">interpret_shell_script</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Load and interpret a shell script named ``filename``.&quot;&quot;&quot;</span>
    <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_script_text</span><span class="p">(</span>
        <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
        <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.interpret_shell_script_text" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">interpret_shell_script_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Interpret a shell script named <code>name</code> with <code>lines</code> of text.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">interpret_shell_script_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">lines</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
    <span class="n">recurse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">raise_on_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Interpret a shell script named ``name`` with ``lines`` of text.&quot;&quot;&quot;</span>
    <span class="n">load_ctx</span> <span class="o">=</span> <span class="n">MutableLoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">load_ctx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">load_ctx</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="n">lineno</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret_shell_line</span><span class="p">(</span>
                <span class="n">line</span><span class="p">,</span>
                <span class="n">recurse</span><span class="o">=</span><span class="n">recurse</span><span class="p">,</span>
                <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_context</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">load_ctx</span><span class="p">)</span>

    <span class="c1"># for rec in list(self.database.values()) + list(self.pva_database.values()):</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         self.annotate_record(rec)</span>
    <span class="c1">#     except Exception:</span>
    <span class="c1">#         logger.exception(&quot;Failed to annotate record: %s&quot;, rec.name)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.load_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Load a file, record its hash, and return its contents.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Load a file, record its hash, and return its contents.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fix_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">shasum</span><span class="p">,</span> <span class="n">contents</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">read_text_file_with_hash</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">string_encoding</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">shasum</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ioc_info</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">shasum</span>
    <span class="k">return</span> <span class="n">filename</span><span class="p">,</span> <span class="n">contents</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.shell.ShellState.paths_from_env_var" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellState</span><span class="o">.</span><span class="n">paths_from_env_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Paths from an environment variable (or macro).</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">paths_from_env_var</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">env_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Paths from an environment variable (or macro).&quot;&quot;&quot;</span>
    <span class="n">env_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">macro_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_var</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_directory</span> <span class="o">/</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="c1"># TODO: this is actually OS-dependent (: on linux, ; on Windows)</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">env_var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
    <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>


<h4 id="whatrecord.shell-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.shell.async_load_ioc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">async_load_ioc</span><span class="p">(</span><span class="n">identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">standin_directories</span><span class="p">,</span> <span class="n">use_gdb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocLoadResult</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Helper function for loading an IOC in a subprocess and relying on the cache.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>standin_directories</code></td>
        <td></td>
        <td><p>Stand-in directories to use when loading the IOC.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>identifier</code></td>
        <td><code>Union[int, str]</code></td>
        <td><p>The IOC identifier.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>md</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>Metadata tied to the IOC.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>use_gdb</code></td>
        <td><code>bool</code></td>
        <td><p>Use GDB to analyze the IOC binary for linting of shell script commands.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>use_cache</code></td>
        <td><code>bool</code></td>
        <td><p>Load from the cache for IOCs which have been cached.</p></td>
        <td><code>True</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>IocLoadResult</code></td>
      <td><p>The result of loading, including an identifier which can be used by the
caller to load the item from disk (as it's faster than using
multiprocessing).</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">async_load_ioc</span><span class="p">(</span>
    <span class="n">identifier</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span>
    <span class="n">standin_directories</span><span class="p">,</span>
    <span class="n">use_gdb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocLoadResult</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper function for loading an IOC in a subprocess and relying on the cache.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    standin_directories :</span>
<span class="sd">        Stand-in directories to use when loading the IOC.</span>
<span class="sd">    identifier : Union[int, str]</span>
<span class="sd">        The IOC identifier.</span>
<span class="sd">    md : IocMetadata</span>
<span class="sd">        Metadata tied to the IOC.</span>
<span class="sd">    use_gdb : bool, optional</span>
<span class="sd">        Use GDB to analyze the IOC binary for linting of shell script commands.</span>
<span class="sd">    use_cache : bool, optional</span>
<span class="sd">        Load from the cache for IOCs which have been cached.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IocLoadResult</span>
<span class="sd">        The result of loading, including an identifier which can be used by the</span>
<span class="sd">        caller to load the item from disk (as it&#39;s faster than using</span>
<span class="sd">        multiprocessing).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
        <span class="n">use_cache</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">with</span> <span class="n">time_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">md</span><span class="o">.</span><span class="n">standin_directories</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">standin_directories</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
                <span class="n">cached_ioc</span> <span class="o">=</span> <span class="n">load_cached_ioc</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">cached_ioc</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">IocLoadResult</span><span class="p">(</span>
                        <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
                        <span class="n">load_time</span><span class="o">=</span><span class="n">ctx</span><span class="p">(),</span>
                        <span class="n">cache_hit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">result</span><span class="o">=</span><span class="s2">&quot;use_cache&quot;</span>
                    <span class="p">)</span>

            <span class="n">loaded</span> <span class="o">=</span> <span class="n">LoadedIoc</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">use_gdb</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">md</span><span class="o">.</span><span class="n">get_binary_information</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
                <span class="n">loaded</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">save_to_cache</span><span class="p">()</span>
                <span class="n">loaded</span><span class="o">.</span><span class="n">save_to_cache</span><span class="p">()</span>
                <span class="c1"># Avoid pickling massive JSON blob; instruct server to load</span>
                <span class="c1"># from cache with token &#39;use_cache&#39;</span>
                <span class="n">serialized</span> <span class="o">=</span> <span class="s2">&quot;use_cache&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">serialized</span> <span class="o">=</span> <span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">loaded</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">IocLoadResult</span><span class="p">(</span>
                <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
                <span class="n">load_time</span><span class="o">=</span><span class="n">ctx</span><span class="p">(),</span>
                <span class="n">cache_hit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">result</span><span class="o">=</span><span class="n">IocLoadFailure</span><span class="p">(</span>
                    <span class="n">ex_class</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">ex_message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">),</span>
                    <span class="n">traceback</span><span class="o">=</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">IocLoadResult</span><span class="p">(</span>
            <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
            <span class="n">load_time</span><span class="o">=</span><span class="n">ctx</span><span class="p">(),</span>
            <span class="n">cache_hit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">result</span><span class="o">=</span><span class="n">serialized</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.shell.load_cached_ioc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">load_cached_ioc</span><span class="p">(</span><span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">allow_failed_load</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoadedIoc</span><span class="p">]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Load an IOC from the cache.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>md</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>The metadata from the IOC, which determines its cache key.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>allow_failed_load</code></td>
        <td><code>bool</code></td>
        <td><p>A previous load of the provided IOC may have been marked as a failure.
If set, <code>load_cached_ioc</code> will return the results of the failed load.
If unset, <code>load_cached_ioc</code> will return <code>None</code> and allow the caller
to treat this as a cache miss and potentially reload it from disk.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[LoadedIoc]</code></td>
      <td><p>The cached LoadedIoc instance.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_cached_ioc</span><span class="p">(</span>
    <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span>
    <span class="n">allow_failed_load</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">LoadedIoc</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load an IOC from the cache.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    md : IocMetadata</span>
<span class="sd">        The metadata from the IOC, which determines its cache key.</span>
<span class="sd">    allow_failed_load : bool, optional</span>
<span class="sd">        A previous load of the provided IOC may have been marked as a failure.</span>
<span class="sd">        If set, ``load_cached_ioc`` will return the results of the failed load.</span>
<span class="sd">        If unset, ``load_cached_ioc`` will return ``None`` and allow the caller</span>
<span class="sd">        to treat this as a cache miss and potentially reload it from disk.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Optional[LoadedIoc]</span>
<span class="sd">        The cached LoadedIoc instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cached_md</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">from_cache</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">cached_md</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cached metadata unavailable </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">md</span><span class="o">.</span><span class="n">_cache_key</span> <span class="o">!=</span> <span class="n">cached_md</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Cache key mismatch?! </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">,</span> <span class="n">cached_md</span><span class="o">.</span><span class="n">_cache_key</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">allow_failed_load</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">cached_md</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;load_failure&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">md</span><span class="o">.</span><span class="n">looks_like_sh</span>
    <span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> allow_failed_load=True; </span><span class="si">%s</span><span class="s2">, md.looks_like_sh=</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">cached_md</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;load_failure&quot;</span><span class="p">),</span>
            <span class="n">md</span><span class="o">.</span><span class="n">looks_like_sh</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">cached_md</span><span class="o">.</span><span class="n">is_up_to_date</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not up-to-date&quot;</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is up-to-date; load from cache&quot;</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LoadedIoc</span><span class="o">.</span><span class="n">_json_from_cache</span><span class="p">(</span><span class="n">cached_md</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is noted as up-to-date; but cache file missing&quot;</span><span class="p">,</span> <span class="n">md</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.shell.load_startup_scripts_with_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">load_startup_scripts_with_metadata</span><span class="p">(</span><span class="o">*</span><span class="n">md_items</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">standin_directories</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">use_gdb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptContainer</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Load all given startup scripts into a shared ScriptContainer.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>*md_items</code></td>
        <td><code>list of IocMetadata</code></td>
        <td><p>List of IOC metadata.</p></td>
        <td><code>()</code></td>
      </tr>
      <tr>
        <td><code>standin_directories</code></td>
        <td><code>dict</code></td>
        <td><p>Stand-in/substitute directory mapping.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>processes</code></td>
        <td><code>int</code></td>
        <td><p>The number of processes to use when loading.</p></td>
        <td><code>8</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/shell.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">load_startup_scripts_with_metadata</span><span class="p">(</span>
    <span class="o">*</span><span class="n">md_items</span><span class="p">,</span>
    <span class="n">standin_directories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">processes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">use_gdb</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptContainer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load all given startup scripts into a shared ScriptContainer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *md_items : list of IocMetadata</span>
<span class="sd">        List of IOC metadata.</span>
<span class="sd">    standin_directories : dict</span>
<span class="sd">        Stand-in/substitute directory mapping.</span>
<span class="sd">    processes : int</span>
<span class="sd">        The number of processes to use when loading.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">md_items</span><span class="p">)</span>
    <span class="n">total_child_load_time</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">with</span> <span class="n">time_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">total_time</span><span class="p">,</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span>
        <span class="n">max_workers</span><span class="o">=</span><span class="n">processes</span><span class="p">,</span> <span class="n">initializer</span><span class="o">=</span><span class="n">_process_init</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">coros</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">asyncio</span><span class="o">.</span><span class="n">wrap_future</span><span class="p">(</span>
                <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">_load_ioc</span><span class="p">,</span> <span class="n">identifier</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span> <span class="n">md</span><span class="o">=</span><span class="n">md</span><span class="p">,</span>
                    <span class="n">standin_directories</span><span class="o">=</span><span class="n">standin_directories</span><span class="p">,</span> <span class="n">use_gdb</span><span class="o">=</span><span class="n">use_gdb</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">md</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">md_items</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">coro</span> <span class="ow">in</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">coros</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">load_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">coro</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">md_items</span><span class="p">[</span><span class="n">load_result</span><span class="o">.</span><span class="n">identifier</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                    <span class="s2">&quot;Internal error while loading: </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> [server </span><span class="si">%.1f</span><span class="s2"> s]&quot;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">ex</span><span class="p">,</span>
                    <span class="n">total_time</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">use_cache</span> <span class="o">=</span> <span class="n">load_result</span><span class="o">.</span><span class="n">result</span> <span class="o">==</span> <span class="s2">&quot;use_cache&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_cache</span><span class="p">:</span>
                <span class="n">loaded</span> <span class="o">=</span> <span class="n">load_result</span><span class="o">.</span><span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">loaded</span> <span class="o">=</span> <span class="n">load_cached_ioc</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">allow_failed_load</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">loaded</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cache entry is empty?&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                        <span class="s2">&quot;Internal error while loading cached IOC from disk: &quot;</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2"> [server </span><span class="si">%.1f</span><span class="s2"> s]&quot;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="n">ex</span><span class="p">,</span>
                        <span class="n">total_time</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>

            <span class="n">total_child_load_time</span> <span class="o">+=</span> <span class="n">load_result</span><span class="o">.</span><span class="n">load_time</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">loaded</span><span class="p">,</span> <span class="n">IocLoadFailure</span><span class="p">):</span>
                <span class="n">failure_result</span><span class="p">:</span> <span class="n">IocLoadFailure</span> <span class="o">=</span> <span class="n">loaded</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to load </span><span class="si">%s</span><span class="s2"> in subprocess: </span><span class="si">%s</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;[</span><span class="si">%.1f</span><span class="s2"> s; server </span><span class="si">%.1f</span><span class="s2">]: </span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">md</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">,</span>
                    <span class="n">failure_result</span><span class="o">.</span><span class="n">ex_class</span><span class="p">,</span>
                    <span class="n">load_result</span><span class="o">.</span><span class="n">load_time</span><span class="p">,</span>
                    <span class="n">total_time</span><span class="p">(),</span>
                    <span class="n">failure_result</span><span class="o">.</span><span class="n">ex_message</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">failure_result</span><span class="o">.</span><span class="n">traceback</span>
                        <span class="k">if</span> <span class="n">failure_result</span><span class="o">.</span><span class="n">ex_class</span> <span class="o">!=</span> <span class="s2">&quot;FileNotFoundError&quot;</span>
                        <span class="k">else</span> <span class="s2">&quot;&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">md</span><span class="o">.</span><span class="n">base_version</span> <span class="o">==</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">:</span>
                    <span class="n">md</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
                <span class="k">yield</span> <span class="n">md</span><span class="p">,</span> <span class="n">LoadedIoc</span><span class="o">.</span><span class="n">from_errored_load</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">loaded</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">with</span> <span class="n">time_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
                <span class="n">loaded_ioc</span> <span class="o">=</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">LoadedIoc</span><span class="p">,</span> <span class="n">loaded</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Child loaded </span><span class="si">%s%s</span><span class="s2"> in </span><span class="si">%.1f</span><span class="s2"> s, server deserialized in </span><span class="si">%.1f</span><span class="s2"> s&quot;</span><span class="p">,</span>
                    <span class="n">md</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">,</span>
                    <span class="s2">&quot; from cache&quot;</span> <span class="k">if</span> <span class="n">load_result</span><span class="o">.</span><span class="n">cache_hit</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="n">load_result</span><span class="o">.</span><span class="n">load_time</span><span class="p">,</span>
                    <span class="n">ctx</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="k">yield</span> <span class="n">md</span><span class="p">,</span> <span class="n">loaded_ioc</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Loaded </span><span class="si">%d</span><span class="s2"> startup scripts in </span><span class="si">%.1f</span><span class="s2"> s (wall time) with </span><span class="si">%d</span><span class="s2"> process(es)&quot;</span><span class="p">,</span>
        <span class="n">total_files</span><span class="p">,</span>
        <span class="n">total_time</span><span class="p">(),</span>
        <span class="n">processes</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="s2">&quot;Child processes reported taking a total of </span><span class="si">%.1f</span><span class="s2"> &quot;</span>
        <span class="s2">&quot;sec, the total time on </span><span class="si">%d</span><span class="s2"> process(es)&quot;</span><span class="p">,</span>
        <span class="n">total_child_load_time</span><span class="p">,</span>
        <span class="n">processes</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../utilities/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Shared / Utilities" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Shared / Utilities
            </div>
          </div>
        </a>
      
      
        
        <a href="../lcls/" class="md-footer__link md-footer__link--next" aria-label="Next: LCLS" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              LCLS
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      (C) 2021 SLAC National Accelerator Laboratory
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.01de222e.min.js"></script>
      
    
  </body>
</html>