
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="SLAC National Accelerator Laboratory">
      
      
      
        <link rel="prev" href="../plugins/">
      
      
        <link rel="next" href="../iocsh/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>Shared / Utilities - whatrecord</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="lightblue" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shared-utilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="whatrecord" class="md-header__button md-logo" aria-label="whatrecord" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            whatrecord
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Shared / Utilities
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="lightblue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      whatrecord
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../parsers/" class="md-tabs__link">
      Parsers
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../cli/" class="md-tabs__link">
      CLI
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../server_client/" class="md-tabs__link">
      Server / client
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../plugins/" class="md-tabs__link">
      Plugins
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Shared / Utilities
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../iocsh/" class="md-tabs__link">
      IOC Shell-Related
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lcls/" class="md-tabs__link">
      LCLS
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../tests/" class="md-tabs__link">
      Tests
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="whatrecord" class="md-nav__button md-logo" aria-label="whatrecord" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6Z"/></svg>

    </a>
    whatrecord
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        whatrecord
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parsers/" class="md-nav__link">
        Parsers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../server_client/" class="md-nav__link">
        Server / client
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Shared / Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Shared / Utilities
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    Macros
  </a>
  
    <nav class="md-nav" aria-label="Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro" class="md-nav__link">
    macro
  </a>
  
    <nav class="md-nav" aria-label="macro">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro.macros_from_string" class="md-nav__link">
    macros_from_string()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro.set_serialization_settings" class="md-nav__link">
    set_serialization_settings()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro.should_serialize_key" class="md-nav__link">
    should_serialize_key()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pv-graphing" class="md-nav__link">
    PV Graphing
  </a>
  
    <nav class="md-nav" aria-label="PV Graphing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph" class="md-nav__link">
    graph
  </a>
  
    <nav class="md-nav" aria-label="graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.GraphEdge" class="md-nav__link">
    GraphEdge
  </a>
  
    <nav class="md-nav" aria-label="GraphEdge">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.GraphEdge-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.GraphNode" class="md-nav__link">
    GraphNode
  </a>
  
    <nav class="md-nav" aria-label="GraphNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.GraphNode-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.RecordLinkGraph" class="md-nav__link">
    RecordLinkGraph
  </a>
  
    <nav class="md-nav" aria-label="RecordLinkGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.RecordLinkGraph-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.RecordLinkGraph-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.ScriptLinkGraph" class="md-nav__link">
    ScriptLinkGraph
  </a>
  
    <nav class="md-nav" aria-label="ScriptLinkGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.ScriptLinkGraph-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.build_database_relations" class="md-nav__link">
    build_database_relations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.build_script_relations" class="md-nav__link">
    build_script_relations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.combine_relations" class="md-nav__link">
    combine_relations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.find_record_links" class="md-nav__link">
    find_record_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.graph_links" class="md-nav__link">
    graph_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.graph_script_relations" class="md-nav__link">
    graph_script_relations()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shared" class="md-nav__link">
    Shared
  </a>
  
    <nav class="md-nav" aria-label="Shared">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common" class="md-nav__link">
    common
  </a>
  
    <nav class="md-nav" aria-label="common">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.AsynPortBase" class="md-nav__link">
    AsynPortBase
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.DatabaseDevice" class="md-nav__link">
    DatabaseDevice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.DatabaseMenu" class="md-nav__link">
    DatabaseMenu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.FileFormat" class="md-nav__link">
    FileFormat
  </a>
  
    <nav class="md-nav" aria-label="FileFormat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.FileFormat-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.GdbBinaryInfo" class="md-nav__link">
    GdbBinaryInfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocMetadata" class="md-nav__link">
    IocMetadata
  </a>
  
    <nav class="md-nav" aria-label="IocMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocMetadata-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocMetadata-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshArgument" class="md-nav__link">
    IocshArgument
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshCmdArgs" class="md-nav__link">
    IocshCmdArgs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshCommand" class="md-nav__link">
    IocshCommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshScript" class="md-nav__link">
    IocshScript
  </a>
  
    <nav class="md-nav" aria-label="IocshScript">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshScript-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshVariable" class="md-nav__link">
    IocshVariable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.LoadContext" class="md-nav__link">
    LoadContext
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.MutableLoadContext" class="md-nav__link">
    MutableLoadContext
  </a>
  
    <nav class="md-nav" aria-label="MutableLoadContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.MutableLoadContext-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.PVAFieldReference" class="md-nav__link">
    PVAFieldReference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordDefinitionAndInstance" class="md-nav__link">
    RecordDefinitionAndInstance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordField" class="md-nav__link">
    RecordField
  </a>
  
    <nav class="md-nav" aria-label="RecordField">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordField-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstance" class="md-nav__link">
    RecordInstance
  </a>
  
    <nav class="md-nav" aria-label="RecordInstance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstance-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstance-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstanceSummary" class="md-nav__link">
    RecordInstanceSummary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordType" class="md-nav__link">
    RecordType
  </a>
  
    <nav class="md-nav" aria-label="RecordType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordType-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordTypeField" class="md-nav__link">
    RecordTypeField
  </a>
  
    <nav class="md-nav" aria-label="RecordTypeField">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordTypeField-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.ShellStateHandler" class="md-nav__link">
    ShellStateHandler
  </a>
  
    <nav class="md-nav" aria-label="ShellStateHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.ShellStateHandler-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.ShellStateHandler-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.StringWithContext" class="md-nav__link">
    StringWithContext
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.UnquotedString" class="md-nav__link">
    UnquotedString
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.WhatRecord" class="md-nav__link">
    WhatRecord
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.context_from_lark_token" class="md-nav__link">
    context_from_lark_token()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.get_grammar_version_by_base_version" class="md-nav__link">
    get_grammar_version_by_base_version()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.get_link_information" class="md-nav__link">
    get_link_information()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.remove_redundant_context" class="md-nav__link">
    remove_redundant_context()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.time_context" class="md-nav__link">
    time_context()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
    <nav class="md-nav" aria-label="Miscellaneous">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache" class="md-nav__link">
    cache
  </a>
  
    <nav class="md-nav" aria-label="cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.CacheKey" class="md-nav__link">
    CacheKey
  </a>
  
    <nav class="md-nav" aria-label="CacheKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.CacheKey-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.Cached" class="md-nav__link">
    Cached
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.InlineCached" class="md-nav__link">
    InlineCached
  </a>
  
    <nav class="md-nav" aria-label="InlineCached">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.InlineCached-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.format" class="md-nav__link">
    format
  </a>
  
    <nav class="md-nav" aria-label="format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format.FormatContext" class="md-nav__link">
    FormatContext
  </a>
  
    <nav class="md-nav" aria-label="FormatContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format.FormatContext-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graphql" class="md-nav__link">
    graphql
  </a>
  
    <nav class="md-nav" aria-label="graphql">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graphql-classes" class="md-nav__link">
    Classes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.settings" class="md-nav__link">
    settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util" class="md-nav__link">
    util
  </a>
  
    <nav class="md-nav" aria-label="util">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.util-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.check_files_up_to_date" class="md-nav__link">
    check_files_up_to_date()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.find_binary_from_hashbang" class="md-nav__link">
    find_binary_from_hashbang()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.get_bytes_sha256" class="md-nav__link">
    get_bytes_sha256()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.get_file_sha256" class="md-nav__link">
    get_file_sha256()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.lines_between" class="md-nav__link">
    lines_between()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.read_text_file_with_hash" class="md-nav__link">
    read_text_file_with_hash()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.run_gdb" class="md-nav__link">
    run_gdb()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.run_script_with_json_output" class="md-nav__link">
    run_script_with_json_output()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.write_to_file" class="md-nav__link">
    write_to_file()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../iocsh/" class="md-nav__link">
        IOC Shell-Related
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lcls/" class="md-nav__link">
        LCLS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="shared-utilities">Shared / Utilities</h1>
<h2 id="macros">Macros</h2>


<div class="doc doc-object doc-module">



<h3 id="whatrecord.macro" class="doc doc-heading">
          <code>whatrecord.macro</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">







<h4 id="whatrecord.macro-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.macro.macros_from_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">macro</span><span class="o">.</span><span class="n">macros_from_string</span><span class="p">(</span><span class="n">macro_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_environment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get a macro dictionary from a macro string.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>macro_string</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The macro string, in the format A=B,C=D,...</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>use_environment : bool, optional
    Use environment variables as well.  Defaults to False.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>macros</code></td>          <td>
                <code><span title="typing.Dict">Dict</span>[str, str]</code>
          </td>
          <td><p>Macro key to value.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/macro.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">macros_from_string</span><span class="p">(</span>
    <span class="n">macro_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_environment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a macro dictionary from a macro string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    macro_string : str</span>
<span class="sd">        The macro string, in the format A=B,C=D,...</span>

<span class="sd">    use_environment : bool, optional</span>
<span class="sd">        Use environment variables as well.  Defaults to False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    macros : Dict[str, str]</span>
<span class="sd">        Macro key to value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">macro_string</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">macro_context</span> <span class="o">=</span> <span class="n">MacroContext</span><span class="p">(</span><span class="n">use_environment</span><span class="o">=</span><span class="n">use_environment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">macro_context</span><span class="o">.</span><span class="n">define_from_string</span><span class="p">(</span><span class="n">macro_string</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.macro.set_serialization_settings" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">macro</span><span class="o">.</span><span class="n">set_serialization_settings</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">MACRO_KEY_SKIP</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Update macro serialization settings.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/macro.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_serialization_settings</span><span class="p">(</span><span class="n">skip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">MACRO_KEY_SKIP</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update macro serialization settings.&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">RE_MACRO_KEY_SKIP</span>
    <span class="k">if</span> <span class="n">skip</span><span class="p">:</span>
        <span class="n">skip_regex</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">skip_regex</span> <span class="o">=</span> <span class="n">MACRO_KEY_SKIP_DEFAULT</span>
    <span class="n">RE_MACRO_KEY_SKIP</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span> <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">skip_regex</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.macro.should_serialize_key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">macro</span><span class="o">.</span><span class="n">should_serialize_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Should <code>key</code> be serialized when saving macros?</p>
<p>Settings used:
* WHATRECORD_MACRO_KEY_SKIP (str) - keys to skip, specified by regular
  expressions.  Should be valid Python syntax for a list of strings, as it
  will be handed to <code>ast.literal_eval</code>.
* WHATRECORD_MACRO_INCLUDE_ENV (bool) - serialize environment variables if
  set to 1.
* WHATRECORD_MACRO_VALUE_MAX_LENGTH (int) - maximum length of macro values
  to serialize. 0 to disable maximum length check.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>key</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The macro/environment variable name.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>value</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The value associated with the macro.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/macro.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">should_serialize_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Should ``key`` be serialized when saving macros?</span>

<span class="sd">    Settings used:</span>
<span class="sd">    * WHATRECORD_MACRO_KEY_SKIP (str) - keys to skip, specified by regular</span>
<span class="sd">      expressions.  Should be valid Python syntax for a list of strings, as it</span>
<span class="sd">      will be handed to ``ast.literal_eval``.</span>
<span class="sd">    * WHATRECORD_MACRO_INCLUDE_ENV (bool) - serialize environment variables if</span>
<span class="sd">      set to 1.</span>
<span class="sd">    * WHATRECORD_MACRO_VALUE_MAX_LENGTH (int) - maximum length of macro values</span>
<span class="sd">      to serialize. 0 to disable maximum length check.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : str</span>
<span class="sd">        The macro/environment variable name.</span>
<span class="sd">    value : str</span>
<span class="sd">        The value associated with the macro.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Above the maximum length threshold -&gt; skip</span>
    <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">MACRO_VALUE_MAX_LENGTH</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">settings</span><span class="o">.</span><span class="n">MACRO_VALUE_MAX_LENGTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Throw out environment variables if MACRO_INCLUDE_ENV is unset:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">MACRO_INCLUDE_ENV</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Bad key or one that matches regular expressions in RE_MACRO_KEY_SKIP</span>
    <span class="c1"># (by way of &#39;WHATRECORD_MACRO_KEY_SKIP&#39;)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">RE_MACRO_KEY_SKIP</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="pv-graphing">PV Graphing</h2>


<div class="doc doc-object doc-module">



<h3 id="whatrecord.graph" class="doc doc-heading">
          <code>whatrecord.graph</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h4 id="whatrecord.graph-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.GraphEdge" class="doc doc-heading">
        <code>whatrecord.graph.GraphEdge</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">




  

  <div class="doc doc-children">





<h6 id="whatrecord.graph.GraphEdge-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.graph.GraphEdge.destination_with_port" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">GraphEdge</span><span class="o">.</span><span class="n">destination_with_port</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Destination name including the port name, for graphviz.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.graph.GraphEdge.source_with_port" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">GraphEdge</span><span class="o">.</span><span class="n">source_with_port</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Source name including the port name, for graphviz.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.GraphNode" class="doc doc-heading">
        <code>whatrecord.graph.GraphNode</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">




  

  <div class="doc doc-children">







<h6 id="whatrecord.graph.GraphNode-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.graph.GraphNode.add_text_line" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">GraphNode</span><span class="o">.</span><span class="n">add_text_line</span><span class="p">(</span><span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">only_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Add a line of text to the node.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>line</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The line to add.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>delimiter : str, optional
    The between-line delimiter.</p>
<p>only_unique : bool, optional
    Only add unique lines to the text.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_text_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">only_unique</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a line of text to the node.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    line : str</span>
<span class="sd">        The line to add.</span>

<span class="sd">    delimiter : str, optional</span>
<span class="sd">        The between-line delimiter.</span>

<span class="sd">    only_unique : bool, optional</span>
<span class="sd">        Only add unique lines to the text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">line</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">only_unique</span> <span class="ow">or</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.RecordLinkGraph" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RecordLinkGraph</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">starting_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="whatrecord.graph._GraphHelper">_GraphHelper</span></code></p>

  
      <p>Record link graph.</p>


          <details class="quote">
            <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">starting_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">record_types</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">record_types</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span> <span class="o">=</span> <span class="n">starting_records</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">header_format</span> <span class="o">=</span> <span class="n">header_format</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">header_format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field_format</span> <span class="o">=</span> <span class="n">field_format</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">field_format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text_format</span> <span class="o">=</span> <span class="n">text_format</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">text_format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span> <span class="o">=</span> <span class="n">sort_fields</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show_empty</span> <span class="o">=</span> <span class="n">show_empty</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">relations</span>

    <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h6 id="whatrecord.graph.RecordLinkGraph-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.graph.RecordLinkGraph.graphed_records" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RecordLinkGraph</span><span class="o">.</span><span class="n">graphed_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>All graphed record names (i.e., node labels).</p>
  </div>

</div>

<h6 id="whatrecord.graph.RecordLinkGraph-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.graph.RecordLinkGraph.add_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RecordLinkGraph</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">])</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Add records from the given database to the graph.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add records from the given database to the graph.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">Database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">add_or_update_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">record_types</span>
        <span class="p">)</span>

    <span class="n">edge_color_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">find_record_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relations</span>
    <span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="n">src</span><span class="p">),</span> <span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="n">dest</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;PROC&quot;</span><span class="p">:</span>
                <span class="o">...</span>
            <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_empty</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">][</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    &lt;TR&gt;</span>
<span class="s2">                        &lt;TD PORT=&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_name&quot; BORDER=&quot;1&quot;&gt;</span>
<span class="s2">                            &lt;B&gt;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&lt;/B&gt;</span>
<span class="s2">                        &lt;/TD&gt;</span>
<span class="s2">                        &lt;TD PORT=&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_value&quot; BORDER=&quot;1&quot;&gt;</span>
<span class="s2">                            </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="si">}</span>
<span class="s2">                        &lt;/TD&gt;</span>
<span class="s2">                    &lt;/TR&gt;</span>
<span class="s2">                    &quot;&quot;&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;DBF_INLINK&quot;</span> <span class="ow">or</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;DBF_OUTLINK&quot;</span><span class="p">:</span>
            <span class="n">src</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span>
            <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New edge </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

        <span class="n">edge_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_edge_kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">to_find</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">match</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">to_find</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                    <span class="n">edge_kw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pairs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;DBF_FWDLINK&quot;</span><span class="p">:</span>
                <span class="c1"># edge_kw[&quot;taillabel&quot;] = &quot;FLNK&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                    <span class="n">src</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">source_port</span><span class="o">=</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">edge_kw</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;DBF_FWDLINK&quot;</span><span class="p">:</span>
                <span class="c1"># edge_kw[&quot;taillabel&quot;] = &quot;FLNK&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                    <span class="n">dest</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">src</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
                    <span class="n">source_port</span><span class="o">=</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">edge_kw</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># edge_kw[&quot;taillabel&quot;] = f&quot;{li.field1.name}&quot;</span>
                <span class="c1"># edge_kw[&quot;headlabel&quot;] = f&quot;{li.field2.name}&quot;</span>
                <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                    <span class="n">edge_kw</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="n">edge_color_idx</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_colors</span><span class="p">[</span><span class="n">edge_color_idx</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_colors</span><span class="p">)]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dest</span><span class="o">.</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">source_port</span><span class="o">=</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">dest_port</span><span class="o">=</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">edge_kw</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="c1"># No relationship found; at least show the records</span>
        <span class="k">for</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rec_name</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="c1"># if self.sort_fields:</span>
        <span class="c1">#     node.text = &quot;\n&quot;.join(sorted(node.text.splitlines()))</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">sub_header</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Alias: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sub_header</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;&lt;TR&gt;&lt;TD&gt;</span><span class="si">{</span><span class="n">sub_header</span><span class="si">}</span><span class="s2">&lt;/TD&gt;&lt;/TR&gt;&quot;&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sub_header</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;fields&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="n">field_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">rtype</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">record_type</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="n">field_lines</span><span class="o">=</span><span class="p">(</span><span class="n">sub_header</span> <span class="o">+</span> <span class="n">field_text</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.ScriptLinkGraph" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ScriptLinkGraph</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScriptPVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="whatrecord.graph._GraphHelper">_GraphHelper</span></code></p>

  
      <p>Script link graph (i.e., inter-IOC record links).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>database</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of record name to record instance.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>starting_records</code></td>
          <td>
                <code>list of str</code>
          </td>
          <td><p>Record names</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sort_fields</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Sort list of fields</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>show_empty</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Show empty fields</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>relations</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>script_relations</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>Pre-built script relationship dictionary.  Generated from database if
not provided.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>record_types</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.  Only
used for determining script relations if not specified.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>


          <details class="quote">
            <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScriptPVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">record_types</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">record_types</span> <span class="ow">or</span> <span class="p">{}))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span> <span class="o">=</span> <span class="n">limit_to_records</span> <span class="ow">or</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">relations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span> <span class="o">=</span> <span class="n">script_relations</span>

    <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">







<h6 id="whatrecord.graph.ScriptLinkGraph-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.graph.ScriptLinkGraph.add_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ScriptLinkGraph</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">])</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Add records from the given database to the graph.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add records from the given database to the graph.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">Database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">add_or_update_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

    <span class="c1"># if not self.script_relations:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span>
        <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">record_types</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span> <span class="o">=</span> <span class="n">build_script_relations</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span>
        <span class="n">by_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">,</span>
        <span class="n">limit_to_records</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">script_a</span><span class="p">,</span> <span class="n">script_a_relations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">script_a</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">script_a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">script_b</span> <span class="ow">in</span> <span class="n">script_a_relations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">script_b</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">script_b</span><span class="p">)</span>

            <span class="n">inter_lines</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">script_a</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="p">[</span><span class="n">script_a</span><span class="p">][</span><span class="n">script_b</span><span class="p">]))</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">script_b</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="p">[</span><span class="n">script_b</span><span class="p">][</span><span class="n">script_a</span><span class="p">]))</span>
            <span class="p">)</span>
            <span class="n">inter_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_a</span><span class="si">}</span><span class="s2">&lt;-&gt;</span><span class="si">{</span><span class="n">script_b</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">inter_node</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inter_lines</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">script_a</span><span class="p">,</span> <span class="n">inter_node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">inter_node</span><span class="p">,</span> <span class="n">script_b</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="c1"># No relationship found; at least show the records</span>
        <span class="k">for</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rec_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h4 id="whatrecord.graph-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.build_database_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">build_database_relations</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PVRelations</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Build a dictionary of PV relationships.</p>
<p>This should not be called often for large databases, as it makes no attempt
to be computationally efficient.  For repeated usage, cache the result
of this function and reuse it in future calls to <code>graph_links</code> and such.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>database</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of record name to record instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>record_types : dict, optional
    The database definitions to use for fields that are not defined in the
    database file.  Dictionary of record type name to RecordType.
    If not specified, the whatrecord-vendored database definition files
    will be used.</p>
<p>version : int, optional
    Use the old V3 style or new V3 style database grammar by specifying
    3 or 4, respectively.  Defaults to 3.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>info</code></td>          <td>
                <code>dict</code>
          </td>
          <td><p>Such that: <code>info[pv1][pv2] = (field1, field2, info)</code>
And in reverse: <code>info[pv2][pv1] = (field2, field1, info)</code></p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_database_relations</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PVRelations</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a dictionary of PV relationships.</span>

<span class="sd">    This should not be called often for large databases, as it makes no attempt</span>
<span class="sd">    to be computationally efficient.  For repeated usage, cache the result</span>
<span class="sd">    of this function and reuse it in future calls to ``graph_links`` and such.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>

<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.</span>
<span class="sd">        If not specified, the whatrecord-vendored database definition files</span>
<span class="sd">        will be used.</span>

<span class="sd">    version : int, optional</span>
<span class="sd">        Use the old V3 style or new V3 style database grammar by specifying</span>
<span class="sd">        3 or 4, respectively.  Defaults to 3.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    info : dict</span>
<span class="sd">        Such that: ``info[pv1][pv2] = (field1, field2, info)``</span>
<span class="sd">        And in reverse: ``info[pv2][pv1] = (field2, field1, info)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">record_types</span><span class="p">:</span>
        <span class="n">dbd</span> <span class="o">=</span> <span class="n">Database</span><span class="o">.</span><span class="n">from_vendored_dbd</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">)</span>
        <span class="n">record_types</span> <span class="o">=</span> <span class="n">dbd</span><span class="o">.</span><span class="n">record_types</span>

    <span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">warned</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">by_record</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">rec1</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">rec1_rtype</span> <span class="o">=</span> <span class="n">record_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec1</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">_get_links_for_record</span><span class="p">(</span>
            <span class="n">rec1</span><span class="p">,</span> <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span>
        <span class="p">):</span>
            <span class="n">field1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">field1</span><span class="p">)</span>
            <span class="c1"># field1.context = rec1.context[:1] + field1.context</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">rec1</span><span class="o">.</span><span class="n">has_dbd_info</span> <span class="ow">and</span> <span class="n">rec1_rtype</span><span class="p">:</span>
                <span class="n">field1</span><span class="o">.</span><span class="n">update_from_record_type</span><span class="p">(</span><span class="n">rec1_rtype</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">link</span><span class="p">:</span>
                <span class="n">link</span><span class="p">,</span> <span class="n">field2_name</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">field1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;FLNK&quot;</span><span class="p">:</span>
                <span class="n">field2_name</span> <span class="o">=</span> <span class="s2">&quot;PROC&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field2_name</span> <span class="o">=</span> <span class="s2">&quot;VAL&quot;</span>

            <span class="n">rec2_name</span> <span class="o">=</span> <span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
            <span class="n">rec2</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">field2</span> <span class="o">=</span> <span class="n">_field_from_record_relation</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">rec2</span><span class="p">,</span>
                <span class="n">field_name</span><span class="o">=</span><span class="n">field2_name</span><span class="p">,</span>
                <span class="n">link_text</span><span class="o">=</span><span class="n">link</span><span class="p">,</span>
                <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">field2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">rec2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">warned</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Linked record from </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> not in database: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rec2_name</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We may have updated information about the record field;</span>
                <span class="c1"># but it&#39;s possible this is entirely unnecessary (TODO)</span>
                <span class="n">rec2_type</span> <span class="o">=</span> <span class="n">record_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec2</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rec2_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">field2</span><span class="o">.</span><span class="n">update_from_record_type</span><span class="p">(</span><span class="n">rec2_type</span><span class="p">)</span>

            <span class="n">by_record</span><span class="p">[</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">rec2_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>
            <span class="n">by_record</span><span class="p">[</span><span class="n">rec2_name</span><span class="p">][</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field2</span><span class="p">,</span> <span class="n">field1</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inner_dict</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">inner_dict</span> <span class="ow">in</span> <span class="n">by_record</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.build_script_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">build_script_relations</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">by_record</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span> <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptPVRelations</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Build a relational map of IOCs that include inter-IOC PV relationships.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>database</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, <a class="autorefs autorefs-internal" title="whatrecord.db.RecordInstance" href="#whatrecord.common.RecordInstance">RecordInstance</a>]</code>
          </td>
          <td><p>The full composite database.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>by_record</code></td>
          <td>
                <code><span title="whatrecord.common.PVRelations">PVRelations</span></code>
          </td>
          <td><p>PV relationships, as generated by <code>build_database_relations</code>.
This is a mapping of PV1 to {"PV2": [FieldRelation, ...]}.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limit_to_records</code></td>
          <td>
                <code><span title="typing.List">List</span>[str], optional</code>
          </td>
          <td><p>Limit the relationships to only the provided records.  If not set,
defaults to all records in the composite database.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="whatrecord.common.ScriptPVRelations">ScriptPVRelations</span></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">build_script_relations</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">by_record</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span>
    <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptPVRelations</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a relational map of IOCs that include inter-IOC PV relationships.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : Dict[str, RecordInstance]</span>
<span class="sd">        The full composite database.</span>
<span class="sd">    by_record : PVRelations</span>
<span class="sd">        PV relationships, as generated by ``build_database_relations``.</span>
<span class="sd">        This is a mapping of PV1 to {&quot;PV2&quot;: [FieldRelation, ...]}.</span>
<span class="sd">    limit_to_records : List[str], optional</span>
<span class="sd">        Limit the relationships to only the provided records.  If not set,</span>
<span class="sd">        defaults to all records in the composite database.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ScriptPVRelations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">limit_to_records</span><span class="p">:</span>
        <span class="n">record_items</span> <span class="o">=</span> <span class="n">by_record</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">record_items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">by_record</span><span class="p">[</span><span class="n">name</span><span class="p">])</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">limit_to_records</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">by_record</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_owner</span><span class="p">(</span><span class="n">rec</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">rec</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">owner</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">owner</span> <span class="o">!=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rec</span><span class="o">.</span><span class="n">owner</span>

        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rec</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="n">by_script</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">list_of_rec2s</span> <span class="ow">in</span> <span class="n">record_items</span><span class="p">:</span>
        <span class="n">rec1</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec1_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rec2_name</span> <span class="ow">in</span> <span class="n">list_of_rec2s</span><span class="p">:</span>
            <span class="n">rec2</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="n">owner1</span> <span class="o">=</span> <span class="n">get_owner</span><span class="p">(</span><span class="n">rec1</span><span class="p">)</span>
            <span class="n">owner2</span> <span class="o">=</span> <span class="n">get_owner</span><span class="p">(</span><span class="n">rec2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">owner1</span> <span class="o">!=</span> <span class="n">owner2</span><span class="p">:</span>
                <span class="n">by_script</span><span class="p">[</span><span class="n">owner2</span><span class="p">][</span><span class="n">owner1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">)</span>
                <span class="n">by_script</span><span class="p">[</span><span class="n">owner1</span><span class="p">][</span><span class="n">owner2</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rec1_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">owner1</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">owner2</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">owner2</span><span class="p">,</span> <span class="n">items</span> <span class="ow">in</span> <span class="n">owner2s</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">owner1</span><span class="p">,</span> <span class="n">owner2s</span> <span class="ow">in</span> <span class="n">by_script</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.combine_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">combine_relations</span><span class="p">(</span><span class="n">dest_relations</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span> <span class="n">dest_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">source_relations</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span> <span class="n">source_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Combine multiple script relations into one.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">combine_relations</span><span class="p">(</span>
    <span class="n">dest_relations</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span>
    <span class="n">dest_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">source_relations</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span>
    <span class="n">source_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine multiple script relations into one.&quot;&quot;&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_relation_by_field</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
    <span class="p">]:</span>
        <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec2_names</span> <span class="ow">in</span> <span class="n">source_relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dest_rec1_dict</span> <span class="o">=</span> <span class="n">dest_relations</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rec1_name</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">rec2_name</span> <span class="ow">in</span> <span class="n">rec2_names</span><span class="p">:</span>
                <span class="n">dest_rec2</span> <span class="o">=</span> <span class="n">dest_rec1_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">relation_by_field</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="p">(</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">):</span> <span class="p">(</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">dest_rec2</span>
                <span class="p">}</span>
                <span class="k">yield</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">relation_by_field</span>

    <span class="c1"># Part 1:</span>
    <span class="c1"># Rebuild with new aliases, if available</span>
    <span class="c1"># Either set of relations could have referred to aliased names, actual</span>
    <span class="c1"># names, or even *both*.</span>

    <span class="k">def</span> <span class="nf">alias_to_actual</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="c1"># This is kinda expensive, imperfect, and confusing; consider reworking</span>
        <span class="k">for</span> <span class="n">alias_from</span><span class="p">,</span> <span class="n">alias_to</span> <span class="ow">in</span> <span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># A -&gt; B</span>
            <span class="n">inner_dict</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alias_from</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inner_dict</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Fix up B &lt;- A first, since it&#39;s symmetric</span>
            <span class="k">for</span> <span class="n">inner_name</span><span class="p">,</span> <span class="n">inner_items</span> <span class="ow">in</span> <span class="n">inner_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># d[inner_name][alias_to] += d[inner_name][alias_from]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">inner_name</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">alias_to</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">inner_name</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alias_from</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">alias_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">alias_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">inner_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The actual record name is already in the relation dict</span>
                <span class="k">for</span> <span class="n">inner_name</span><span class="p">,</span> <span class="n">inner_items</span> <span class="ow">in</span> <span class="n">inner_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># d[alias_to][inner_name] += inner_items</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">alias_to</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">inner_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inner_items</span><span class="p">)</span>

    <span class="n">alias_to_actual</span><span class="p">(</span><span class="n">dest_relations</span><span class="p">)</span>
    <span class="n">alias_to_actual</span><span class="p">(</span><span class="n">source_relations</span><span class="p">)</span>

    <span class="c1"># Part 1:</span>
    <span class="c1"># Merge in new or updated relations from the second set</span>
    <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">relation_by_field</span> <span class="ow">in</span> <span class="n">get_relation_by_field</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">source_relations</span><span class="p">[</span><span class="n">rec1_name</span><span class="p">][</span><span class="n">rec2_name</span><span class="p">]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">existing_link</span> <span class="o">=</span> <span class="n">relation_by_field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_link</span><span class="p">:</span>
                <span class="n">relation_by_field</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existing_field1</span><span class="p">,</span> <span class="n">existing_field2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">existing_link</span>
                <span class="n">existing_field1</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">field1</span><span class="p">)</span>
                <span class="n">existing_field2</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">field2</span><span class="p">)</span>

        <span class="n">dest_relations</span><span class="p">[</span><span class="n">rec1_name</span><span class="p">][</span><span class="n">rec2_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">relation_by_field</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_record</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstance</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get record from either database.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dest_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source_db</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">get_field_info</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get record definition if available.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">record</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">record_types</span><span class="p">:</span>
            <span class="n">field_def</span> <span class="o">=</span> <span class="n">record_types</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">RecordField</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">field_def</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">field_def</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Field not in database or database definition&quot;</span><span class="p">)</span>

    <span class="c1"># Part 2:</span>
    <span class="c1"># Update any existing relations in the destination relations with</span>
    <span class="c1"># information from the source database</span>
    <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec1</span> <span class="ow">in</span> <span class="n">source_db</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">rec1_name</span> <span class="ow">in</span> <span class="n">dest_relations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">rec2_items</span> <span class="ow">in</span> <span class="n">dest_relations</span><span class="p">[</span><span class="n">rec1_name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># We know rec1 is in the source database, but we don&#39;t know</span>
                <span class="c1"># where rec2 might be, so use `get_record`.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rec2</span> <span class="o">=</span> <span class="n">get_record</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="c1"># It&#39;s not in this IOC...</span>
                    <span class="k">continue</span>

                <span class="k">def</span> <span class="nf">get_items_to_update</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">rec2_items</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec1</span><span class="p">,</span> <span class="n">field1</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec2</span><span class="p">,</span> <span class="n">field2</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">dest_relations</span><span class="p">[</span><span class="n">rec2_name</span><span class="p">][</span><span class="n">rec1_name</span><span class="p">]:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec2</span><span class="p">,</span> <span class="n">field1</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec1</span><span class="p">,</span> <span class="n">field2</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">rec</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_items_to_update</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">field_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Missing field? </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">field_info</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.find_record_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">find_record_links</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">LinkInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get all related record links from a set of starting records.</p>
<p>All starting records will be included, along with any other records that
are linked to from there.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>database</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of record name to record instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>starting_records : list of str
    Record names</p>
<p>relations : dict, optional
    Pre-built PV relationship dictionary.  Generated from database
    if not provided.</p>
<p>record_types : dict, optional
    The database definitions to use for fields that are not defined in the
    database file.  Dictionary of record type name to RecordType.</p>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>link_info</code></td>          <td>
                <code><span title="whatrecord.graph.LinkInfo">LinkInfo</span></code>
          </td>
          <td><p>Link info</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_record_links</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">LinkInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all related record links from a set of starting records.</span>

<span class="sd">    All starting records will be included, along with any other records that</span>
<span class="sd">    are linked to from there.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>

<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>

<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>

<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    link_info : LinkInfo</span>
<span class="sd">        Link info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checked</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">relations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span><span class="p">)</span>

    <span class="n">records_to_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">starting_records</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">records_to_check</span><span class="p">:</span>
        <span class="n">rec1</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">records_to_check</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;--- record </span><span class="si">%s</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">relations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rec2_name</span> <span class="ow">in</span> <span class="n">checked</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">rec2</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rec2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec2_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">checked</span> <span class="ow">and</span> <span class="n">rec2_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">records_to_check</span><span class="p">:</span>
                    <span class="n">records_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">)</span>

                <span class="n">li</span> <span class="o">=</span> <span class="n">LinkInfo</span><span class="p">(</span>
                    <span class="n">record1</span><span class="o">=</span><span class="n">rec1</span><span class="p">,</span>
                    <span class="n">field1</span><span class="o">=</span><span class="n">field1</span><span class="p">,</span>
                    <span class="n">record2</span><span class="o">=</span><span class="n">rec2</span><span class="p">,</span>
                    <span class="n">field2</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Link </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">li</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">li</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.graph_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">graph_links</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]],</span> <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordLinkGraph</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Create a graphviz digraph of record links.</p>
<p>All starting records will be included, along with any other records that
are linked to from there - if available in the database.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>database</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of record name to record instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>starting_records</code></td>
          <td>
                <code>list of str</code>
          </td>
          <td><p>Record names</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>graph</code></td>
          <td>
                <code>graphviz.<span title="graphviz.Graph">Graph</span>, optional</code>
          </td>
          <td><p>Graph instance to use. New one created if not specified.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>engine</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>Graphviz engine (dot, fdp, etc)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>field_format</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>Format string for fields (keys: field, value, attr)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>sort_fields</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Sort list of fields</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>text_format</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>Text format for full node (keys: header, field_lines)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>show_empty</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Show empty fields</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>font_name</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>Font name to use for all nodes and edges</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>relations</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>record_types</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.  Only
used for determining script relations if not specified.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>graph</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.graph.RecordLinkGraph" href="#whatrecord.graph.RecordLinkGraph">RecordLinkGraph</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">graph_links</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]],</span>
    <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordLinkGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a graphviz digraph of record links.</span>

<span class="sd">    All starting records will be included, along with any other records that</span>
<span class="sd">    are linked to from there - if available in the database.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>
<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>
<span class="sd">    graph : graphviz.Graph, optional</span>
<span class="sd">        Graph instance to use. New one created if not specified.</span>
<span class="sd">    engine : str, optional</span>
<span class="sd">        Graphviz engine (dot, fdp, etc)</span>
<span class="sd">    field_format : str, optional</span>
<span class="sd">        Format string for fields (keys: field, value, attr)</span>
<span class="sd">    sort_fields : bool, optional</span>
<span class="sd">        Sort list of fields</span>
<span class="sd">    text_format : str, optional</span>
<span class="sd">        Text format for full node (keys: header, field_lines)</span>
<span class="sd">    show_empty : bool, optional</span>
<span class="sd">        Show empty fields</span>
<span class="sd">    font_name : str, optional</span>
<span class="sd">        Font name to use for all nodes and edges</span>
<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>
<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.  Only</span>
<span class="sd">        used for determining script relations if not specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    graph : RecordLinkGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">RecordLinkGraph</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
        <span class="n">starting_records</span><span class="o">=</span><span class="n">starting_records</span><span class="p">,</span>
        <span class="n">header_format</span><span class="o">=</span><span class="n">header_format</span><span class="p">,</span>
        <span class="n">field_format</span><span class="o">=</span><span class="n">field_format</span><span class="p">,</span>
        <span class="n">text_format</span><span class="o">=</span><span class="n">text_format</span><span class="p">,</span>
        <span class="n">sort_fields</span><span class="o">=</span><span class="n">sort_fields</span><span class="p">,</span>
        <span class="n">show_empty</span><span class="o">=</span><span class="n">show_empty</span><span class="p">,</span>
        <span class="n">relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
        <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.graph_script_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">graph_script_relations</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScriptPVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptLinkGraph</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Create a graphviz digraph of script links (i.e., inter-IOC record links).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>database</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>Dictionary of record name to record instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>starting_records</code></td>
          <td>
                <code>list of str</code>
          </td>
          <td><p>Record names</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>relations</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>script_relations</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>Pre-built script relationship dictionary.  Generated from database if
not provided.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>record_types</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.  Only
used for determining script relations if not specified.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>graph</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.graph.ScriptLinkGraph" href="#whatrecord.graph.ScriptLinkGraph">ScriptLinkGraph</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/graph.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">graph_script_relations</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScriptPVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptLinkGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a graphviz digraph of script links (i.e., inter-IOC record links).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>
<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>
<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>
<span class="sd">    script_relations : dict, optional</span>
<span class="sd">        Pre-built script relationship dictionary.  Generated from database if</span>
<span class="sd">        not provided.</span>
<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.  Only</span>
<span class="sd">        used for determining script relations if not specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    graph : ScriptLinkGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ScriptLinkGraph</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
        <span class="n">limit_to_records</span><span class="o">=</span><span class="n">limit_to_records</span><span class="p">,</span>
        <span class="n">relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
        <span class="n">script_relations</span><span class="o">=</span><span class="n">script_relations</span><span class="p">,</span>
        <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="shared">Shared</h2>


<div class="doc doc-object doc-module">



<h3 id="whatrecord.common" class="doc doc-heading">
          <code>whatrecord.common</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h4 id="whatrecord.common-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.AsynPortBase" class="doc doc-heading">
        <code>whatrecord.common.AsynPortBase</code>


</h5>


  <div class="doc doc-contents ">

  
      <p>Base class for general asyn ports.</p>
<p>Used in :mod:<code>whatrecord.asyn</code>, but made available here such that apischema
can find it more readily.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.DatabaseDevice" class="doc doc-heading">
        <code>whatrecord.common.DatabaseDevice</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A per-record-type device definition, part of a dbd file.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.DatabaseMenu" class="doc doc-heading">
        <code>whatrecord.common.DatabaseMenu</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>An enumeration (menu) from a dbd file.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.FileFormat" class="doc doc-heading">
        <code>whatrecord.common.FileFormat</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>str</code>, <code>enum.<span title="enum.Enum">Enum</span></code></p>

  
      <p>File type enum that covers all formats supported by whatrecord.</p>



  

  <div class="doc doc-children">







<h6 id="whatrecord.common.FileFormat-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.FileFormat.from_extension" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">from_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get a file format based on a file extension.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_extension</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a file format based on a file extension.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">iocsh</span><span class="p">,</span>
        <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
        <span class="s2">&quot;dbd&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">database_definition</span><span class="p">,</span>
        <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
        <span class="s2">&quot;substitutions&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">substitution</span><span class="p">,</span>
        <span class="s2">&quot;pvlist&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">gateway_pvlist</span><span class="p">,</span>
        <span class="s2">&quot;acf&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">access_security</span><span class="p">,</span>
        <span class="s2">&quot;proto&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">stream_protocol</span><span class="p">,</span>
        <span class="s2">&quot;st&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">state_notation</span><span class="p">,</span>
    <span class="p">}[</span><span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.FileFormat.from_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">FileFormat</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get a file format based on a full filename.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_filename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a file format based on a full filename.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">extension</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Makefile&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">makefile</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">from_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Could not determine file type from extension: </span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.GdbBinaryInfo" class="doc doc-heading">
        <code>whatrecord.common.GdbBinaryInfo</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>GDB-derived binary information.</p>
<p>This is populated by deserializing the output of
<code>whatrecord.plugins.gdb_binary_info</code>, which is interpreted by GDB itself.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocMetadata" class="doc doc-heading">
        <code>whatrecord.common.IocMetadata</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>Metadata identifying an IOC.</p>



  

  <div class="doc doc-children">





<h6 id="whatrecord.common.IocMetadata-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.IocMetadata.cache_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">cache_filename</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>The cache filename for this metadata.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.IocMetadata.database_version_spec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">database_version_spec</span><span class="p">:</span> <span class="nb">int</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Load databases with this specification.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>version_spec</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>If R3.15 or under, <code>3</code>, otherwise <code>4</code>.</p></td>
        </tr>
    </tbody>
  </table>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.IocMetadata.ioc_cache_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">ioc_cache_filename</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>The cache filename for the entire interpreted IOC.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.IocMetadata.looks_like_sh" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">looks_like_sh</span><span class="p">:</span> <span class="nb">bool</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Is the script likely sh/bash/etc?</p>
  </div>

</div>

<h6 id="whatrecord.common.IocMetadata-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.add_loaded_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">add_loaded_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Add filename to the loaded file dictionary, optionally updating an
existing hash.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[pathlib.<span title="pathlib.Path">Path</span>, str]</code>
          </td>
          <td><p>The filename.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>update</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Update a hash if the filename is already in the loaded_files
dictionary.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>bool</code>
          </td>
          <td><p>Set if a hash was updated in the loaded_files dictionary.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_loaded_file</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add filename to the loaded file dictionary, optionally updating an</span>
<span class="sd">    existing hash.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : Union[pathlib.Path, str]</span>
<span class="sd">        The filename.</span>
<span class="sd">    update : bool, optional</span>
<span class="sd">        Update a hash if the filename is already in the loaded_files</span>
<span class="sd">        dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    bool</span>
<span class="sd">        Set if a hash was updated in the loaded_files dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_file_sha256</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.from_cache" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">from_cache</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IocMetadata</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Load metadata from the cache, if available.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IocMetadata</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load metadata from the cache, if available.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="o">...</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
        <span class="c1"># Truncated output file, perhaps</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">iocdict</span><span class="p">:</span> <span class="n">IocInfoDict</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocMetadata</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Create an IocMetadata instance.</p>
<p>Pick apart a given <code>iocdict</code> dictionary, relegating extra info to
<code>.metadata</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>iocdict</code></td>
          <td>
                <code>dict</code>
          </td>
          <td><p>IOC information dictionary.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>macros</code></td>
          <td>
                <code>dict, optional</code>
          </td>
          <td><p>Additional macros to use at startup.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">iocdict</span><span class="p">:</span> <span class="n">IocInfoDict</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an IocMetadata instance.</span>

<span class="sd">    Pick apart a given ``iocdict`` dictionary, relegating extra info to</span>
<span class="sd">    ``.metadata``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iocdict : dict</span>
<span class="sd">        IOC information dictionary.</span>
<span class="sd">    macros : dict, optional</span>
<span class="sd">        Additional macros to use at startup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">iocdict</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">script</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">script</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">base_version</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;base_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
        <span class="n">startup_directory</span><span class="o">=</span><span class="n">script</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
        <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">script</span><span class="p">),</span>
        <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.from_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocMetadata</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Given at minimum a filename, guess the rest of the metadata.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>pathlib.Path or str</code>
          </td>
          <td><p>The IOC startup script filename.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>The name of the IOC.  Defaults to the startup script's parent
directory name.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>host</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>The host on which the IOC runs.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>port</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>The port on which the IOC will be accessible from the host.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>startup_directory</code></td>
          <td>
                <code>pathlib.<span title="pathlib.Path">Path</span>, optional</code>
          </td>
          <td><p>The directory in which the script should be started.  Defaults
to the parent directory of <code>filename</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>macros</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, str], optional</code>
          </td>
          <td><p>Macros to use when interpreting the startup script.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>standin_directories</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[str, str], optional</code>
          </td>
          <td><p>Stand-in directories to use when interpreting a script outside of
its normal environment.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>binary</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>The binary used to run the startup script normally. That is, an
EPICS IOC binary.  If not specified, this will be determined
based on the startup script hashbang (if available).</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>base_version</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>The epics-base version to use when interpreting the startup script.
This may be overridden automatically when interpreting the startup
script.</p></td>
          <td>
                <code>settings.DEFAULT_BASE_VERSION</code>
          </td>
        </tr>
        <tr>
          <td><code>**metadata</code></td>
          <td>
          </td>
          <td><p>User-specified metadata.</p></td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.IocMetadata" href="#whatrecord.common.IocMetadata">IocMetadata</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
    <span class="o">**</span><span class="n">metadata</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocMetadata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given at minimum a filename, guess the rest of the metadata.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : pathlib.Path or str</span>
<span class="sd">        The IOC startup script filename.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        The name of the IOC.  Defaults to the startup script&#39;s parent</span>
<span class="sd">        directory name.</span>
<span class="sd">    host : str, optional</span>
<span class="sd">        The host on which the IOC runs.</span>
<span class="sd">    port : int, optional</span>
<span class="sd">        The port on which the IOC will be accessible from the host.</span>
<span class="sd">    startup_directory : pathlib.Path, optional</span>
<span class="sd">        The directory in which the script should be started.  Defaults</span>
<span class="sd">        to the parent directory of ``filename``.</span>
<span class="sd">    macros : Dict[str, str], optional</span>
<span class="sd">        Macros to use when interpreting the startup script.</span>
<span class="sd">    standin_directories : Dict[str, str], optional</span>
<span class="sd">        Stand-in directories to use when interpreting a script outside of</span>
<span class="sd">        its normal environment.</span>
<span class="sd">    binary : str, optional</span>
<span class="sd">        The binary used to run the startup script normally. That is, an</span>
<span class="sd">        EPICS IOC binary.  If not specified, this will be determined</span>
<span class="sd">        based on the startup script hashbang (if available).</span>
<span class="sd">    base_version : str, optional</span>
<span class="sd">        The epics-base version to use when interpreting the startup script.</span>
<span class="sd">        This may be overridden automatically when interpreting the startup</span>
<span class="sd">        script.</span>
<span class="sd">    **metadata :</span>
<span class="sd">        User-specified metadata.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IocMetadata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># iocBoot/((ioc-something))/st.cmd</span>
    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="c1"># Sorry, we need something unique here (better ideas welcome)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">startup_directory</span><span class="o">=</span><span class="n">startup_directory</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">standin_directories</span><span class="o">=</span><span class="n">standin_directories</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.get_binary_information" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">get_binary_information</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GdbBinaryInfo</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get binary information using the GDB plugin.</p>
<p>Requires that gdb be available, along with the <code>.binary</code> be set
to a valid file.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_binary_information</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GdbBinaryInfo</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get binary information using the GDB plugin.</span>

<span class="sd">    Requires that gdb be available, along with the ``.binary`` be set</span>
<span class="sd">    to a valid file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">util</span><span class="o">.</span><span class="n">run_gdb</span><span class="p">(</span>
            <span class="s2">&quot;gdb_binary_info&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">=</span><span class="n">GdbBinaryInfo</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">apischema</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Failed to get gdb information for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Failed to get gdb information for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">error</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">base_version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">context</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_loaded_file</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;GDB source file does not exist for command </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span>
                <span class="p">)</span>
    <span class="k">return</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.is_up_to_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">is_up_to_date</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Is this IOC up-to-date with what is on disk?</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Is this IOC up-to-date with what is on disk?&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">check_files_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.save_to_cache" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">save_to_cache</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Save this metadata to the cache, if enabled.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save this metadata to the cache, if enabled.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocMetadata.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Update the metadata with a new set from an IOC Loader.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>other</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.IocMetadata" href="#whatrecord.common.IocMetadata">IocMetadata</a></code>
          </td>
          <td><p>The other IOC metadata to update this instance with.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>merge : bool, optional
    Merge in dictionary information, or overwrite it.  Defaults to
    'overwrite' (merge=False).</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the metadata with a new set from an IOC Loader.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : IocMetadata</span>
<span class="sd">        The other IOC metadata to update this instance with.</span>

<span class="sd">    merge : bool, optional</span>
<span class="sd">        Merge in dictionary information, or overwrite it.  Defaults to</span>
<span class="sd">        &#39;overwrite&#39; (merge=False).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">script</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">startup_directory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">host</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">other</span><span class="o">.</span><span class="n">base_version</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">base_version</span> <span class="o">!=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">merge</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">standin_directories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">standin_directories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshArgument" class="doc doc-heading">
        <code>whatrecord.common.IocshArgument</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A single argument in a shell command.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshCmdArgs" class="doc doc-heading">
        <code>whatrecord.common.IocshCmdArgs</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>iocshCmd(...) arguments.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshCommand" class="doc doc-heading">
        <code>whatrecord.common.IocshCommand</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A registered shell command.</p>
<p>Largely used as part of the gdb binary information tool.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshScript" class="doc doc-heading">
        <code>whatrecord.common.IocshScript</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>An IOC Shell script (i.e., st.cmd) that was loaded and interpreted.</p>



  

  <div class="doc doc-children">







<h6 id="whatrecord.common.IocshScript-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocshScript.from_general_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocshScript</span><span class="o">.</span><span class="n">from_general_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Create an IocshScript from any given file, even non-startup scripts.</p>
<p>This can be used to transfer database files over to the frontend, for
example.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[pathlib.<span title="pathlib.Path">Path</span>, str]</code>
          </td>
          <td><p>The filename.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_general_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an IocshScript from any given file, even non-startup scripts.</span>

<span class="sd">    This can be used to transfer database files over to the frontend, for</span>
<span class="sd">    example.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : Union[pathlib.Path, str]</span>
<span class="sd">        The filename.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># For use when shoehorning in a file that&#39;s not _really_ an IOC script</span>
    <span class="c1"># TODO: instead rework the api</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
            <span class="n">IocshResult</span><span class="p">(</span>
                <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">lineno</span><span class="p">),</span> <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocshScript.from_interpreted_script" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocshScript</span><span class="o">.</span><span class="n">from_interpreted_script</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="n">ShellState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Create an IocshScript provided a filename, its contents, and ShellState.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The script filename.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>contents</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The decoded string contents of the file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sh</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.shell.ShellState" href="../iocsh/#whatrecord.shell.ShellState">ShellState</a></code>
          </td>
          <td><p>The state of the shell interpreter after interpreting the IOC
startup script.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.IocshScript" href="#whatrecord.common.IocshScript">IocshScript</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_interpreted_script</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sh</span><span class="p">:</span> <span class="n">ShellState</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an IocshScript provided a filename, its contents, and ShellState.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The script filename.</span>
<span class="sd">    contents : str</span>
<span class="sd">        The decoded string contents of the file.</span>
<span class="sd">    sh : ShellState</span>
<span class="sd">        The state of the shell interpreter after interpreting the IOC</span>
<span class="sd">        startup script.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IocshScript</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">interpret_shell_script_text</span><span class="p">(</span>
                <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span>
                <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.IocshScript.from_metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocshScript</span><span class="o">.</span><span class="n">from_metadata</span><span class="p">(</span><span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="n">ShellState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Create an IocshScript provided IocMetadata and ShellState.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>md</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.IocMetadata" href="#whatrecord.common.IocMetadata">IocMetadata</a></code>
          </td>
          <td><p>Metadata identifying the IOC.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sh</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.shell.ShellState" href="../iocsh/#whatrecord.shell.ShellState">ShellState</a></code>
          </td>
          <td><p>The state of the shell interpreter after interpreting the IOC
startup script.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.IocshScript" href="#whatrecord.common.IocshScript">IocshScript</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_metadata</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="n">ShellState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an IocshScript provided IocMetadata and ShellState.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    md : IocMetadata</span>
<span class="sd">        Metadata identifying the IOC.</span>
<span class="sd">    sh : ShellState</span>
<span class="sd">        The state of the shell interpreter after interpreting the IOC</span>
<span class="sd">        startup script.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    IocshScript</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">md</span><span class="o">.</span><span class="n">looks_like_sh</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">md</span><span class="o">.</span><span class="n">base_version</span> <span class="o">==</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">:</span>
            <span class="n">md</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_general_file</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">),</span>
        <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
            <span class="n">sh</span><span class="o">.</span><span class="n">interpret_shell_script</span><span class="p">(</span>
                <span class="n">md</span><span class="o">.</span><span class="n">script</span>
            <span class="p">)</span>
        <span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshVariable" class="doc doc-heading">
        <code>whatrecord.common.IocshVariable</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A registered shell variable.</p>
<p>Largely used as part of the gdb binary information tool.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.LoadContext" class="doc doc-heading">
        <code>whatrecord.common.LoadContext</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>File and line context information.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.MutableLoadContext" class="doc doc-heading">
        <code>whatrecord.common.MutableLoadContext</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A mutable (i.e., changeable) version of :class:<code>LoadContext</code>.</p>



  

  <div class="doc doc-children">







<h6 id="whatrecord.common.MutableLoadContext-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.MutableLoadContext.to_load_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">MutableLoadContext</span><span class="o">.</span><span class="n">to_load_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">LoadContext</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Convert this to an immutable LoadContext.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert this to an immutable LoadContext.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">LoadContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.PVAFieldReference" class="doc doc-heading">
        <code>whatrecord.common.PVAFieldReference</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>Part of a PVAccess group which references another record.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordDefinitionAndInstance" class="doc doc-heading">
        <code>whatrecord.common.RecordDefinitionAndInstance</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A pair of V3 record definition and instance.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordField" class="doc doc-heading">
        <code>whatrecord.common.RecordField</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A field with a value, as part of a EPICS V3 RecordInstance.</p>



  

  <div class="doc doc-children">







<h6 id="whatrecord.common.RecordField-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordField.update_from_record_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="o">.</span><span class="n">update_from_record_type</span><span class="p">(</span><span class="n">record_type</span><span class="p">:</span> <span class="n">RecordType</span><span class="p">)</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Update field information given dbd-provided information.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_from_record_type</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">record_type</span><span class="p">:</span> <span class="n">RecordType</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update field information given dbd-provided information.&quot;&quot;&quot;</span>
    <span class="n">record_type_field</span> <span class="o">=</span> <span class="n">record_type</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">record_type_field</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">record_type_field</span><span class="o">.</span><span class="n">type</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordField.update_unknowns" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecordField</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unknown_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>If this RecordField has some missing information ("unknown"), fill
it in with information from the other field.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_unknowns</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">other</span><span class="p">:</span> <span class="n">RecordField</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">unknown_values</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If this RecordField has some missing information (&quot;unknown&quot;), fill</span>
<span class="sd">    it in with information from the other field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unknown_values</span> <span class="o">=</span> <span class="n">unknown_values</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;(unknown-record)&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unknown_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unknown_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ctx</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
            <span class="c1"># Even if the other context is unknown, let&#39;s take it anyway:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">context</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordInstance" class="doc doc-heading">
        <code>whatrecord.common.RecordInstance</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>An instance of a RecordType, loaded from a db file.</p>



  

  <div class="doc doc-children">





<h6 id="whatrecord.common.RecordInstance-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.RecordInstance.access_security_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">access_security_group</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>The access security group name for the record.</p>
  </div>

</div>

<h6 id="whatrecord.common.RecordInstance-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordInstance.get_fields_of_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get all fields of the matching type(s).</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fields_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all fields of the matching type(s).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">fld</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordInstance.get_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">get_links</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get all links - in, out, and forward links - for this record.</p>
<p>Requires that a dbd file was loaded when the record was created.
Alternatively, see :func:<code>RecordType.get_links_for_record</code>.</p>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>field</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.RecordField" href="#whatrecord.common.RecordField">RecordField</a></code>
          </td>
          <td></td>
        </tr>
        <tr>
<td><code>link_text</code></td>          <td>
                <code>str</code>
          </td>
          <td></td>
        </tr>
        <tr>
<td><code>link_info</code></td>          <td>
                <code>str</code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all links - in, out, and forward links - for this record.</span>

<span class="sd">    Requires that a dbd file was loaded when the record was created.</span>
<span class="sd">    Alternatively, see :func:`RecordType.get_links_for_record`.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    field : RecordField</span>
<span class="sd">    link_text: str</span>
<span class="sd">    link_info: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">LINK_TYPES</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_link_information</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">fld</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordInstance.to_summary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">to_summary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">RecordInstanceSummary</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Return a summarized version of the record instance.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstanceSummary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a summarized version of the record instance.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">RecordInstanceSummary</span><span class="o">.</span><span class="n">from_record_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordInstance.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LinterMessage</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Update this record instance with another.</p>
<p>TODO: This may not do exactly what an IOC would do.
TODO: Return type?</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LinterMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update this record instance with another.</span>

<span class="sd">    TODO: This may not do exactly what an IOC would do.</span>
<span class="sd">    TODO: Return type?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_pva</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">LinterError</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;combine_pva_and_v3&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Cannot combine PVA group with V3 record&quot;</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">remove_redundant_context</span><span class="p">(</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">aliases</span> <span class="k">if</span> <span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">has_dbd_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_dbd_info</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">has_dbd_info</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">record_type</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">LinterError</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;record_type_mismatch&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Record type mismatch in provided database files: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">record_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">record_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordInstanceSummary" class="doc doc-heading">
        <code>whatrecord.common.RecordInstanceSummary</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>An abbreviated form of :class:<code>RecordInstance</code>.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordType" class="doc doc-heading">
        <code>whatrecord.common.RecordType</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>An EPICS V3 record type definition, part of a database definition (dbd).</p>



  

  <div class="doc doc-children">







<h6 id="whatrecord.common.RecordType-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordType.get_fields_of_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordTypeField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get all fields of the matching type(s).</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_fields_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">types</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordTypeField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all fields of the matching type(s).&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">fld</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordType.get_link_fields" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="o">.</span><span class="n">get_link_fields</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordTypeField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get all link fields - in, out, and forward links.</p>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>field</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.RecordTypeField" href="#whatrecord.common.RecordTypeField">RecordTypeField</a></code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_link_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordTypeField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all link fields - in, out, and forward links.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    field : RecordTypeField</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">LINK_TYPES</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordType.get_links_for_record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="o">.</span><span class="n">get_links_for_record</span><span class="p">(</span><span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get all links - in, out, and forward links - for the given record.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>record</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.RecordInstance" href="#whatrecord.common.RecordInstance">RecordInstance</a></code>
          </td>
          <td><p>Additional information, if the database definition wasn't loaded
with this instance.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>field</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="whatrecord.common.RecordField" href="#whatrecord.common.RecordField">RecordField</a></code>
          </td>
          <td></td>
        </tr>
        <tr>
<td><code>link_text</code></td>          <td>
                <code>str</code>
          </td>
          <td></td>
        </tr>
        <tr>
<td><code>link_info</code></td>          <td>
                <code>str</code>
          </td>
          <td></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_links_for_record</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">:</span> <span class="n">RecordInstance</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all links - in, out, and forward links - for the given record.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    record : RecordInstance</span>
<span class="sd">        Additional information, if the database definition wasn&#39;t loaded</span>
<span class="sd">        with this instance.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    field : RecordField</span>
<span class="sd">    link_text: str</span>
<span class="sd">    link_info: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">record_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Record types do not match&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">field_type_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">LINK_TYPES</span><span class="p">):</span>
        <span class="n">field_instance</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_type_info</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field_instance</span><span class="p">,</span> <span class="n">PVAFieldReference</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_link_information</span><span class="p">(</span><span class="n">field_instance</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">field_instance</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordTypeField" class="doc doc-heading">
        <code>whatrecord.common.RecordTypeField</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>An EPICS V3 RecordType field definition, part of a database definition (dbd).</p>



  

  <div class="doc doc-children">







<h6 id="whatrecord.common.RecordTypeField-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.RecordTypeField.get_all_set_entries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordTypeField</span><span class="o">.</span><span class="n">get_all_set_entries</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get all field entries that have been set in the database definition.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>dict</code>
          </td>
          <td><p>e.g., {"initial": "5"}</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_set_entries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all field entries that have been set in the database definition.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        e.g., {&quot;initial&quot;: &quot;5&quot;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="c1"># Order defined in dbStaticLib.c</span>
        <span class="s2">&quot;prompt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;initial&quot;</span><span class="p">,</span>
        <span class="s2">&quot;promptgroup&quot;</span><span class="p">,</span>
        <span class="s2">&quot;special&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extra&quot;</span><span class="p">,</span>
        <span class="s2">&quot;menu&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;base&quot;</span><span class="p">,</span>
        <span class="s2">&quot;interest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;asl&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entries</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="n">entries</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entries</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.ShellStateHandler" class="doc doc-heading">
        <code>whatrecord.common.ShellStateHandler</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>A helper to work with interpreting commands from shell scripts.</p>



  

  <div class="doc doc-children">





<h6 id="whatrecord.common.ShellStateHandler-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.ShellStateHandler.sub_handlers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ShellStateHandler</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Handlers which contain their own state.</p>
  </div>

</div>

<h6 id="whatrecord.common.ShellStateHandler-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.ShellStateHandler.annotate_record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Annotate the given record's metadata with state-related information.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annotate the given record&#39;s metadata with state-related information.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.ShellStateHandler.find_handlers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">find_handlers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Find all IOC shell command handlers by name.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find all IOC shell command handlers by name.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">handler_obj</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">handler_obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;handle_&quot;</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">handler_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span>

        <span class="k">if</span> <span class="n">handler_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">handler_obj</span><span class="o">.</span><span class="n">find_handlers</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.ShellStateHandler.generic_handler_decorator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">generic_handler_decorator</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stub</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>Decorate a handler method to generically return parameter-to-value
information.</p>
<p>This can be in addition to or in place of GDB command information.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>The <code>handler_</code> method.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>stub : bool, optional
    Mark this as a stub method.  Variable arguments will be filled in
    as necessary, even if defaults are not provided.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">generic_handler_decorator</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorate a handler method to generically return parameter-to-value</span>
<span class="sd">    information.</span>

<span class="sd">    This can be in addition to or in place of GDB command information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : callable</span>
<span class="sd">        The ``handler_`` method.</span>

<span class="sd">    stub : bool, optional</span>
<span class="sd">        Mark this as a stub method.  Variable arguments will be filled in</span>
<span class="sd">        as necessary, even if defaults are not provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
            <span class="k">else</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span>
        <span class="p">)</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stub</span><span class="p">:</span>
                <span class="c1"># Pad unspecified arguments with defaults or &quot;None&quot;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">defaults</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;argument_lint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Too many arguments&quot;</span>

            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;arguments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">),</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">call_result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">call_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">call_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrap</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.ShellStateHandler.get_load_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get a FullLoadContext tuple representing where we are now.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a FullLoadContext tuple representing where we are now.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.ShellStateHandler.post_ioc_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">post_ioc_init</span><span class="p">()</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Post-iocInit hook.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">post_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Post-iocInit hook.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.common.ShellStateHandler.pre_ioc_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">pre_ioc_init</span><span class="p">()</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Pre-iocInit hook.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pre_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pre-iocInit hook.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.StringWithContext" class="doc doc-heading">
        <code>whatrecord.common.StringWithContext</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>str</code></p>

  
      <p>A string with LoadContext.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.UnquotedString" class="doc doc-heading">
        <code>whatrecord.common.UnquotedString</code>


</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>str</code></p>

  
      <p>An unquoted string token found when loading a database file.
May be a linter warning.</p>



  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.common.WhatRecord" class="doc doc-heading">
        <code>whatrecord.common.WhatRecord</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">

  
      <p>WhatRecord - full set of information regarding a specific record.</p>
<p>This response is on a per-IOC basis, so at most it can return one V3 record
and one V4 record, as these exist in separate namespaces.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The record name.</p></td>
        </tr>
    </tbody>
  </table>
      <p>record : RecordDefinitionAndInstance, optional
    The V3 record definition (if available) and record instance.</p>
<p>pva_group : RecordInstance, optional
    The PVAccess group, if available.</p>
<p>ioc : IocMetadata, optional
    The associated IOC metadata, if available.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>
<h4 id="whatrecord.common-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.common.context_from_lark_token" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">context_from_lark_token</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get a full load context from a given lark Token.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">context_from_lark_token</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a full load context from a given lark Token.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">line</span><span class="p">),</span> <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.common.get_grammar_version_by_base_version" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">get_grammar_version_by_base_version</span><span class="p">(</span><span class="n">base_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Database grammar version to use, provided the epics-base version.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>base_version</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The epics-base version number.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>int</code>
          </td>
          <td><p>If R3.15 or under, <code>3</code>, otherwise <code>4</code>.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_grammar_version_by_base_version</span><span class="p">(</span><span class="n">base_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Database grammar version to use, provided the epics-base version.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    base_version : str</span>
<span class="sd">        The epics-base version number.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        If R3.15 or under, ``3``, otherwise ``4``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_version</span> <span class="o">=</span> <span class="n">base_version</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;vRr&quot;</span><span class="p">)</span>
    <span class="n">major_minor</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
        <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">major_minor</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">else</span> <span class="mi">4</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.common.get_link_information" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">get_link_information</span><span class="p">(</span><span class="n">link_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Get link information from a DBF_{IN,OUT,FWD}LINK value.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_link_information</span><span class="p">(</span><span class="n">link_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get link information from a DBF_{IN,OUT,FWD}LINK value.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link_str</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;JSON and PVAccess links are a TODO (sorry!)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unexpected and supported type for get_link_information: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">link_str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">link_str</span><span class="p">:</span>
        <span class="c1"># strip off PP/MS/etc (TODO might be useful later)</span>
        <span class="n">link_str</span><span class="p">,</span> <span class="n">additional_info</span> <span class="o">=</span> <span class="n">link_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">additional_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">link_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">):</span>
        <span class="c1"># TODO asyn/device links</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;asyn link&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">link_str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;empty link&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">link_str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
        <span class="c1"># 0 or 1 usually and not a string</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;integral link&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">link_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Good, we don&#39;t want a float</span>
        <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;float link&quot;</span><span class="p">)</span>

    <span class="n">link_details</span> <span class="o">=</span> <span class="n">additional_info</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">link_str</span><span class="p">,</span> <span class="n">link_details</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.common.remove_redundant_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">remove_redundant_context</span><span class="p">(</span><span class="n">full_context</span><span class="p">:</span> <span class="n">FullLoadContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Remove redundant context information if it does not add anything.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_redundant_context</span><span class="p">(</span><span class="n">full_context</span><span class="p">:</span> <span class="n">FullLoadContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove redundant context information if it does not add anything.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full_context</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">full_context</span>

    <span class="c1"># Inefficient, but the data set is small here, so meh</span>
    <span class="n">zero_line_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">item</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">full_context</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">zero_line_files</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">full_context</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">ctx</span><span class="o">.</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zero_line_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">new_context</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">full_context</span><span class="p">:</span>
        <span class="n">is_specific</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zero_line_files</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">is_specific</span> <span class="ow">and</span> <span class="n">ctx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_context</span><span class="p">:</span>
            <span class="n">new_context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.common.time_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">time_context</span><span class="p">()</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Return a callable to measure the time since context manager init.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/common.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">time_context</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a callable to measure the time since context manager init.&quot;&quot;&quot;</span>
    <span class="n">start_count</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_count</span>

    <span class="k">yield</span> <span class="n">inner</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div><h2 id="miscellaneous">Miscellaneous</h2>


<div class="doc doc-object doc-module">



<h3 id="whatrecord.cache" class="doc doc-heading">
          <code>whatrecord.cache</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h4 id="whatrecord.cache-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.cache.CacheKey" class="doc doc-heading">
        <code>whatrecord.cache.CacheKey</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">




  

  <div class="doc doc-children">







<h6 id="whatrecord.cache.CacheKey-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.cache.CacheKey.to_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">CacheKey</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Get the cache filename.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/cache.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the cache filename.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>

    <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_cache_key_part</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">by_name</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">value_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">sha</span> <span class="o">=</span> <span class="n">get_bytes_sha256</span><span class="p">(</span><span class="n">value_repr</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sha</span><span class="si">}</span><span class="s2">.json&quot;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.cache.Cached" class="doc doc-heading">
        <code>whatrecord.cache.Cached</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="whatrecord.cache._Cached">_Cached</span></code></p>

  
      <p>A generic dataclass that can be cached in <code>WHATRECORD_CACHE_PATH</code>.</p>
<p>Expects to be subclassed and configured with a CacheKey subclass.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.cache.InlineCached" class="doc doc-heading">
        <code>whatrecord.cache.InlineCached</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="whatrecord.cache._Cached">_Cached</span></code></p>

  
      <p>A generic dataclass that can be cached in <code>WHATRECORD_CACHE_PATH</code>.</p>
<p>Expects to be subclassed and mixed in with a CacheKey subclass.</p>



  

  <div class="doc doc-children">





<h6 id="whatrecord.cache.InlineCached-attributes">Attributes</h6>

<div class="doc doc-object doc-attribute">



<h7 id="whatrecord.cache.InlineCached.key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">InlineCached</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">CacheKey</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h7>


  <div class="doc doc-contents ">
  
      <p>An auto-generated CacheKey based on this dataclass's attributes.</p>
  </div>

</div>





  </div>

  </div>

</div>
<h4 id="whatrecord.cache-functions">Functions</h4>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="whatrecord.format" class="doc doc-heading">
          <code>whatrecord.format</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h4 id="whatrecord.format-classes">Classes</h4>

<div class="doc doc-object doc-class">



<h5 id="whatrecord.format.FormatContext" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">FormatContext</span><span class="p">(</span><span class="n">helpers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FormatOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">trim_blocks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">lstrip_blocks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">default_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">env_kwargs</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">



          <details class="quote">
            <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/format.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">helpers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FormatOptions</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">trim_blocks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">lstrip_blocks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">default_options</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;console&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">env_kwargs</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span> <span class="o">=</span> <span class="n">helpers</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">locals</span><span class="p">,</span> <span class="n">json</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_options</span> <span class="o">=</span> <span class="n">default_options</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_template_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
        <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">DictLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template_dict</span><span class="p">),</span>
        <span class="n">trim_blocks</span><span class="o">=</span><span class="n">trim_blocks</span><span class="p">,</span>
        <span class="n">lstrip_blocks</span><span class="o">=</span><span class="n">lstrip_blocks</span><span class="p">,</span>
        <span class="o">**</span><span class="n">env_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">format_options</span> <span class="o">=</span> <span class="n">options</span> <span class="ow">or</span> <span class="n">FormatOptions</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filters</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">default_render_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_render_context</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_formats</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">







<h6 id="whatrecord.format.FormatContext-functions">Functions</h6>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.format.FormatContext.get_filters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">FormatContext</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="o">**</span><span class="n">user_config</span><span class="p">)</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>All jinja filters.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/format.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">user_config</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;All jinja filters.&quot;&quot;&quot;</span>

    <span class="nd">@pass_eval_context</span>
    <span class="k">def</span> <span class="nf">title_fill</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fill_char</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fill_char</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@pass_eval_context</span>
    <span class="k">def</span> <span class="nf">classname</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="nd">@pass_eval_context</span>
    <span class="k">def</span> <span class="nf">render_object</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h7 id="whatrecord.format.FormatContext.get_render_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">FormatContext</span><span class="o">.</span><span class="n">get_render_context</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h7>


  <div class="doc doc-contents ">
  
      <p>Jinja template context dictionary - helper functions.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/format.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Jinja template context dictionary - helper functions.&quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="n">func</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="p">}</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;_fmt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_options</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;_json_dump&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format_options</span><span class="o">.</span><span class="n">indent</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="s2">&quot;_indent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_options</span><span class="o">.</span><span class="n">indent</span> <span class="o">*</span> <span class="s2">&quot; &quot;</span>
    <span class="k">return</span> <span class="n">context</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="whatrecord.graphql" class="doc doc-heading">
          <code>whatrecord.graphql</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h4 id="whatrecord.graphql-classes">Classes</h4>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="whatrecord.settings" class="doc doc-heading">
          <code>whatrecord.settings</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="whatrecord.util" class="doc doc-heading">
          <code>whatrecord.util</code>


</h3>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">







<h4 id="whatrecord.util-functions">Functions</h4>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.check_files_up_to_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">check_files_up_to_date</span><span class="p">(</span><span class="n">file_to_hash</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Check if the provided files are up-to-date by way of recorded hash vs
current hash.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>file_to_hash</code></td>
          <td>
                <code><span title="typing.Dict">Dict</span>[<span title="typing.Union">Union</span>[str, pathlib.<span title="pathlib.Path">Path</span>], str]</code>
          </td>
          <td><p>File path to hash.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>up_to_date</code></td>          <td>
                <code>bool</code>
          </td>
          <td><p>If all files maintain their stored hashes, returns True.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_files_up_to_date</span><span class="p">(</span>
    <span class="n">file_to_hash</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the provided files are up-to-date by way of recorded hash vs</span>
<span class="sd">    current hash.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_to_hash : Dict[Union[str, pathlib.Path], str]</span>
<span class="sd">        File path to hash.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    up_to_date : bool</span>
<span class="sd">        If all files maintain their stored hashes, returns True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">file_hash</span> <span class="ow">in</span> <span class="n">file_to_hash</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_file_sha256</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">!=</span> <span class="n">file_hash</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.find_binary_from_hashbang" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">startup_script</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span> <span class="n">must_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Find the binary associated with a given startup script by looking at its
shebang.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>binary_path</code></td>          <td>
                <code>str or None</code>
          </td>
          <td><p>The path to the binary, if available.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_binary_from_hashbang</span><span class="p">(</span>
    <span class="n">startup_script</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span>
    <span class="n">must_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the binary associated with a given startup script by looking at its</span>
<span class="sd">    shebang.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    binary_path : str or None</span>
<span class="sd">        The path to the binary, if available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">startup_script</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">startup_script</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">first_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#!&quot;</span><span class="p">):</span>
        <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">startup_script</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">parent_dir</span> <span class="o">/</span> <span class="n">first_line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#!&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">must_exist</span> <span class="ow">or</span> <span class="n">binary</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">binary</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.get_bytes_sha256" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Hash a byte string with the SHA-256 algorithm.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_bytes_sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hash a byte string with the SHA-256 algorithm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.get_file_sha256" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_file_sha256</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Hash a binary with the SHA-256 algorithm.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_file_sha256</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hash a binary with the SHA-256 algorithm.&quot;&quot;&quot;</span>
    <span class="c1"># This doesn&#39;t do any sort of buffering; but our binaries are pretty small</span>
    <span class="c1"># in comparison to what we&#39;re storing as metadata, anyway</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.lines_between" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">lines_between</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">include_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>From a block of text, yield all lines between <code>start_marker</code> and
<code>end_marker</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>text</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The block of text</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>start_marker</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The block-starting marker to match</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>end_marker</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The block-ending marker to match</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>include_blank</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Skip yielding blank lines</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Yields:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>line</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>Line of text found between the markers.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lines_between</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">include_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    From a block of text, yield all lines between `start_marker` and</span>
<span class="sd">    `end_marker`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The block of text</span>
<span class="sd">    start_marker : str</span>
<span class="sd">        The block-starting marker to match</span>
<span class="sd">    end_marker : str</span>
<span class="sd">        The block-ending marker to match</span>
<span class="sd">    include_blank : bool, optional</span>
<span class="sd">        Skip yielding blank lines</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    line : str</span>
<span class="sd">        Line of text found between the markers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found_start</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">start_marker</span> <span class="o">=</span> <span class="n">start_marker</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">end_marker</span> <span class="o">=</span> <span class="n">end_marker</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">line_lowercase</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line_lowercase</span> <span class="o">==</span> <span class="n">start_marker</span><span class="p">:</span>
            <span class="n">found_start</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">found_start</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line_lowercase</span> <span class="o">==</span> <span class="n">end_marker</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">line_lowercase</span> <span class="ow">or</span> <span class="n">include_blank</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">line</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.read_text_file_with_hash" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">read_text_file_with_hash</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;latin-1&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Hash a binary with the SHA-256 algorithm.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">read_text_file_with_hash</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Hash a binary with the SHA-256 algorithm.&quot;&quot;&quot;</span>
    <span class="c1"># This doesn&#39;t do any sort of buffering; but our binaries are pretty small</span>
    <span class="c1"># in comparison to what we&#39;re storing as metadata, anyway</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">contents</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.run_gdb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">run_gdb</span><span class="p">(</span><span class="n">script</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdb_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Run a script and deserialize its output.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>script</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The script name to run (whatrecord.<strong>script</strong>, omitting .py)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <p>binary : str or pathlib.Path
    The binary file to load into GDB.</p>
<p>cls : type
    The dataclass type to deserialize gdb's output to.</p>
<p>args : list, optional
    List of string arguments to pass to gdb.</p>
<p>gdb_path : str, optional
    The path to the gdb binary.  Defaults to <code>WHATRECORD_GDB_PATH</code>
    from the environment (<code>gdb</code>).</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">run_gdb</span><span class="p">(</span>
    <span class="n">script</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">binary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gdb_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a script and deserialize its output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    script : str</span>
<span class="sd">        The script name to run (whatrecord.__script__, omitting .py)</span>

<span class="sd">    binary : str or pathlib.Path</span>
<span class="sd">        The binary file to load into GDB.</span>

<span class="sd">    cls : type</span>
<span class="sd">        The dataclass type to deserialize gdb&#39;s output to.</span>

<span class="sd">    args : list, optional</span>
<span class="sd">        List of string arguments to pass to gdb.</span>

<span class="sd">    gdb_path : str, optional</span>
<span class="sd">        The path to the gdb binary.  Defaults to ``WHATRECORD_GDB_PATH``</span>
<span class="sd">        from the environment (``gdb``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cache_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">)</span>
    <span class="n">binary_hash</span> <span class="o">=</span> <span class="n">get_file_sha256</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

    <span class="n">hash_filename</span> <span class="o">=</span> <span class="n">cache_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">binary_hash</span><span class="si">}</span><span class="s2">.json&quot;</span>
    <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">use_cache</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hash_filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="o">...</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to load cached gdb information from disk; &quot;</span>
                    <span class="s2">&quot;re-running gdb (</span><span class="si">%s</span><span class="s2">, filename=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">ex</span><span class="p">,</span>
                    <span class="n">hash_filename</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="n">script_path</span> <span class="o">=</span> <span class="n">MODULE_PATH</span> <span class="o">/</span> <span class="s2">&quot;plugins&quot;</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s2">.py&quot;</span>
    <span class="n">gdb_path</span> <span class="o">=</span> <span class="n">gdb_path</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">GDB_PATH</span>
    <span class="n">to_execute</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">gdb_path</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
        <span class="sa">f</span><span class="s2">&quot;--batch-silent &quot;</span>
        <span class="sa">f</span><span class="s1">&#39;--command &quot;</span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;--args &quot;</span><span class="si">{</span><span class="n">binary</span><span class="si">}</span><span class="s1">&quot; </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>

    <span class="n">json_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_script_with_json_output</span><span class="p">(</span><span class="n">to_execute</span><span class="p">)</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">json_data</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hash_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">ex</span><span class="o">.</span><span class="n">json_data</span> <span class="o">=</span> <span class="n">json_data</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.run_script_with_json_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">run_script_with_json_output</span><span class="p">(</span><span class="n">script_line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">log_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h5>


  <div class="doc doc-contents ">
  
      <p>Run a script and get its JSON output.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script_with_json_output</span><span class="p">(</span>
    <span class="n">script_line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="n">log_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run a script and get its JSON output.&quot;&quot;&quot;</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_shell</span><span class="p">(</span>
        <span class="n">script_line</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">stderr</span> <span class="ow">and</span> <span class="n">log_errors</span><span class="p">:</span>
        <span class="n">stderr_text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">),</span> <span class="s2">&quot;    ! &quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Standard error output while running script (</span><span class="si">%r</span><span class="s2">):</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">script_line</span><span class="p">,</span> <span class="n">stderr_text</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">stdout</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">log_errors</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;No standard output while running script (</span><span class="si">%r</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">script_line</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h5 id="whatrecord.util.write_to_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">write_to_file</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">catch_broken_pipe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Write <code>obj</code> to <code>filename</code> in the specified <code>format</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>obj</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td><p>The object to write to the file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[str], optional</code>
          </td>
          <td><p>If None, defaults to standard output.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>format</code></td>
          <td>
                <code>str, optional</code>
          </td>
          <td><p>The format to use.  "json" is supported for all types. Other types
may only support "console" or "file".</p></td>
          <td>
                <code>&#39;json&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>data</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>The data written to the file.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.9.16/x64/lib/python3.9/site-packages/whatrecord/util.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
    <span class="n">catch_broken_pipe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write ``obj`` to ``filename`` in the specified ``format``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : Any</span>
<span class="sd">        The object to write to the file.</span>
<span class="sd">    filename : Optional[str], optional</span>
<span class="sd">        If None, defaults to standard output.</span>
<span class="sd">    format : str, optional</span>
<span class="sd">        The format to use.  &quot;json&quot; is supported for all types. Other types</span>
<span class="sd">        may only support &quot;console&quot; or &quot;file&quot;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    data : str</span>
<span class="sd">        The data written to the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
        <span class="n">json_info</span> <span class="o">=</span> <span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">to_write</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_info</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">INDENT</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">.format</span> <span class="kn">import</span> <span class="n">FormatContext</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="n">FormatContext</span><span class="p">()</span>
        <span class="n">to_write</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">to_write</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">BrokenPipeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">catch_broken_pipe</span><span class="p">:</span>
                <span class="k">raise</span>

            <span class="c1"># Ref: https://docs.python.org/3/library/signal.html#note-on-sigpipe</span>
            <span class="c1"># Python flushes standard streams on exit; redirect remaining</span>
            <span class="c1"># output to devnull to avoid another BrokenPipeError at shutdown</span>
            <span class="n">devnull</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">devnull</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">fileno</span><span class="p">())</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Python exits with error code 1 on EPIPE</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">to_write</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">to_write</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      (C) 2023 SLAC National Accelerator Laboratory
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.integrate"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>