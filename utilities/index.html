
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="SLAC National Accelerator Laboratory">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.7">
    
    
      
        <title>Shared / Utilities - whatrecord</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cd566b2a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="lightblue" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#shared-utilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="whatrecord" class="md-header__button md-logo" aria-label="whatrecord" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            whatrecord
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Shared / Utilities
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="lightblue" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      whatrecord
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../parsers/" class="md-tabs__link">
      Parsers
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../cli/" class="md-tabs__link">
      CLI
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../server_client/" class="md-tabs__link">
      Server / client
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../plugins/" class="md-tabs__link">
      Plugins
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      Shared / Utilities
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../iocsh/" class="md-tabs__link">
      IOC Shell-Related
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../lcls/" class="md-tabs__link">
      LCLS
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../tests/" class="md-tabs__link">
      Tests
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="whatrecord" class="md-nav__button md-logo" aria-label="whatrecord" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.924 7.924 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.924 7.924 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.924 7.924 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.924 7.924 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69L4.41 3M12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6z"/></svg>

    </a>
    whatrecord
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        whatrecord
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parsers/" class="md-nav__link">
        Parsers
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        CLI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../server_client/" class="md-nav__link">
        Server / client
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Shared / Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Shared / Utilities
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    Macros
  </a>
  
    <nav class="md-nav" aria-label="Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro" class="md-nav__link">
    macro
  </a>
  
    <nav class="md-nav" aria-label="macro">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.macro.macros_from_string" class="md-nav__link">
    macros_from_string()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pv-graphing" class="md-nav__link">
    PV Graphing
  </a>
  
    <nav class="md-nav" aria-label="PV Graphing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph" class="md-nav__link">
    graph
  </a>
  
    <nav class="md-nav" aria-label="graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.GraphEdge" class="md-nav__link">
    GraphEdge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.GraphNode" class="md-nav__link">
    GraphNode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.LinkInfo" class="md-nav__link">
    LinkInfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.RecordLinkGraph" class="md-nav__link">
    RecordLinkGraph
  </a>
  
    <nav class="md-nav" aria-label="RecordLinkGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.RecordLinkGraph-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.ScriptLinkGraph" class="md-nav__link">
    ScriptLinkGraph
  </a>
  
    <nav class="md-nav" aria-label="ScriptLinkGraph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.ScriptLinkGraph-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.build_database_relations" class="md-nav__link">
    build_database_relations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.combine_relations" class="md-nav__link">
    combine_relations()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.find_record_links" class="md-nav__link">
    find_record_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.graph_links" class="md-nav__link">
    graph_links()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graph.graph_script_relations" class="md-nav__link">
    graph_script_relations()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shared" class="md-nav__link">
    Shared
  </a>
  
    <nav class="md-nav" aria-label="Shared">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common" class="md-nav__link">
    common
  </a>
  
    <nav class="md-nav" aria-label="common">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.AsynPortBase" class="md-nav__link">
    AsynPortBase
  </a>
  
    <nav class="md-nav" aria-label="AsynPortBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.AsynPortBase-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.DatabaseDevice" class="md-nav__link">
    DatabaseDevice
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.DatabaseMenu" class="md-nav__link">
    DatabaseMenu
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.FileFormat" class="md-nav__link">
    FileFormat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.GdbBinaryInfo" class="md-nav__link">
    GdbBinaryInfo
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocMetadata" class="md-nav__link">
    IocMetadata
  </a>
  
    <nav class="md-nav" aria-label="IocMetadata">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocMetadata-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocMetadata-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshArgument" class="md-nav__link">
    IocshArgument
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshCmdArgs" class="md-nav__link">
    IocshCmdArgs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshCommand" class="md-nav__link">
    IocshCommand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshResult" class="md-nav__link">
    IocshResult
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshScript" class="md-nav__link">
    IocshScript
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.IocshVariable" class="md-nav__link">
    IocshVariable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.LinterError" class="md-nav__link">
    LinterError
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.LinterMessage" class="md-nav__link">
    LinterMessage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.LinterWarning" class="md-nav__link">
    LinterWarning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.LoadContext" class="md-nav__link">
    LoadContext
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.MutableLoadContext" class="md-nav__link">
    MutableLoadContext
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.PVAFieldReference" class="md-nav__link">
    PVAFieldReference
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordDefinitionAndInstance" class="md-nav__link">
    RecordDefinitionAndInstance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordField" class="md-nav__link">
    RecordField
  </a>
  
    <nav class="md-nav" aria-label="RecordField">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordField-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstance" class="md-nav__link">
    RecordInstance
  </a>
  
    <nav class="md-nav" aria-label="RecordInstance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstance-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstance-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordInstanceSummary" class="md-nav__link">
    RecordInstanceSummary
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordType" class="md-nav__link">
    RecordType
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.RecordTypeField" class="md-nav__link">
    RecordTypeField
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.ShellStateHandler" class="md-nav__link">
    ShellStateHandler
  </a>
  
    <nav class="md-nav" aria-label="ShellStateHandler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.ShellStateHandler-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.ShellStateHandler-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.StringWithContext" class="md-nav__link">
    StringWithContext
  </a>
  
    <nav class="md-nav" aria-label="StringWithContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.StringWithContext-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.WhatRecord" class="md-nav__link">
    WhatRecord
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.context_from_lark_token" class="md-nav__link">
    context_from_lark_token()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.get_link_information" class="md-nav__link">
    get_link_information()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.remove_redundant_context" class="md-nav__link">
    remove_redundant_context()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.common.time_context" class="md-nav__link">
    time_context()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
    <nav class="md-nav" aria-label="Miscellaneous">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache" class="md-nav__link">
    cache
  </a>
  
    <nav class="md-nav" aria-label="cache">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.CacheKey" class="md-nav__link">
    CacheKey
  </a>
  
    <nav class="md-nav" aria-label="CacheKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.CacheKey-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.Cached" class="md-nav__link">
    Cached
  </a>
  
    <nav class="md-nav" aria-label="Cached">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.Cached-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.InlineCached" class="md-nav__link">
    InlineCached
  </a>
  
    <nav class="md-nav" aria-label="InlineCached">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.InlineCached-attributes" class="md-nav__link">
    Attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.cache.InlineCached-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.format" class="md-nav__link">
    format
  </a>
  
    <nav class="md-nav" aria-label="format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format.FormatContext" class="md-nav__link">
    FormatContext
  </a>
  
    <nav class="md-nav" aria-label="FormatContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format.FormatContext-methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.format-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.format.template_from_dataclass" class="md-nav__link">
    template_from_dataclass()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.graphql" class="md-nav__link">
    graphql
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.settings" class="md-nav__link">
    settings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util" class="md-nav__link">
    util
  </a>
  
    <nav class="md-nav" aria-label="util">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.util-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.check_files_up_to_date" class="md-nav__link">
    check_files_up_to_date()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.find_binary_from_hashbang" class="md-nav__link">
    find_binary_from_hashbang()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.get_bytes_sha256" class="md-nav__link">
    get_bytes_sha256()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.get_file_sha256" class="md-nav__link">
    get_file_sha256()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.lines_between" class="md-nav__link">
    lines_between()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.read_text_file_with_hash" class="md-nav__link">
    read_text_file_with_hash()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.run_gdb" class="md-nav__link">
    run_gdb()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whatrecord.util.run_script_with_json_output" class="md-nav__link">
    run_script_with_json_output()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../iocsh/" class="md-nav__link">
        IOC Shell-Related
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../lcls/" class="md-nav__link">
        LCLS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="shared-utilities">Shared / Utilities</h1>
<h2 id="macros">Macros</h2>
<p>EPICS-compliant macro parsing by way of a Cython wrapper of macLib.</p>


  <div class="doc doc-object doc-module">



<h3 id="whatrecord.macro" class="doc doc-heading">
        <code>whatrecord.macro</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">







<h4 id="whatrecord.macro-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.macro.macros_from_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">macro</span><span class="o">.</span><span class="n">macros_from_string</span><span class="p">(</span><span class="n">macro_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_environment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Get a macro dictionary from a macro string.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>macro_string</code></td>
        <td><code>str</code></td>
        <td><p>The macro string, in the format A=B,C=D,...</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>use_environment</code></td>
        <td><code>bool</code></td>
        <td><p>Use environment variables as well.  Defaults to False.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, str]</code></td>
      <td><p>Macro key to value.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/macro.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">macros_from_string</span><span class="p">(</span>
    <span class="n">macro_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">use_environment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a macro dictionary from a macro string.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    macro_string : str</span>
<span class="sd">        The macro string, in the format A=B,C=D,...</span>

<span class="sd">    use_environment : bool, optional</span>
<span class="sd">        Use environment variables as well.  Defaults to False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    macros : Dict[str, str]</span>
<span class="sd">        Macro key to value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">macro_string</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="n">macro_context</span> <span class="o">=</span> <span class="n">MacroContext</span><span class="p">(</span><span class="n">use_environment</span><span class="o">=</span><span class="n">use_environment</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">macro_context</span><span class="o">.</span><span class="n">define_from_string</span><span class="p">(</span><span class="n">macro_string</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

<h2 id="pv-graphing">PV Graphing</h2>


  <div class="doc doc-object doc-module">



<h3 id="whatrecord.graph" class="doc doc-heading">
        <code>whatrecord.graph</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">






<h4 id="whatrecord.graph-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.GraphEdge" class="doc doc-heading">
        <code>
whatrecord.graph.GraphEdge        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>GraphEdge(source: whatrecord.graph.GraphNode, destination: whatrecord.graph.GraphNode, options: dict = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GraphEdge</span><span class="p">:</span>
    <span class="c1">#: The source node.</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">GraphNode</span>
    <span class="c1">#: The destination node.</span>
    <span class="n">destination</span><span class="p">:</span> <span class="n">GraphNode</span>
    <span class="c1">#: Options to pass to graphviz.</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.GraphNode" class="doc doc-heading">
        <code>
whatrecord.graph.GraphNode        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>GraphNode(id: str, label: str, text: str, options: dict = <factory>, highlighted: bool = False)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">GraphNode</span><span class="p">:</span>
    <span class="c1">#: The integer ID of the node</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1">#: The node label</span>
    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1">#: The text to show in the node</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1">#: Options to pass to graphviz.</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1">#: Highlight the node in the graph?</span>
    <span class="n">highlighted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.LinkInfo" class="doc doc-heading">
        <code>
whatrecord.graph.LinkInfo        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>LinkInfo(record1: whatrecord.common.RecordInstance, field1: whatrecord.common.RecordField, record2: whatrecord.common.RecordInstance, field2: whatrecord.common.RecordField, info: List[str])</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LinkInfo</span><span class="p">:</span>
    <span class="n">record1</span><span class="p">:</span> <span class="n">RecordInstance</span>
    <span class="n">field1</span><span class="p">:</span> <span class="n">RecordField</span>
    <span class="n">record2</span><span class="p">:</span> <span class="n">RecordInstance</span>
    <span class="n">field2</span><span class="p">:</span> <span class="n">RecordField</span>
    <span class="n">info</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.RecordLinkGraph" class="doc doc-heading">
        <code>
whatrecord.graph.RecordLinkGraph            (<span title="whatrecord.graph._GraphHelper">_GraphHelper</span>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Record link graph.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RecordLinkGraph</span><span class="p">(</span><span class="n">_GraphHelper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Record link graph.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: create node and color when not in database?</span>

    <span class="n">database</span><span class="p">:</span> <span class="n">Database</span>
    <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">header_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;record(</span><span class="si">{rtype}</span><span class="s1">, &quot;</span><span class="si">{name}</span><span class="s1">&quot;)&#39;</span>
    <span class="n">field_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{field:&gt;4s}</span><span class="s1">: &quot;</span><span class="si">{value}</span><span class="s1">&quot;&#39;</span>
    <span class="n">text_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="se">{{</span><span class="s2">header</span><span class="se">}}</span><span class="s2">&lt;/b&gt;&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_GraphHelper</span><span class="o">.</span><span class="n">newline</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">_GraphHelper</span><span class="o">.</span><span class="n">newline</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">field_lines</span><span class="se">}}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]</span>
    <span class="n">default_edge_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;solid&quot;</span><span class="p">,</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">edge_kwargs</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;PP&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CPP&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CP&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;MS&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MSS&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MSI&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">starting_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">record_types</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">record_types</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span> <span class="o">=</span> <span class="n">starting_records</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">header_format</span> <span class="o">=</span> <span class="n">header_format</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">header_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_format</span> <span class="o">=</span> <span class="n">field_format</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">field_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_format</span> <span class="o">=</span> <span class="n">text_format</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">text_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span> <span class="o">=</span> <span class="n">sort_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_empty</span> <span class="o">=</span> <span class="n">show_empty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">relations</span>

        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Add records from the given database to the graph.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">Database</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">add_or_update_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">record_types</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">find_record_links</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relations</span>
        <span class="p">):</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="n">li</span><span class="o">.</span><span class="n">record1</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">),</span> <span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record2</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="n">src</span><span class="p">),</span> <span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="n">dest</span><span class="p">)]:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_empty</span><span class="p">:</span>
                    <span class="n">text_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">value</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">text_line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">text_line</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text_line</span>

            <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;DBF_INLINK&quot;</span><span class="p">:</span>
                <span class="n">src</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span>
                <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New edge </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

            <span class="n">edge_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_edge_kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">to_find</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">match</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">to_find</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                        <span class="n">edge_kw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="k">break</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pairs</span><span class="p">):</span>
                <span class="n">edge_kw</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                    <span class="n">edge_kw</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">dest</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="c1"># No relationship found; at least show the records</span>
            <span class="k">for</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rec_name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">field_lines</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span>

            <span class="k">if</span> <span class="n">field_lines</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
            <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rtype</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
                <span class="n">header</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Alias: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">escaped_header</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">header</span><span class="o">=</span><span class="n">escaped_header</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">),</span>
                <span class="n">field_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
                <span class="p">),</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ready_for_digraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">gv</span><span class="o">.</span><span class="n">Digraph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook when the user calls ``to_digraph``.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node</span><span class="o">.</span><span class="n">highlighted</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












<h6 id="whatrecord.graph.RecordLinkGraph-methods">Methods</h6>


  <div class="doc doc-object doc-method">



<h7 id="whatrecord.graph.RecordLinkGraph.add_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">RecordLinkGraph</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">Database</span><span class="p">])</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Add records from the given database to the graph.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Add records from the given database to the graph.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">Database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">add_or_update_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">record_types</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">find_record_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span><span class="p">,</span> <span class="n">relations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relations</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="n">li</span><span class="o">.</span><span class="n">record1</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">),</span> <span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record2</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">record2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="n">src</span><span class="p">),</span> <span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="n">dest</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_empty</span><span class="p">:</span>
                <span class="n">text_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">field</span><span class="o">.</span><span class="n">value</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">text_line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">text_line</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text_line</span>

        <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s2">&quot;DBF_INLINK&quot;</span><span class="p">:</span>
            <span class="n">src</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">dest</span><span class="p">,</span> <span class="n">src</span>
            <span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="p">,</span> <span class="n">li</span><span class="o">.</span><span class="n">field1</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New edge </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>

        <span class="n">edge_kw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_edge_kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">to_find</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">match</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">to_find</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                    <span class="n">edge_kw</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_pairs</span><span class="p">):</span>
            <span class="n">edge_kw</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">li</span><span class="o">.</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">li</span><span class="o">.</span><span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">:</span>
                <span class="n">edge_kw</span><span class="p">[</span><span class="s2">&quot;xlabel&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">li</span><span class="o">.</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">dest</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">edge_kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="c1"># No relationship found; at least show the records</span>
        <span class="k">for</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">starting_records</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rec_name</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">field_lines</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_fields</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span>

        <span class="k">if</span> <span class="n">field_lines</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">header_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rtype</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Alias: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">aliases</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">escaped_header</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_format</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">header</span><span class="o">=</span><span class="n">escaped_header</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="p">),</span>
            <span class="n">field_lines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">newline</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">html</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="p">),</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.graph.ScriptLinkGraph" class="doc doc-heading">
        <code>
whatrecord.graph.ScriptLinkGraph            (<span title="whatrecord.graph._GraphHelper">_GraphHelper</span>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Script link graph (i.e., inter-IOC record links).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>database</code></td>
        <td><code>Union[whatrecord.db.Database, Dict[str, whatrecord.common.RecordInstance]]</code></td>
        <td><p>Dictionary of record name to record instance.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>starting_records</code></td>
        <td><code>list of str</code></td>
        <td><p>Record names</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>sort_fields</code></td>
        <td><code>bool</code></td>
        <td><p>Sort list of fields</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>show_empty</code></td>
        <td><code>bool</code></td>
        <td><p>Show empty fields</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>relations</code></td>
        <td><code>Optional[Dict[str, Dict[str, List[Tuple[whatrecord.common.RecordField, whatrecord.common.RecordField, List[str]]]]]]</code></td>
        <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>script_relations</code></td>
        <td><code>Optional[Dict[str, Dict[str, List[str]]]]</code></td>
        <td><p>Pre-built script relationship dictionary.  Generated from database if
not provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>record_types</code></td>
        <td><code>Optional[Dict[str, whatrecord.common.RecordType]]</code></td>
        <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.  Only
used for determining script relations if not specified.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ScriptLinkGraph</span><span class="p">(</span><span class="n">_GraphHelper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Script link graph (i.e., inter-IOC record links).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>
<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>
<span class="sd">    sort_fields : bool, optional</span>
<span class="sd">        Sort list of fields</span>
<span class="sd">    show_empty : bool, optional</span>
<span class="sd">        Show empty fields</span>
<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>
<span class="sd">    script_relations : dict, optional</span>
<span class="sd">        Pre-built script relationship dictionary.  Generated from database if</span>
<span class="sd">        not provided.</span>
<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.  Only</span>
<span class="sd">        used for determining script relations if not specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: create node and color when not in database?</span>

    <span class="n">newline</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&lt;br align=&quot;center&quot;/&gt;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScriptPVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">Database</span><span class="p">(</span><span class="n">record_types</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">record_types</span> <span class="ow">or</span> <span class="p">{}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span> <span class="o">=</span> <span class="n">limit_to_records</span> <span class="ow">or</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">relations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span> <span class="o">=</span> <span class="n">script_relations</span>

        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;Add records from the given database to the graph.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">Database</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">add_or_update_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

        <span class="c1"># if not self.script_relations:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span>
            <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">record_types</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span> <span class="o">=</span> <span class="n">build_script_relations</span><span class="p">(</span>
            <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span>
            <span class="n">by_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">,</span>
            <span class="n">limit_to_records</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">script_a</span><span class="p">,</span> <span class="n">script_a_relations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">script_a</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">script_a</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">script_b</span> <span class="ow">in</span> <span class="n">script_a_relations</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">script_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">script_b</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">script_b</span><span class="p">)</span>

                <span class="n">inter_lines</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">script_a</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="p">[</span><span class="n">script_a</span><span class="p">][</span><span class="n">script_b</span><span class="p">]))</span>
                    <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">script_b</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="p">[</span><span class="n">script_b</span><span class="p">][</span><span class="n">script_a</span><span class="p">]))</span>
                <span class="p">)</span>
                <span class="n">inter_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_a</span><span class="si">}</span><span class="s2">&lt;-&gt;</span><span class="si">{</span><span class="n">script_b</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">inter_node</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inter_lines</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">script_a</span><span class="p">,</span> <span class="n">inter_node</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">inter_node</span><span class="p">,</span> <span class="n">script_b</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="c1"># No relationship found; at least show the records</span>
            <span class="k">for</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="k">if</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rec_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ready_for_digraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">gv</span><span class="o">.</span><span class="n">Digraph</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Hook when the user calls ``to_digraph``.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node</span><span class="o">.</span><span class="n">highlighted</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">








<h6 id="whatrecord.graph.ScriptLinkGraph-methods">Methods</h6>


  <div class="doc doc-object doc-method">



<h7 id="whatrecord.graph.ScriptLinkGraph.add_database" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">ScriptLinkGraph</span><span class="o">.</span><span class="n">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">Database</span><span class="p">])</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Add records from the given database to the graph.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span> <span class="n">Database</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;Add records from the given database to the graph.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">Database</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">add_or_update_record</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

    <span class="c1"># if not self.script_relations:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span>
        <span class="n">record_types</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">record_types</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span> <span class="o">=</span> <span class="n">build_script_relations</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">,</span>
        <span class="n">by_record</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">relations</span><span class="p">,</span>
        <span class="n">limit_to_records</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">script_a</span><span class="p">,</span> <span class="n">script_a_relations</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">script_a</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">script_a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">script_b</span> <span class="ow">in</span> <span class="n">script_a_relations</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">script_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">script_b</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">script_b</span><span class="p">)</span>

            <span class="n">inter_lines</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">script_a</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="p">[</span><span class="n">script_a</span><span class="p">][</span><span class="n">script_b</span><span class="p">]))</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;&lt;b&gt;</span><span class="si">{</span><span class="n">script_b</span><span class="si">}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script_relations</span><span class="p">[</span><span class="n">script_b</span><span class="p">][</span><span class="n">script_a</span><span class="p">]))</span>
            <span class="p">)</span>
            <span class="n">inter_node</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_a</span><span class="si">}</span><span class="s2">&lt;-&gt;</span><span class="si">{</span><span class="n">script_b</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">inter_node</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inter_lines</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">script_a</span><span class="p">,</span> <span class="n">inter_node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">inter_node</span><span class="p">,</span> <span class="n">script_b</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="c1"># No relationship found; at least show the records</span>
        <span class="k">for</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">limit_to_records</span> <span class="ow">or</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="n">rec_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_node</span><span class="p">(</span><span class="n">rec_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>


<h4 id="whatrecord.graph-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.build_database_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">build_database_relations</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Build a dictionary of PV relationships.</p>
<p>This should not be called often for large databases, as it makes no attempt
to be computationally efficient.  For repeated usage, cache the result
of this function and reuse it in future calls to <code>graph_links</code> and such.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>database</code></td>
        <td><code>Dict[str, whatrecord.common.RecordInstance]</code></td>
        <td><p>Dictionary of record name to record instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>record_types</code></td>
        <td><code>Optional[Dict[str, whatrecord.common.RecordType]]</code></td>
        <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Dict[str, Dict[str, List[Tuple[whatrecord.common.RecordField, whatrecord.common.RecordField, List[str]]]]]</code></td>
      <td><p>Such that: <code>info[pv1][pv2] = (field1, field2, info)</code>
And in reverse: <code>info[pv2][pv1] = (field2, field1, info)</code></p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_database_relations</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PVRelations</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build a dictionary of PV relationships.</span>

<span class="sd">    This should not be called often for large databases, as it makes no attempt</span>
<span class="sd">    to be computationally efficient.  For repeated usage, cache the result</span>
<span class="sd">    of this function and reuse it in future calls to ``graph_links`` and such.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>

<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    info : dict</span>
<span class="sd">        Such that: ``info[pv1][pv2] = (field1, field2, info)``</span>
<span class="sd">        And in reverse: ``info[pv2][pv1] = (field2, field1, info)``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">warned</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">unset_ctx</span><span class="p">:</span> <span class="n">FullLoadContext</span> <span class="o">=</span> <span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">)</span>
    <span class="n">by_record</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">))</span>

    <span class="c1"># TODO: alias handling?</span>
    <span class="k">for</span> <span class="n">rec1</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">record_types</span><span class="p">:</span>
            <span class="c1"># Use links as defined in the database definition</span>
            <span class="n">rec1_links</span> <span class="o">=</span> <span class="n">rec1</span><span class="o">.</span><span class="n">get_links</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Fall back to static list of link fields</span>
            <span class="n">rec1_links</span> <span class="o">=</span> <span class="n">rec1</span><span class="o">.</span><span class="n">get_common_links</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">rec1_links</span><span class="p">:</span>
            <span class="c1"># TODO: copied without thinking about implications</span>
            <span class="c1"># due to the removal of st.cmd context as an attempt to reduce</span>
            <span class="n">field1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">field1</span><span class="p">)</span>
            <span class="c1"># field1.context = rec1.context[:1] + field1.context</span>

            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">link</span><span class="p">:</span>
                <span class="n">link</span><span class="p">,</span> <span class="n">field2</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">field1</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;FLNK&quot;</span><span class="p">:</span>
                <span class="n">field2</span> <span class="o">=</span> <span class="s2">&quot;PROC&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">field2</span> <span class="o">=</span> <span class="s2">&quot;VAL&quot;</span>

            <span class="n">rec2</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rec2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># TODO: switch to debug; this will be expensive later</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">is_supported_link</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">link</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warned</span><span class="p">:</span>
                    <span class="n">warned</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Linked record from </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2"> not in database: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">link</span>
                    <span class="p">)</span>

                <span class="n">field2</span> <span class="o">=</span> <span class="n">RecordField</span><span class="p">(</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;(unknown-record)&quot;</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="n">unset_ctx</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">rec2_name</span> <span class="o">=</span> <span class="n">link</span>
            <span class="k">elif</span> <span class="n">field2</span> <span class="ow">in</span> <span class="n">rec2</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="n">rec2_name</span> <span class="o">=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">name</span>
                <span class="c1"># TODO: copied without thinking about implications</span>
                <span class="n">field2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rec2</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field2</span><span class="p">])</span>
                <span class="c1"># field2.context = rec2.context[:1] + field2.context</span>
            <span class="k">elif</span> <span class="n">record_types</span><span class="p">:</span>
                <span class="n">rec2_name</span> <span class="o">=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">name</span>
                <span class="n">dbd_record_type</span> <span class="o">=</span> <span class="n">record_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec2</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dbd_record_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">field2</span> <span class="o">=</span> <span class="n">RecordField</span><span class="p">(</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;(invalid-record-type)&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="n">unset_ctx</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">field2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dbd_record_type</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                    <span class="n">field2</span> <span class="o">=</span> <span class="n">RecordField</span><span class="p">(</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;invalid&quot;</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;(invalid-field)&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="n">unset_ctx</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dbd_record_field</span> <span class="o">=</span> <span class="n">dbd_record_type</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field2</span><span class="p">]</span>
                    <span class="n">field2</span> <span class="o">=</span> <span class="n">RecordField</span><span class="p">(</span>
                        <span class="n">dtype</span><span class="o">=</span><span class="n">dbd_record_field</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                        <span class="n">name</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                        <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="n">context</span><span class="o">=</span><span class="n">dbd_record_field</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec2_name</span> <span class="o">=</span> <span class="n">rec2</span><span class="o">.</span><span class="n">name</span>
                <span class="n">field2</span> <span class="o">=</span> <span class="n">RecordField</span><span class="p">(</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                    <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># unset or invalid, can&#39;t tell yet</span>
                    <span class="n">context</span><span class="o">=</span><span class="n">unset_ctx</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">by_record</span><span class="p">[</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="n">rec2_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>
            <span class="n">by_record</span><span class="p">[</span><span class="n">rec2_name</span><span class="p">][</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">field2</span><span class="p">,</span> <span class="n">field1</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">inner_dict</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">inner_dict</span> <span class="ow">in</span> <span class="n">by_record</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.combine_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">combine_relations</span><span class="p">(</span><span class="n">dest_relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]],</span> <span class="n">dest_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">source_relations</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]],</span> <span class="n">source_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Combine multiple script relations into one.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">combine_relations</span><span class="p">(</span>
    <span class="n">dest_relations</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span>
    <span class="n">dest_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">source_relations</span><span class="p">:</span> <span class="n">PVRelations</span><span class="p">,</span>
    <span class="n">source_db</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Combine multiple script relations into one.&quot;&quot;&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="n">aliases</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_relation_by_field</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span>
    <span class="p">]:</span>
        <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec2_names</span> <span class="ow">in</span> <span class="n">source_relations</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dest_rec1_dict</span> <span class="o">=</span> <span class="n">dest_relations</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rec1_name</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">rec2_name</span> <span class="ow">in</span> <span class="n">rec2_names</span><span class="p">:</span>
                <span class="n">dest_rec2</span> <span class="o">=</span> <span class="n">dest_rec1_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">relation_by_field</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="p">(</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">):</span> <span class="p">(</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">dest_rec2</span>
                <span class="p">}</span>
                <span class="k">yield</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">relation_by_field</span>

    <span class="c1"># Part 1:</span>
    <span class="c1"># Rebuild with new aliases, if available</span>
    <span class="c1"># Either set of relations could have referred to aliased names, actual</span>
    <span class="c1"># names, or even *both*.</span>

    <span class="k">def</span> <span class="nf">alias_to_actual</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="c1"># This is kinda expensive, imperfect, and confusing; consider reworking</span>
        <span class="k">for</span> <span class="n">alias_from</span><span class="p">,</span> <span class="n">alias_to</span> <span class="ow">in</span> <span class="n">aliases</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># A -&gt; B</span>
            <span class="n">inner_dict</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alias_from</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inner_dict</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Fix up B &lt;- A first, since it&#39;s symmetric</span>
            <span class="k">for</span> <span class="n">inner_name</span><span class="p">,</span> <span class="n">inner_items</span> <span class="ow">in</span> <span class="n">inner_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># d[inner_name][alias_to] += d[inner_name][alias_from]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">inner_name</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">alias_to</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">inner_name</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">alias_from</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">alias_to</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">alias_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">inner_dict</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The actual record name is already in the relation dict</span>
                <span class="k">for</span> <span class="n">inner_name</span><span class="p">,</span> <span class="n">inner_items</span> <span class="ow">in</span> <span class="n">inner_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="c1"># d[alias_to][inner_name] += inner_items</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">alias_to</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">inner_name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">inner_items</span><span class="p">)</span>

    <span class="n">alias_to_actual</span><span class="p">(</span><span class="n">dest_relations</span><span class="p">)</span>
    <span class="n">alias_to_actual</span><span class="p">(</span><span class="n">source_relations</span><span class="p">)</span>

    <span class="c1"># Part 1:</span>
    <span class="c1"># Merge in new or updated relations from the second set</span>
    <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">relation_by_field</span> <span class="ow">in</span> <span class="n">get_relation_by_field</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">source_relations</span><span class="p">[</span><span class="n">rec1_name</span><span class="p">][</span><span class="n">rec2_name</span><span class="p">]:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">field1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">existing_link</span> <span class="o">=</span> <span class="n">relation_by_field</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">existing_link</span><span class="p">:</span>
                <span class="n">relation_by_field</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">link</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">existing_field1</span><span class="p">,</span> <span class="n">existing_field2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">existing_link</span>
                <span class="n">existing_field1</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">field1</span><span class="p">)</span>
                <span class="n">existing_field2</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">field2</span><span class="p">)</span>

        <span class="n">dest_relations</span><span class="p">[</span><span class="n">rec1_name</span><span class="p">][</span><span class="n">rec2_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">relation_by_field</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_record</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstance</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get record from either database.&quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">aliases</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dest_db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">source_db</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">get_field_info</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get record definition if available.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">record</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">record_types</span><span class="p">:</span>
            <span class="n">field_def</span> <span class="o">=</span> <span class="n">record_types</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">RecordField</span><span class="p">(</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">field_def</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="n">field_def</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Field not in database or database definition&quot;</span><span class="p">)</span>

    <span class="c1"># Part 2:</span>
    <span class="c1"># Update any existing relations in the destination relations with</span>
    <span class="c1"># information from the source database</span>
    <span class="k">for</span> <span class="n">rec1_name</span><span class="p">,</span> <span class="n">rec1</span> <span class="ow">in</span> <span class="n">source_db</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">rec1_name</span> <span class="ow">in</span> <span class="n">dest_relations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">rec2_items</span> <span class="ow">in</span> <span class="n">dest_relations</span><span class="p">[</span><span class="n">rec1_name</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># We know rec1 is in the source database, but we don&#39;t know</span>
                <span class="c1"># where rec2 might be, so use `get_record`.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">rec2</span> <span class="o">=</span> <span class="n">get_record</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="c1"># It&#39;s not in this IOC...</span>
                    <span class="k">continue</span>

                <span class="k">def</span> <span class="nf">get_items_to_update</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">rec2_items</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec1</span><span class="p">,</span> <span class="n">field1</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec2</span><span class="p">,</span> <span class="n">field2</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">dest_relations</span><span class="p">[</span><span class="n">rec2_name</span><span class="p">][</span><span class="n">rec1_name</span><span class="p">]:</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec2</span><span class="p">,</span> <span class="n">field1</span><span class="p">)</span>
                        <span class="k">yield</span> <span class="p">(</span><span class="n">rec1</span><span class="p">,</span> <span class="n">field2</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">rec</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_items_to_update</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">field_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Missing field? </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="n">field_info</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.find_record_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">find_record_links</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">LinkInfo</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Get all related record links from a set of starting records.</p>
<p>All starting records will be included, along with any other records that
are linked to from there.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>database</code></td>
        <td><code>Dict[str, whatrecord.common.RecordInstance]</code></td>
        <td><p>Dictionary of record name to record instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>starting_records</code></td>
        <td><code>List[str]</code></td>
        <td><p>Record names</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>relations</code></td>
        <td><code>Optional[Dict[str, Dict[str, List[Tuple[whatrecord.common.RecordField, whatrecord.common.RecordField, List[str]]]]]]</code></td>
        <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Generator[whatrecord.graph.LinkInfo, NoneType, NoneType]</code></td>
      <td><p>Link info</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_record_links</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">LinkInfo</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all related record links from a set of starting records.</span>

<span class="sd">    All starting records will be included, along with any other records that</span>
<span class="sd">    are linked to from there.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>

<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>

<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    link_info : LinkInfo</span>
<span class="sd">        Link info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checked</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">relations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">relations</span> <span class="o">=</span> <span class="n">build_database_relations</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

    <span class="n">records_to_check</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">starting_records</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">records_to_check</span><span class="p">:</span>
        <span class="n">rec1</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">records_to_check</span><span class="o">.</span><span class="n">pop</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rec1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;--- record </span><span class="si">%s</span><span class="s2"> ---&quot;</span><span class="p">,</span> <span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">rec2_name</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">relations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rec2_name</span> <span class="ow">in</span> <span class="n">checked</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">rec2</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rec2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">field1</span><span class="p">,</span> <span class="n">field2</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rec2_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">checked</span> <span class="ow">and</span> <span class="n">rec2_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">records_to_check</span><span class="p">:</span>
                    <span class="n">records_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec2_name</span><span class="p">)</span>

                <span class="n">li</span> <span class="o">=</span> <span class="n">LinkInfo</span><span class="p">(</span>
                    <span class="n">record1</span><span class="o">=</span><span class="n">rec1</span><span class="p">,</span>
                    <span class="n">field1</span><span class="o">=</span><span class="n">field1</span><span class="p">,</span>
                    <span class="n">record2</span><span class="o">=</span><span class="n">rec2</span><span class="p">,</span>
                    <span class="n">field2</span><span class="o">=</span><span class="n">field2</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Link </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">li</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">li</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.graph_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">graph_links</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">]],</span> <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordLinkGraph</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a graphviz digraph of record links.</p>
<p>All starting records will be included, along with any other records that
are linked to from there - if available in the database.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>database</code></td>
        <td><code>Union[whatrecord.db.Database, Dict[str, whatrecord.common.RecordInstance]]</code></td>
        <td><p>Dictionary of record name to record instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>starting_records</code></td>
        <td><code>List[str]</code></td>
        <td><p>Record names</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>graph</code></td>
        <td><code>graphviz.Graph</code></td>
        <td><p>Graph instance to use. New one created if not specified.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>engine</code></td>
        <td><code>str</code></td>
        <td><p>Graphviz engine (dot, fdp, etc)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>field_format</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Format string for fields (keys: field, value, attr)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>sort_fields</code></td>
        <td><code>bool</code></td>
        <td><p>Sort list of fields</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>text_format</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>Text format for full node (keys: header, field_lines)</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>show_empty</code></td>
        <td><code>bool</code></td>
        <td><p>Show empty fields</p></td>
        <td><code>False</code></td>
      </tr>
      <tr>
        <td><code>font_name</code></td>
        <td><code>str</code></td>
        <td><p>Font name to use for all nodes and edges</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>relations</code></td>
        <td><code>Optional[Dict[str, Dict[str, List[Tuple[whatrecord.common.RecordField, whatrecord.common.RecordField, List[str]]]]]]</code></td>
        <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>record_types</code></td>
        <td><code>Optional[Dict[str, whatrecord.common.RecordType]]</code></td>
        <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.  Only
used for determining script relations if not specified.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">graph_links</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Database</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">]],</span>
    <span class="n">starting_records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">header_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">field_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">text_format</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort_fields</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_empty</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordLinkGraph</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a graphviz digraph of record links.</span>

<span class="sd">    All starting records will be included, along with any other records that</span>
<span class="sd">    are linked to from there - if available in the database.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>
<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>
<span class="sd">    graph : graphviz.Graph, optional</span>
<span class="sd">        Graph instance to use. New one created if not specified.</span>
<span class="sd">    engine : str, optional</span>
<span class="sd">        Graphviz engine (dot, fdp, etc)</span>
<span class="sd">    field_format : str, optional</span>
<span class="sd">        Format string for fields (keys: field, value, attr)</span>
<span class="sd">    sort_fields : bool, optional</span>
<span class="sd">        Sort list of fields</span>
<span class="sd">    text_format : str, optional</span>
<span class="sd">        Text format for full node (keys: header, field_lines)</span>
<span class="sd">    show_empty : bool, optional</span>
<span class="sd">        Show empty fields</span>
<span class="sd">    font_name : str, optional</span>
<span class="sd">        Font name to use for all nodes and edges</span>
<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>
<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.  Only</span>
<span class="sd">        used for determining script relations if not specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    graph : RecordLinkGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">RecordLinkGraph</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
        <span class="n">starting_records</span><span class="o">=</span><span class="n">starting_records</span><span class="p">,</span>
        <span class="n">header_format</span><span class="o">=</span><span class="n">header_format</span><span class="p">,</span>
        <span class="n">field_format</span><span class="o">=</span><span class="n">field_format</span><span class="p">,</span>
        <span class="n">text_format</span><span class="o">=</span><span class="n">text_format</span><span class="p">,</span>
        <span class="n">sort_fields</span><span class="o">=</span><span class="n">sort_fields</span><span class="p">,</span>
        <span class="n">show_empty</span><span class="o">=</span><span class="n">show_empty</span><span class="p">,</span>
        <span class="n">relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
        <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.graph.graph_script_relations" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">graph_script_relations</span><span class="p">(</span><span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="p">],</span> <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptLinkGraph</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Create a graphviz digraph of script links (i.e., inter-IOC record links).</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>database</code></td>
        <td><code>Dict[str, whatrecord.common.RecordInstance]</code></td>
        <td><p>Dictionary of record name to record instance.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>starting_records</code></td>
        <td><code>list of str</code></td>
        <td><p>Record names</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>relations</code></td>
        <td><code>Optional[Dict[str, Dict[str, List[Tuple[whatrecord.common.RecordField, whatrecord.common.RecordField, List[str]]]]]]</code></td>
        <td><p>Pre-built PV relationship dictionary.  Generated from database
if not provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>script_relations</code></td>
        <td><code>Optional[Dict[str, Dict[str, List[str]]]]</code></td>
        <td><p>Pre-built script relationship dictionary.  Generated from database if
not provided.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>record_types</code></td>
        <td><code>Optional[Dict[str, whatrecord.common.RecordType]]</code></td>
        <td><p>The database definitions to use for fields that are not defined in the
database file.  Dictionary of record type name to RecordType.  Only
used for determining script relations if not specified.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/graph.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">graph_script_relations</span><span class="p">(</span>
    <span class="n">database</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordInstance</span><span class="p">],</span>
    <span class="n">limit_to_records</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">script_relations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ScriptPVRelations</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">record_types</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScriptLinkGraph</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a graphviz digraph of script links (i.e., inter-IOC record links).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    database : dict</span>
<span class="sd">        Dictionary of record name to record instance.</span>
<span class="sd">    starting_records : list of str</span>
<span class="sd">        Record names</span>
<span class="sd">    relations : dict, optional</span>
<span class="sd">        Pre-built PV relationship dictionary.  Generated from database</span>
<span class="sd">        if not provided.</span>
<span class="sd">    script_relations : dict, optional</span>
<span class="sd">        Pre-built script relationship dictionary.  Generated from database if</span>
<span class="sd">        not provided.</span>
<span class="sd">    record_types : dict, optional</span>
<span class="sd">        The database definitions to use for fields that are not defined in the</span>
<span class="sd">        database file.  Dictionary of record type name to RecordType.  Only</span>
<span class="sd">        used for determining script relations if not specified.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    graph : ScriptLinkGraph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ScriptLinkGraph</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
        <span class="n">limit_to_records</span><span class="o">=</span><span class="n">limit_to_records</span><span class="p">,</span>
        <span class="n">relations</span><span class="o">=</span><span class="n">relations</span><span class="p">,</span>
        <span class="n">script_relations</span><span class="o">=</span><span class="n">script_relations</span><span class="p">,</span>
        <span class="n">record_types</span><span class="o">=</span><span class="n">record_types</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>

<h2 id="shared">Shared</h2>


  <div class="doc doc-object doc-module">



<h3 id="whatrecord.common" class="doc doc-heading">
        <code>whatrecord.common</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">
















<h4 id="whatrecord.common-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.AsynPortBase" class="doc doc-heading">
        <code>
whatrecord.common.AsynPortBase        </code>



</h5>

    <div class="doc doc-contents ">

      <p>Base class for general asyn ports.</p>
<p>Used in :mod:<code>whatrecord.asyn</code>, but made available here such that apischema
can find it more readily.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">AsynPortBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for general asyn ports.</span>

<span class="sd">    Used in :mod:`whatrecord.asyn`, but made available here such that apischema</span>
<span class="sd">    can find it more readily.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_union</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Registers new subclasses automatically in the union cls._union.</span>

        <span class="c1"># Deserializers stack directly as a Union</span>
        <span class="n">apischema</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span>
            <span class="n">apischema</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">Conversion</span><span class="p">(</span>
                <span class="n">apischema</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">AsynPortBase</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Only AsynPortBase serializer must be registered (and updated for each</span>
        <span class="c1"># subclass) as a Union, and not be inherited</span>
        <span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">cls</span> <span class="k">if</span> <span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Union</span><span class="p">[</span><span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span><span class="p">,</span> <span class="bp">cls</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">apischema</span><span class="o">.</span><span class="n">serializer</span><span class="p">(</span>
            <span class="n">apischema</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">Conversion</span><span class="p">(</span>
                <span class="n">apischema</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">AsynPortBase</span><span class="p">,</span>
                <span class="n">target</span><span class="o">=</span><span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span><span class="p">,</span>
                <span class="n">inherited</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







<h6 id="whatrecord.common.AsynPortBase-methods">Methods</h6>

  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.AsynPortBase.__init_subclass__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">AsynPortBase</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>This method is called when a class is subclassed.</p>
<p>The default implementation does nothing. It may be
overridden to extend subclasses.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Registers new subclasses automatically in the union cls._union.</span>

    <span class="c1"># Deserializers stack directly as a Union</span>
    <span class="n">apischema</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span>
        <span class="n">apischema</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">Conversion</span><span class="p">(</span>
            <span class="n">apischema</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">cls</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">AsynPortBase</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Only AsynPortBase serializer must be registered (and updated for each</span>
    <span class="c1"># subclass) as a Union, and not be inherited</span>
    <span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">cls</span> <span class="k">if</span> <span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Union</span><span class="p">[</span><span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span><span class="p">,</span> <span class="bp">cls</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">apischema</span><span class="o">.</span><span class="n">serializer</span><span class="p">(</span>
        <span class="n">apischema</span><span class="o">.</span><span class="n">conversions</span><span class="o">.</span><span class="n">Conversion</span><span class="p">(</span>
            <span class="n">apischema</span><span class="o">.</span><span class="n">identity</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">AsynPortBase</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">AsynPortBase</span><span class="o">.</span><span class="n">_union</span><span class="p">,</span>
            <span class="n">inherited</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.DatabaseDevice" class="doc doc-heading">
        <code>
whatrecord.common.DatabaseDevice        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>DatabaseDevice(record_type: 'str', link_type: 'str', dset_name: 'str', choice_string: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DatabaseDevice</span><span class="p">:</span>
    <span class="n">record_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">link_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">dset_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">choice_string</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.DatabaseMenu" class="doc doc-heading">
        <code>
whatrecord.common.DatabaseMenu        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>DatabaseMenu(context: 'FullLoadContext', name: 'str', choices: 'Dict[str, str]')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">DatabaseMenu</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">choices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.FileFormat" class="doc doc-heading">
        <code>
whatrecord.common.FileFormat            (<span title="str">str</span>, <span title="enum.Enum">Enum</span>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>An enumeration.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FileFormat</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">iocsh</span> <span class="o">=</span> <span class="s1">&#39;iocsh&#39;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="s1">&#39;database&#39;</span>
    <span class="n">database_definition</span> <span class="o">=</span> <span class="s1">&#39;database_definition&#39;</span>
    <span class="n">substitution</span> <span class="o">=</span> <span class="s1">&#39;substitution&#39;</span>
    <span class="n">gateway_pvlist</span> <span class="o">=</span> <span class="s1">&#39;gateway_pvlist&#39;</span>
    <span class="n">access_security</span> <span class="o">=</span> <span class="s1">&#39;access_security&#39;</span>
    <span class="n">stream_protocol</span> <span class="o">=</span> <span class="s1">&#39;stream_protocol&#39;</span>
    <span class="n">state_notation</span> <span class="o">=</span> <span class="s1">&#39;state_notation&#39;</span>
    <span class="n">makefile</span> <span class="o">=</span> <span class="s1">&#39;makefile&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_extension</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">extension</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a file format based on a file extension.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;cmd&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">iocsh</span><span class="p">,</span>
            <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="s2">&quot;dbd&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">database_definition</span><span class="p">,</span>
            <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">database</span><span class="p">,</span>
            <span class="s2">&quot;substitutions&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">substitution</span><span class="p">,</span>
            <span class="s2">&quot;pvlist&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">gateway_pvlist</span><span class="p">,</span>
            <span class="s2">&quot;acf&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">access_security</span><span class="p">,</span>
            <span class="s2">&quot;proto&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">stream_protocol</span><span class="p">,</span>
            <span class="s2">&quot;st&quot;</span><span class="p">:</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">state_notation</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">extension</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_filename</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a file format based on a full filename.&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">extension</span> <span class="ow">and</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Makefile&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">makefile</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">from_extension</span><span class="p">(</span><span class="n">extension</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not determine file type from extension: </span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.GdbBinaryInfo" class="doc doc-heading">
        <code>
whatrecord.common.GdbBinaryInfo        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>GdbBinaryInfo(commands: 'Dict[str, IocshCommand]', base_version: 'Optional[str]', variables: 'Dict[str, IocshVariable]', error: 'Optional[str]')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">GdbBinaryInfo</span><span class="p">:</span>
    <span class="n">commands</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IocshCommand</span><span class="p">]</span>
    <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IocshVariable</span><span class="p">]</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocMetadata" class="doc doc-heading">
        <code>
whatrecord.common.IocMetadata        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocMetadata(name: 'str' = 'unset', script: 'pathlib.Path' = <factory>, startup_directory: 'pathlib.Path' = <factory>, host: 'Optional[str]' = None, port: 'Optional[int]' = None, binary: 'Optional[str]' = None, base_version: 'str' = '3.15', metadata: 'Dict[str, Any]' = <factory>, macros: 'Dict[str, str]' = <factory>, standin_directories: 'Dict[str, str]' = <factory>, commands: 'Dict[str, IocshCommand]' = <factory>, variables: 'Dict[str, IocshVariable]' = <factory>, loaded_files: 'Dict[str, str]' = <factory>, load_success: 'bool' = True)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocMetadata</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unset&quot;</span>
    <span class="n">script</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>
    <span class="n">startup_directory</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">base_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">macros</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">commands</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IocshCommand</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">IocshVariable</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">loaded_files</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">load_success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the metadata with a new set from an IOC Loader.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : IocMetadata</span>
<span class="sd">            The other IOC metadata to update this instance with.</span>

<span class="sd">        merge : bool, optional</span>
<span class="sd">            Merge in dictionary information, or overwrite it.  Defaults to</span>
<span class="sd">            &#39;overwrite&#39; (merge=False).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">script</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">startup_directory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">host</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">base_version</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">base_version</span> <span class="o">!=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">merge</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">standin_directories</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">standin_directories</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">looks_like_sh</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Is the script likely sh/bash/etc?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="s2">&quot;bin/sh&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span>
            <span class="s2">&quot;bin/bash&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span>
            <span class="s2">&quot;env bash&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span>
            <span class="s2">&quot;bin/tcsh&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span>
            <span class="s2">&quot;/python&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cache_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Cache key for storing this IOC information in a file.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">script</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="nb">hash</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cache_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">:</span>
        <span class="n">metadata_fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_key</span><span class="si">}</span><span class="s2">.IocMetadata.json&quot;</span>
        <span class="k">return</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">)</span> <span class="o">/</span> <span class="n">metadata_fn</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ioc_cache_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">:</span>
        <span class="n">metadata_fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_key</span><span class="si">}</span><span class="s2">.LoadedIoc.json&quot;</span>
        <span class="k">return</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">)</span> <span class="o">/</span> <span class="n">metadata_fn</span>

    <span class="k">def</span> <span class="nf">from_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IocMetadata</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="o">...</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="c1"># Truncated output file, perhaps</span>
            <span class="o">...</span>

    <span class="k">def</span> <span class="nf">save_to_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cache_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Is this IOC up-to-date with what is on disk?&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">check_files_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_loaded_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add filename to the loaded file dictionary, optionally updating an</span>
<span class="sd">        existing hash.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_file_sha256</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_binary_information</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GdbBinaryInfo</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="k">await</span> <span class="n">util</span><span class="o">.</span><span class="n">run_gdb</span><span class="p">(</span>
                <span class="s2">&quot;gdb_binary_info&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
                <span class="bp">cls</span><span class="o">=</span><span class="n">GdbBinaryInfo</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">apischema</span><span class="o">.</span><span class="n">ValidationError</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get gdb information for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Failed to get gdb information for </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">error</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">base_version</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">context</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_loaded_file</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;GDB source file does not exist for command </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="n">command</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">database_version_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Load databases with this specification.&quot;&quot;&quot;</span>
        <span class="c1"># TODO: better version parsing</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">base_major_minor</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">base_major_minor</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="k">else</span> <span class="mi">4</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">3</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;unset&quot;</span><span class="p">,</span> <span class="n">script</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(),</span>
                   <span class="n">startup_directory</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">())</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
        <span class="o">**</span><span class="n">metadata</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Given at minimum a filename, guess the rest.&quot;&quot;&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># iocBoot/((ioc-something))/st.cmd</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
                <span class="c1"># Sorry, we need something unique here (better ideas welcome)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">script</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
            <span class="n">startup_directory</span><span class="o">=</span><span class="n">startup_directory</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">standin_directories</span><span class="o">=</span><span class="n">standin_directories</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1">#: Back-compat: from_filename is deprecated</span>
    <span class="n">from_filename</span> <span class="o">=</span> <span class="n">from_file</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iocdict</span><span class="p">:</span> <span class="n">IocInfoDict</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pick apart a given dictionary, relegating extra info to ``.metadata``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iocdict : dict</span>
<span class="sd">            IOC information dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ioc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">iocdict</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">port</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">script</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>
        <span class="n">script</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">script</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">base_version</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;base_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
            <span class="n">startup_directory</span><span class="o">=</span><span class="n">script</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
            <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
            <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">script</span><span class="p">),</span>
            <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="whatrecord.common.IocMetadata-attributes">Attributes</h6>





  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.IocMetadata.database_version_spec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">database_version_spec</span><span class="p">:</span> <span class="nb">int</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Load databases with this specification.</p>
    </div>

  </div>







  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.IocMetadata.looks_like_sh" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">looks_like_sh</span><span class="p">:</span> <span class="nb">bool</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Is the script likely sh/bash/etc?</p>
    </div>

  </div>












<h6 id="whatrecord.common.IocMetadata-methods">Methods</h6>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.IocMetadata.add_loaded_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">add_loaded_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Add filename to the loaded file dictionary, optionally updating an</p>
<p>existing hash.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add_loaded_file</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">update</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add filename to the loaded file dictionary, optionally updating an</span>
<span class="sd">    existing hash.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span> <span class="ow">or</span> <span class="n">update</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_file_sha256</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.IocMetadata.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">iocdict</span><span class="p">:</span> <span class="n">IocInfoDict</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Pick apart a given dictionary, relegating extra info to <code>.metadata</code>.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>iocdict</code></td>
        <td><code>IocInfoDict</code></td>
        <td><p>IOC information dictionary.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">iocdict</span><span class="p">:</span> <span class="n">IocInfoDict</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pick apart a given dictionary, relegating extra info to ``.metadata``.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iocdict : dict</span>
<span class="sd">        IOC information dictionary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ioc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">iocdict</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="n">host</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;port&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">script</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">)</span>
    <span class="n">script</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">script</span><span class="p">))</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">base_version</span> <span class="o">=</span> <span class="n">ioc</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;base_version&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">script</span><span class="p">,</span>
        <span class="n">startup_directory</span><span class="o">=</span><span class="n">script</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">ioc</span><span class="p">,</span>
        <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">script</span><span class="p">),</span>
        <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.IocMetadata.from_file" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;3.15&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Given at minimum a filename, guess the rest.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
    <span class="o">**</span><span class="n">metadata</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given at minimum a filename, guess the rest.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># iocBoot/((ioc-something))/st.cmd</span>
    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="c1"># Sorry, we need something unique here (better ideas welcome)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">startup_directory</span><span class="o">=</span><span class="n">startup_directory</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">standin_directories</span><span class="o">=</span><span class="n">standin_directories</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.IocMetadata.from_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">from_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;3.15&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Given at minimum a filename, guess the rest.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_file</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">startup_directory</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">macros</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">standin_directories</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">binary</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">base_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">,</span>
    <span class="o">**</span><span class="n">metadata</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given at minimum a filename, guess the rest.&quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># iocBoot/((ioc-something))/st.cmd</span>
    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="c1"># Sorry, we need something unique here (better ideas welcome)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
        <span class="n">script</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">startup_directory</span><span class="o">=</span><span class="n">startup_directory</span> <span class="ow">or</span> <span class="n">filename</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="n">macros</span><span class="o">=</span><span class="n">macros</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">standin_directories</span><span class="o">=</span><span class="n">standin_directories</span> <span class="ow">or</span> <span class="p">{},</span>
        <span class="n">binary</span><span class="o">=</span><span class="n">binary</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
        <span class="n">base_version</span><span class="o">=</span><span class="n">base_version</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.IocMetadata.is_up_to_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Is this IOC up-to-date with what is on disk?</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">is_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Is this IOC up-to-date with what is on disk?&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="n">check_files_up_to_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loaded_files</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.IocMetadata.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">IocMetadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Update the metadata with a new set from an IOC Loader.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>other</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>The other IOC metadata to update this instance with.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>merge</code></td>
        <td><code>bool</code></td>
        <td><p>Merge in dictionary information, or overwrite it.  Defaults to
'overwrite' (merge=False).</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the metadata with a new set from an IOC Loader.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    other : IocMetadata</span>
<span class="sd">        The other IOC metadata to update this instance with.</span>

<span class="sd">    merge : bool, optional</span>
<span class="sd">        Merge in dictionary information, or overwrite it.  Defaults to</span>
<span class="sd">        &#39;overwrite&#39; (merge=False).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">script</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">script</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">startup_directory</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">startup_directory</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">host</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">port</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">other</span><span class="o">.</span><span class="n">base_version</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">base_version</span> <span class="o">!=</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_version</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">merge</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">standin_directories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">macros</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standin_directories</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">standin_directories</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">commands</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">variables</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshArgument" class="doc doc-heading">
        <code>
whatrecord.common.IocshArgument        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocshArgument(name: 'str', type: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocshArgument</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshCmdArgs" class="doc doc-heading">
        <code>
whatrecord.common.IocshCmdArgs        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>iocshCmd(...) arguments.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocshCmdArgs</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;iocshCmd(...) arguments.&quot;&quot;&quot;</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">command</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshCommand" class="doc doc-heading">
        <code>
whatrecord.common.IocshCommand        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocshCommand(name: 'str', args: 'List[IocshArgument]' = <factory>, usage: 'Optional[str]' = None, context: 'Optional[FullLoadContext]' = None)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocshCommand</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">IocshArgument</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">usage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FullLoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshResult" class="doc doc-heading">
        <code>
whatrecord.common.IocshResult        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocshResult(context: 'FullLoadContext', line: 'str', outputs: 'List[str]' = <factory>, argv: 'Optional[List[str]]' = None, error: 'Optional[str]' = None, redirects: 'List[IocshRedirect]' = <factory>, result: 'Any' = None)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@apischema</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">with_fields_set</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocshResult</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">argv</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">redirects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">IocshRedirect</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1"># TODO: normalize this</span>
    <span class="c1"># result: Optional[Union[str, Dict[str, str], IocshCmdArgs, ShortLinterResults]]</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">{</span><span class="si">%- f</span><span class="s2">or ctx in context -%}</span>
<span class="s2">    {{ctx.line}}:</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %} {{ line }}</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f error %}</span>
<span class="s2">    ** ERROR on line {</span><span class="si">% i</span><span class="s2">f context %}{{ context[0].line }}{</span><span class="si">% e</span><span class="s2">ndif %} **</span>
<span class="s2">    {{ error | indent(4) }}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f outputs != [line] %}</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or output in outputs %}</span>
<span class="s2">    -SH&gt; {{ output | indent(6) }}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or redirect in redirects %}</span>
<span class="s2">    -&gt; Redirect: {{ redirect }}</span>
<span class="s2">{</span><span class="si">%- e</span><span class="s2">ndfor %}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
    <span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">





















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshScript" class="doc doc-heading">
        <code>
whatrecord.common.IocshScript        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocshScript(path: 'str', lines: 'List[IocshResult]')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocshScript</span><span class="p">:</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1"># lines: Tuple[IocshResult, ...]</span>
    <span class="n">lines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">IocshResult</span><span class="p">]</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {%- for line in lines %}</span>
<span class="sd">            {% set line = render_object(line, &quot;console&quot;) %}</span>
<span class="sd">            {{ line }}</span>
<span class="sd">            {%- endfor %}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">),</span>
        <span class="s2">&quot;console-verbose&quot;</span><span class="p">:</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;\</span>
<span class="sd">            {%- for line in lines -%}</span>
<span class="sd">            {% set line = render_object(line, &quot;console-verbose&quot;) %}</span>
<span class="sd">            {{ line }}</span>
<span class="sd">            {%- endfor %}</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_metadata</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">md</span><span class="p">:</span> <span class="n">IocMetadata</span><span class="p">,</span> <span class="n">sh</span><span class="p">:</span> <span class="n">ShellState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">md</span><span class="o">.</span><span class="n">looks_like_sh</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">md</span><span class="o">.</span><span class="n">base_version</span> <span class="o">==</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEFAULT_BASE_VERSION</span><span class="p">:</span>
                <span class="n">md</span><span class="o">.</span><span class="n">base_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_general_file</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="o">.</span><span class="n">script</span><span class="p">),</span>
            <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">interpret_shell_script</span><span class="p">(</span>
                    <span class="n">md</span><span class="o">.</span><span class="n">script</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_interpreted_script</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
        <span class="n">contents</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sh</span><span class="p">:</span> <span class="n">ShellState</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IocshScript</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
                <span class="n">sh</span><span class="o">.</span><span class="n">interpret_shell_script_text</span><span class="p">(</span>
                    <span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_general_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># For use when shoehorning in a file that&#39;s not _really_ an IOC script</span>
        <span class="c1"># TODO: instead rework the api</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">lines</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span>
                <span class="n">IocshResult</span><span class="p">(</span>
                    <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">,</span>
                    <span class="n">context</span><span class="o">=</span><span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="n">lineno</span><span class="p">),</span> <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.IocshVariable" class="doc doc-heading">
        <code>
whatrecord.common.IocshVariable        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>IocshVariable(name: 'str', value: 'Optional[str]' = None, type: 'Optional[str]' = None)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IocshVariable</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.LinterError" class="doc doc-heading">
        <code>
whatrecord.common.LinterError            (<a title="whatrecord.common.LinterMessage" href="#whatrecord.common.LinterMessage">LinterMessage</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>LinterError(name: 'str', line: 'int', message: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LinterError</span><span class="p">(</span><span class="n">LinterMessage</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.LinterMessage" class="doc doc-heading">
        <code>
whatrecord.common.LinterMessage        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>LinterMessage(name: 'str', line: 'int', message: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LinterMessage</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.LinterWarning" class="doc doc-heading">
        <code>
whatrecord.common.LinterWarning            (<a title="whatrecord.common.LinterMessage" href="#whatrecord.common.LinterMessage">LinterMessage</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>LinterWarning(name: 'str', line: 'int', message: 'str')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LinterWarning</span><span class="p">(</span><span class="n">LinterMessage</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.LoadContext" class="doc doc-heading">
        <code>
whatrecord.common.LoadContext        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>LoadContext(name: 'str', line: 'int')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">LoadContext</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@apischema</span><span class="o">.</span><span class="n">serializer</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.MutableLoadContext" class="doc doc-heading">
        <code>
whatrecord.common.MutableLoadContext        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>MutableLoadContext(name: 'str', line: 'int')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MutableLoadContext</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">line</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">to_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoadContext</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">LoadContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.PVAFieldReference" class="doc doc-heading">
        <code>
whatrecord.common.PVAFieldReference        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>PVAFieldReference(context: 'FullLoadContext', name: 'str' = '', record_name: 'str' = '', field_name: 'str' = '', metadata: 'Dict[str, str]' = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PVAFieldReference</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">record_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">PVAFieldReference: {{ record_name }}.{{ field_name }}</span>
<span class="s2">                 - {{ metadata }}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordDefinitionAndInstance" class="doc doc-heading">
        <code>
whatrecord.common.RecordDefinitionAndInstance        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>A pair of V3 record definition and instance.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordDefinitionAndInstance</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A pair of V3 record definition and instance.&quot;&quot;&quot;</span>
    <span class="n">definition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RecordType</span><span class="p">]</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">{</span><span class="si">% s</span><span class="s2">et instance_info = render_object(instance, &quot;console&quot;) %}</span>
<span class="s2">{{ instance_info }}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordField" class="doc doc-heading">
        <code>
whatrecord.common.RecordField        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>RecordField(dtype: 'str', name: 'str', value: 'Any', context: 'FullLoadContext')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordField</span><span class="p">:</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;field({{name}}, &quot;{{value}}&quot;)&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="s2">&quot;console-verbose&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">field({{name}}, &quot;{{value}}&quot;)  # {{dtype}}{</span><span class="si">% i</span><span class="s2">f context %}; {{context[-1]}}{</span><span class="si">% e</span><span class="s2">ndif %}</span><span class="se">\</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">update_unknowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordField</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unknown_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">dbd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If this RecordField has some missing information (&quot;unknown&quot;), fill</span>
<span class="sd">        it in with information from the other field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unknown_values</span> <span class="o">=</span> <span class="n">unknown_values</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;(unknown-record)&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unknown_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unknown_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ctx</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
            <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
                <span class="c1"># Even if the other context is unknown, let&#39;s take it anyway:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">context</span>
        <span class="c1"># if dbd is not None:</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











<h6 id="whatrecord.common.RecordField-methods">Methods</h6>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.RecordField.update_unknowns" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordField</span><span class="o">.</span><span class="n">update_unknowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordField</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unknown_values</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dbd</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>If this RecordField has some missing information ("unknown"), fill</p>
<p>it in with information from the other field.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update_unknowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordField</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unknown_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">dbd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If this RecordField has some missing information (&quot;unknown&quot;), fill</span>
<span class="sd">    it in with information from the other field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">unknown_values</span> <span class="o">=</span> <span class="n">unknown_values</span> <span class="ow">or</span> <span class="p">{</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;(unknown-record)&quot;</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unknown_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unknown_values</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ctx</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
        <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">unknown_values</span><span class="p">:</span>
            <span class="c1"># Even if the other context is unknown, let&#39;s take it anyway:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">context</span>
    <span class="c1"># if dbd is not None:</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordInstance" class="doc doc-heading">
        <code>
whatrecord.common.RecordInstance        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>RecordInstance(context: 'FullLoadContext', name: 'str', record_type: 'str', fields: 'Dict[str, AnyField]' = <factory>, info: 'Dict[StringWithContext, Any]' = <factory>, metadata: 'Dict[StringWithContext, Any]' = <factory>, aliases: 'List[str]' = <factory>, is_grecord: 'bool' = False, is_pva: 'bool' = False, owner: 'str' = '')</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordInstance</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">record_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">AnyField</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">StringWithContext</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">StringWithContext</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">is_grecord</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">is_pva</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># For the convenience of downstream clients, redundantly keep track of the</span>
    <span class="c1"># associated IOC:</span>
    <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">record(&quot;{{record_type}}&quot;, &quot;{{name}}&quot;) {</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f owner %}</span>
<span class="s2">    # Part of {{ owner }}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or ctx in context %}</span>
<span class="s2">    # {{ctx}}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">{</span><span class="si">% f</span><span class="s2">or name, field_inst in fields.items() | sort %}</span>
<span class="s2">{</span><span class="si">% s</span><span class="s2">et field_text = render_object(field_inst, &quot;console&quot;) %}</span>
<span class="s2">    {{ field_text | indent(4) }}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndfor %}</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">access_security_group</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The access security group name for the record.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;ASG&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;ASG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;DEFAULT&quot;</span>

    <span class="k">def</span> <span class="nf">get_fields_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get all fields of the matching type(s).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">fld</span>

    <span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all links.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        field : RecordField</span>
<span class="sd">        link_text: str</span>
<span class="sd">        link_info: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">LINK_TYPES</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_link_information</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">yield</span> <span class="n">fld</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">get_common_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Without using a database definition, try to find links.</span>

<span class="sd">        This differs from ``get_links`` in that the other method requires</span>
<span class="sd">        a dbd file to be loaded, whereas this will use a simple - but possibly</span>
<span class="sd">        inaccurate - map of of record type to link fields.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        field : RecordField</span>
<span class="sd">        link_text: str</span>
<span class="sd">        link_info: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">LINK_FIELDS_BY_RECORD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="n">COMMON_LINK_FIELDS</span><span class="p">):</span>
            <span class="n">fld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fld</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_link_information</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">yield</span> <span class="n">fld</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">to_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstanceSummary</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return a summarized version of the record instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">RecordInstanceSummary</span><span class="o">.</span><span class="n">from_record_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LinterMessage</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update this record instance with another.</span>

<span class="sd">        TODO: This may not do exactly what an IOC would do.</span>
<span class="sd">        TODO: Return type?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_pva</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">LinterError</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;combine_pva_and_v3&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Cannot combine PVA group with V3 record&quot;</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">remove_redundant_context</span><span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">aliases</span> <span class="k">if</span> <span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">record_type</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">LinterError</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;record_type_mismatch&quot;</span><span class="p">,</span>
                    <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Record type mismatch in provided database files: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">record_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">record_type</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="whatrecord.common.RecordInstance-attributes">Attributes</h6>

  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.RecordInstance.access_security_group" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">access_security_group</span><span class="p">:</span> <span class="nb">str</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>The access security group name for the record.</p>
    </div>

  </div>














<h6 id="whatrecord.common.RecordInstance-methods">Methods</h6>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.RecordInstance.get_common_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">get_common_links</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Without using a database definition, try to find links.</p>
<p>This differs from <code>get_links</code> in that the other method requires
a dbd file to be loaded, whereas this will use a simple - but possibly
inaccurate - map of of record type to link fields.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_common_links</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Without using a database definition, try to find links.</span>

<span class="sd">    This differs from ``get_links`` in that the other method requires</span>
<span class="sd">    a dbd file to be loaded, whereas this will use a simple - but possibly</span>
<span class="sd">    inaccurate - map of of record type to link fields.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    field : RecordField</span>
<span class="sd">    link_text: str</span>
<span class="sd">    link_info: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">LINK_FIELDS_BY_RECORD</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span> <span class="n">COMMON_LINK_FIELDS</span><span class="p">):</span>
        <span class="n">fld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fld</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_link_information</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">yield</span> <span class="n">fld</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.RecordInstance.get_fields_of_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Get all fields of the matching type(s).</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_fields_of_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get all fields of the matching type(s).&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fld</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">fld</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.RecordInstance.get_links" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">get_links</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Get all links.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">RecordField</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all links.</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    field : RecordField</span>
<span class="sd">    link_text: str</span>
<span class="sd">    link_info: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fields_of_type</span><span class="p">(</span><span class="o">*</span><span class="n">LINK_TYPES</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">link</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">get_link_information</span><span class="p">(</span><span class="n">fld</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">yield</span> <span class="n">fld</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">info</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.RecordInstance.to_summary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">to_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstanceSummary</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Return a summarized version of the record instance.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstanceSummary</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Return a summarized version of the record instance.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">RecordInstanceSummary</span><span class="o">.</span><span class="n">from_record_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.RecordInstance.update" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">RecordInstance</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LinterMessage</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Update this record instance with another.</p>
<p>TODO: This may not do exactly what an IOC would do.
TODO: Return type?</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">LinterMessage</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update this record instance with another.</span>

<span class="sd">    TODO: This may not do exactly what an IOC would do.</span>
<span class="sd">    TODO: Return type?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">is_pva</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_pva</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">LinterError</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;combine_pva_and_v3&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Cannot combine PVA group with V3 record&quot;</span>
            <span class="p">)</span>
        <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">remove_redundant_context</span><span class="p">(</span>
        <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span><span class="n">alias</span> <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">aliases</span> <span class="k">if</span> <span class="n">alias</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_type</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">record_type</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">LinterError</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;record_type_mismatch&quot;</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Record type mismatch in provided database files: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">record_type</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">record_type</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">]</span>

    <span class="k">return</span> <span class="p">[]</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordInstanceSummary" class="doc doc-heading">
        <code>
whatrecord.common.RecordInstanceSummary        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>An abbreviated form of :class:<code>RecordInstance</code>.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordInstanceSummary</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;An abbreviated form of :class:`RecordInstance`.&quot;&quot;&quot;</span>

    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">record_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1"># fields: Dict[str, RecordField]</span>
    <span class="n">info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">StringWithContext</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="c1"># metadata: Dict[str, Any] = field(default_factory=dict)</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="c1"># is_grecord: bool = False</span>
    <span class="n">is_pva</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_record_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecordInstanceSummary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">RecordInstanceSummary</span><span class="p">(</span>
            <span class="n">context</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">record_type</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">record_type</span><span class="p">,</span>
            <span class="n">info</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
            <span class="n">aliases</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">aliases</span><span class="p">,</span>
            <span class="n">is_pva</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">is_pva</span><span class="p">,</span>
            <span class="n">owner</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">owner</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordType" class="doc doc-heading">
        <code>
whatrecord.common.RecordType        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>RecordType(context: 'FullLoadContext', name: 'str', cdefs: 'List[str]' = <factory>, fields: 'Dict[str, RecordTypeField]' = <factory>, devices: 'Dict[str, DatabaseDevice]' = <factory>, aliases: 'List[str]' = <factory>, info: 'Dict[str, str]' = <factory>, is_grecord: 'bool' = False)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordType</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">cdefs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">RecordTypeField</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DatabaseDevice</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">aliases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">is_grecord</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.RecordTypeField" class="doc doc-heading">
        <code>
whatrecord.common.RecordTypeField        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>RecordTypeField(context: 'FullLoadContext', name: 'str', type: 'str', asl: 'Optional[str]' = None, initial: 'Optional[str]' = None, promptgroup: 'Optional[str]' = None, prompt: 'Optional[str]' = None, special: 'Optional[str]' = None, pp: 'Optional[str]' = None, interest: 'Optional[str]' = None, base: 'Optional[str]' = None, size: 'Optional[str]' = None, extra: 'Optional[str]' = None, menu: 'Optional[str]' = None, prop: 'Optional[str]' = None, body: 'Dict[str, str]' = <factory>)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@apischema</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">with_fields_set</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordTypeField</span><span class="p">:</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">FullLoadContext</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">asl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">initial</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">promptgroup</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">special</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">interest</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">base</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">menu</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prop</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="c1"># -&gt; bundle the remainder in &quot;body&quot;, even if unrecognized</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






























  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.ShellStateHandler" class="doc doc-heading">
        <code>
whatrecord.common.ShellStateHandler        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>ShellStateHandler(parent: 'Optional[ShellStateHandler]' = None, primary_handler: 'Optional[ShellState]' = None)</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ShellStateHandler</span><span class="p">:</span>
    <span class="n">metadata_key</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">parent</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ShellStateHandler</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">apischema</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">skip</span><span class="p">,</span>
        <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">primary_handler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ShellState</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">apischema</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">skip</span><span class="p">,</span>
        <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">_handlers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">apischema</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">skip</span><span class="p">,</span>
        <span class="nb">repr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compare</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handlers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_handlers</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_sub_handlers_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_sub_handlers_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize sub-handlers with parent/primary_handler.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sub_handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
            <span class="n">sub_handler</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">sub_handler</span><span class="o">.</span><span class="n">primary_handler</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s2">&quot;primary_handler&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">sub_handler</span><span class="o">.</span><span class="n">_init_sub_handlers_</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Annotate the given record&#39;s metadata with state-related information.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get a FullLoadContext tuple representing where we are now.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sub_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ShellStateHandler</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Handlers which contain their own state.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">generic_handler_decorator</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Decorate a handler method to generically return parameter-to-value</span>
<span class="sd">        information.</span>

<span class="sd">        This can be in addition to or in place of GDB command information.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : callable</span>
<span class="sd">            The ``handler_`` method.</span>

<span class="sd">        stub : bool, optional</span>
<span class="sd">            Mark this as a stub method.  Variable arguments will be filled in</span>
<span class="sd">            as necessary, even if defaults are not provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="kc">None</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
                <span class="k">else</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span>
            <span class="p">)</span>

            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stub</span><span class="p">:</span>
                    <span class="c1"># Pad unspecified arguments with defaults or &quot;None&quot;</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">defaults</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;argument_lint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Too many arguments&quot;</span>

                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;arguments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">),</span>
                        <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                <span class="p">]</span>

                <span class="n">call_result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)])</span>
                <span class="k">if</span> <span class="n">call_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">call_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="k">return</span> <span class="n">result</span>
            <span class="k">return</span> <span class="n">wrapped</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrap</span>

    <span class="k">def</span> <span class="nf">find_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Find all IOC shell command handlers by name.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">handler_obj</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">handler_obj</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;handle_&quot;</span><span class="p">):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">handler_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span>

            <span class="k">if</span> <span class="n">handler_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">yield from</span> <span class="n">handler_obj</span><span class="o">.</span><span class="n">find_handlers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">pre_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pre-iocInit hook.&quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span> <span class="nf">post_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Post-iocInit hook.&quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="whatrecord.common.ShellStateHandler-attributes">Attributes</h6>




  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.common.ShellStateHandler.sub_handlers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ShellStateHandler</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Handlers which contain their own state.</p>
    </div>

  </div>




<h6 id="whatrecord.common.ShellStateHandler-methods">Methods</h6>





  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.ShellStateHandler.annotate_record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Annotate the given record's metadata with state-related information.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">annotate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">RecordInstance</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Annotate the given record&#39;s metadata with state-related information.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.ShellStateHandler.find_handlers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">find_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Find all IOC shell command handlers by name.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Find all IOC shell command handlers by name.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">handler_obj</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_handlers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">handler_obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;handle_&quot;</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">handler_obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">yield</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span>

        <span class="k">if</span> <span class="n">handler_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="n">handler_obj</span><span class="o">.</span><span class="n">find_handlers</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.ShellStateHandler.generic_handler_decorator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">generic_handler_decorator</span><span class="p">(</span><span class="n">func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stub</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Decorate a handler method to generically return parameter-to-value</p>
<p>information.</p>
<p>This can be in addition to or in place of GDB command information.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>func</code></td>
        <td><code>callable</code></td>
        <td><p>The <code>handler_</code> method.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>stub</code></td>
        <td><code>bool</code></td>
        <td><p>Mark this as a stub method.  Variable arguments will be filled in
as necessary, even if defaults are not provided.</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">generic_handler_decorator</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorate a handler method to generically return parameter-to-value</span>
<span class="sd">    information.</span>

<span class="sd">    This can be in addition to or in place of GDB command information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : callable</span>
<span class="sd">        The ``handler_`` method.</span>

<span class="sd">    stub : bool, optional</span>
<span class="sd">        Mark this as a stub method.  Variable arguments will be filled in</span>
<span class="sd">        as necessary, even if defaults are not provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span>
            <span class="k">else</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span>
        <span class="p">)</span>

        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="ow">and</span> <span class="n">stub</span><span class="p">:</span>
                <span class="c1"># Pad unspecified arguments with defaults or &quot;None&quot;</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">+</span> <span class="n">defaults</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;argument_lint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Too many arguments&quot;</span>

            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;arguments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">),</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="n">call_result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)])</span>
            <span class="k">if</span> <span class="n">call_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">call_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">wrap</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrap</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.ShellStateHandler.get_load_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Get a FullLoadContext tuple representing where we are now.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_load_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get a FullLoadContext tuple representing where we are now.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primary_handler</span><span class="o">.</span><span class="n">get_load_context</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.ShellStateHandler.post_ioc_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">post_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Post-iocInit hook.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">post_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Post-iocInit hook.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.ShellStateHandler.pre_ioc_init" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">ShellStateHandler</span><span class="o">.</span><span class="n">pre_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Pre-iocInit hook.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pre_ioc_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Pre-iocInit hook.&quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.StringWithContext" class="doc doc-heading">
        <code>
whatrecord.common.StringWithContext            (<span title="str">str</span>)
        </code>



</h5>

    <div class="doc doc-contents ">

      <p>A string with LoadContext.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StringWithContext</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A string with LoadContext.&quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FullLoadContext</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FullLoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









<h6 id="whatrecord.common.StringWithContext-methods">Methods</h6>

  <div class="doc doc-object doc-method">



<h7 id="whatrecord.common.StringWithContext.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">StringWithContext</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FullLoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FullLoadContext</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.common.WhatRecord" class="doc doc-heading">
        <code>
whatrecord.common.WhatRecord        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>WhatRecord - full set of information regarding a specific record.</p>
<p>This response is on a per-IOC basis, so at most it can return one V3 record
and one V4 record, as these exist in separate namespaces.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>The record name.</p></td>
      </tr>
      <tr>
        <td><code>record</code></td>
        <td><code>RecordDefinitionAndInstance</code></td>
        <td><p>The V3 record definition (if available) and record instance.</p></td>
      </tr>
      <tr>
        <td><code>pva_group</code></td>
        <td><code>RecordInstance</code></td>
        <td><p>The PVAccess group, if available.</p></td>
      </tr>
      <tr>
        <td><code>ioc</code></td>
        <td><code>IocMetadata</code></td>
        <td><p>The associated IOC metadata, if available.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">WhatRecord</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WhatRecord - full set of information regarding a specific record.</span>

<span class="sd">    This response is on a per-IOC basis, so at most it can return one V3 record</span>
<span class="sd">    and one V4 record, as these exist in separate namespaces.</span>


<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The record name.</span>

<span class="sd">    record : RecordDefinitionAndInstance, optional</span>
<span class="sd">        The V3 record definition (if available) and record instance.</span>

<span class="sd">    pva_group : RecordInstance, optional</span>
<span class="sd">        The PVAccess group, if available.</span>

<span class="sd">    ioc : IocMetadata, optional</span>
<span class="sd">        The associated IOC metadata, if available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">record</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RecordDefinitionAndInstance</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">menus</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DatabaseMenu</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">pva_group</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RecordInstance</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ioc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IocMetadata</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_jinja_format_</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;console&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">{{ name }}:</span>
<span class="s2">    Owner: {{ present }}</span>
<span class="s2">{</span><span class="si">% s</span><span class="s2">et ioc_info = render_object(ioc, &quot;console&quot;) %}</span>
<span class="s2">    IOC: {{ ioc_info }}</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f record %}</span>
<span class="s2">{</span><span class="si">% s</span><span class="s2">et instance_info = render_object(record, &quot;console&quot;) %}</span>
<span class="s2">    {{ instance_info | indent(4)}}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">{</span><span class="si">% i</span><span class="s2">f pva_group %}</span>
<span class="s2">{</span><span class="si">% s</span><span class="s2">et instance_info = render_object(pva_group, &quot;console&quot;) %}</span>
<span class="s2">    {{ instance_info | indent(4)}}</span>
<span class="s2">{</span><span class="si">% e</span><span class="s2">ndif %}</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">



















  </div>

    </div>

  </div>


<h4 id="whatrecord.common-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.common.context_from_lark_token" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">context_from_lark_token</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Get a full load context from a given lark Token.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">context_from_lark_token</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="n">lark</span><span class="o">.</span><span class="n">Token</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get a full load context from a given lark Token.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">LoadContext</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="n">token</span><span class="o">.</span><span class="n">line</span><span class="p">),</span> <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.common.get_link_information" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">get_link_information</span><span class="p">(</span><span class="n">link_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Get link information from a DBF_{IN,OUT,FWD}LINK value.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_link_information</span><span class="p">(</span><span class="n">link_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
    <span class="sd">&quot;&quot;&quot;Get link information from a DBF_{IN,OUT,FWD}LINK value.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link_str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># Oh, PVA...</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PVA links are TODO, sorry&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">link_str</span><span class="p">:</span>
        <span class="c1"># strip off PP/MS/etc (TODO might be useful later)</span>
        <span class="n">link_str</span><span class="p">,</span> <span class="n">additional_info</span> <span class="o">=</span> <span class="n">link_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">additional_info</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">link_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">):</span>
        <span class="c1"># TODO asyn/device links</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;asyn link&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">link_str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;empty link&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">link_str</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
        <span class="c1"># 0 or 1 usually and not a string</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;integral link&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">link_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Good, we don&#39;t want a float</span>
        <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;float link&quot;</span><span class="p">)</span>

    <span class="n">link_details</span> <span class="o">=</span> <span class="n">additional_info</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">link_str</span><span class="p">,</span> <span class="n">link_details</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.common.remove_redundant_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">remove_redundant_context</span><span class="p">(</span><span class="n">full_context</span><span class="p">:</span> <span class="n">FullLoadContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Remove redundant context information if it does not add anything.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">remove_redundant_context</span><span class="p">(</span><span class="n">full_context</span><span class="p">:</span> <span class="n">FullLoadContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FullLoadContext</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Remove redundant context information if it does not add anything.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">full_context</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">full_context</span>

    <span class="c1"># Inefficient, but the data set is small here, so meh</span>
    <span class="n">zero_line_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">item</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">full_context</span>
        <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">zero_line_files</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">full_context</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">file</span> <span class="ow">and</span> <span class="n">ctx</span><span class="o">.</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zero_line_files</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="n">new_context</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">full_context</span><span class="p">:</span>
        <span class="n">is_specific</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">zero_line_files</span> <span class="ow">or</span> <span class="n">ctx</span><span class="o">.</span><span class="n">line</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">is_specific</span> <span class="ow">and</span> <span class="n">ctx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_context</span><span class="p">:</span>
            <span class="n">new_context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">new_context</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.common.time_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">common</span><span class="o">.</span><span class="n">time_context</span><span class="p">()</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Return a callable to measure the time since context manager init.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/common.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">time_context</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Return a callable to measure the time since context manager init.&quot;&quot;&quot;</span>
    <span class="n">start_count</span> <span class="o">=</span> <span class="n">perf_counter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_count</span>

    <span class="k">yield</span> <span class="n">inner</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

<h2 id="miscellaneous">Miscellaneous</h2>


  <div class="doc doc-object doc-module">



<h3 id="whatrecord.cache" class="doc doc-heading">
        <code>whatrecord.cache</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">







<h4 id="whatrecord.cache-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.cache.CacheKey" class="doc doc-heading">
        <code>
whatrecord.cache.CacheKey        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>CacheKey()</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/cache.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CacheKey</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_to_cache_key_part</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Take an arbitrary value from the CacheKey and make a string out of it.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">is_dataclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_cache_key_part</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_to_cache_key_part</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the cache filename.&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>

        <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_cache_key_part</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">by_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">value_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">sha</span> <span class="o">=</span> <span class="n">get_bytes_sha256</span><span class="p">(</span><span class="n">value_repr</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sha</span><span class="si">}</span><span class="s2">.json&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







<h6 id="whatrecord.cache.CacheKey-methods">Methods</h6>




  <div class="doc doc-object doc-method">



<h7 id="whatrecord.cache.CacheKey.to_filename" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">CacheKey</span><span class="o">.</span><span class="n">to_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Get the cache filename.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/cache.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Get the cache filename.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">by_name</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>

    <span class="n">values</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_cache_key_part</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">by_name</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">value_repr</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">sha</span> <span class="o">=</span> <span class="n">get_bytes_sha256</span><span class="p">(</span><span class="n">value_repr</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="n">class_name</span> <span class="o">=</span> <span class="n">class_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">sha</span><span class="si">}</span><span class="s2">.json&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.cache.Cached" class="doc doc-heading">
        <code>
whatrecord.cache.Cached            (<span title="whatrecord.cache._Cached">_Cached</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>A generic dataclass that can be cached in <code>WHATRECORD_CACHE_PATH</code>.</p>
<p>Expects to be subclassed and configured with a CacheKey subclass.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/cache.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Cached</span><span class="p">(</span><span class="n">_Cached</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic dataclass that can be cached in ``WHATRECORD_CACHE_PATH``.</span>

<span class="sd">    Expects to be subclassed and configured with a CacheKey subclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span><span class="p">:</span> <span class="n">CacheKey</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">apischema</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">skip</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_CacheKeyType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">cache_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_dataclass</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> should be defined with a keyword argument &#39;key&#39;; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;such as `class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(Cached, key=CacheKeyClass):&quot;</span>
            <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_version_</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">CacheKey</span> <span class="o">=</span> <span class="n">key</span>
        <span class="k">if</span> <span class="n">cache_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">CACHE_PATH</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># cache disabled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">cache_path</span> <span class="ow">or</span> <span class="n">CACHE_PATH</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">








<h6 id="whatrecord.cache.Cached-methods">Methods</h6>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.cache.Cached.__init_subclass__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">Cached</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_CacheKeyType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cache_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>This method is called when a class is subclassed.</p>
<p>The default implementation does nothing. It may be
overridden to extend subclasses.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/cache.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">_CacheKeyType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">cache_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">is_dataclass</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> should be defined with a keyword argument &#39;key&#39;; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;such as `class </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(Cached, key=CacheKeyClass):&quot;</span>
        <span class="p">)</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_version_</span> <span class="o">=</span> <span class="n">version</span>
    <span class="bp">cls</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
    <span class="bp">cls</span><span class="o">.</span><span class="n">CacheKey</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">if</span> <span class="n">cache_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">CACHE_PATH</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># cache disabled</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">cache_path</span> <span class="ow">or</span> <span class="n">CACHE_PATH</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="whatrecord.cache.InlineCached" class="doc doc-heading">
        <code>
whatrecord.cache.InlineCached            (<span title="whatrecord.cache._Cached">_Cached</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>A generic dataclass that can be cached in <code>WHATRECORD_CACHE_PATH</code>.</p>
<p>Expects to be subclassed and mixed in with a CacheKey subclass.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/cache.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">InlineCached</span><span class="p">(</span><span class="n">_Cached</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic dataclass that can be cached in ``WHATRECORD_CACHE_PATH``.</span>

<span class="sd">    Expects to be subclassed and mixed in with a CacheKey subclass.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">cache_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">for</span> <span class="n">supercls</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">supercls</span><span class="p">,</span> <span class="n">CacheKey</span><span class="p">)</span> <span class="ow">and</span> <span class="n">supercls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">CacheKey</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">CacheKey</span> <span class="o">=</span> <span class="n">supercls</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> should be defined as a subclass of a CacheKey&quot;</span>
            <span class="p">)</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_version_</span> <span class="o">=</span> <span class="n">version</span>
        <span class="k">if</span> <span class="n">cache_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">CACHE_PATH</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># cache disabled</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">cache_path</span> <span class="ow">or</span> <span class="n">CACHE_PATH</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CacheKey</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;An auto-generated CacheKey based on this dataclass&#39;s attributes.&quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CacheKey</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CacheKey</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">




<h6 id="whatrecord.cache.InlineCached-attributes">Attributes</h6>

  <div class="doc doc-object doc-attribute">



<h7 id="whatrecord.cache.InlineCached.key" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">InlineCached</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">CacheKey</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>An auto-generated CacheKey based on this dataclass's attributes.</p>
    </div>

  </div>




<h6 id="whatrecord.cache.InlineCached-methods">Methods</h6>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.cache.InlineCached.__init_subclass__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">InlineCached</span><span class="o">.</span><span class="n">__init_subclass__</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cache_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h7>

    <div class="doc doc-contents ">

      <p>This method is called when a class is subclassed.</p>
<p>The default implementation does nothing. It may be
overridden to extend subclasses.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/cache.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">cache_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">for</span> <span class="n">supercls</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">supercls</span><span class="p">,</span> <span class="n">CacheKey</span><span class="p">)</span> <span class="ow">and</span> <span class="n">supercls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">CacheKey</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">CacheKey</span> <span class="o">=</span> <span class="n">supercls</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> should be defined as a subclass of a CacheKey&quot;</span>
        <span class="p">)</span>

    <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_version_</span> <span class="o">=</span> <span class="n">version</span>
    <span class="k">if</span> <span class="n">cache_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">CACHE_PATH</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># cache disabled</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_cache_path_</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">cache_path</span> <span class="ow">or</span> <span class="n">CACHE_PATH</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.format" class="doc doc-heading">
        <code>whatrecord.format</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">







<h4 id="whatrecord.format-classes">Classes</h4>

  <div class="doc doc-object doc-class">



<h5 id="whatrecord.format.FormatContext" class="doc doc-heading">
        <code>
whatrecord.format.FormatContext        </code>



</h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>whatrecord/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FormatContext</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">helpers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">trim_blocks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lstrip_blocks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">default_options</span><span class="o">=</span><span class="s2">&quot;console&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">env_kwargs</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span> <span class="o">=</span> <span class="n">helpers</span> <span class="ow">or</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">locals</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_options</span> <span class="o">=</span> <span class="n">default_options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_template_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">Environment</span><span class="p">(</span>
            <span class="n">loader</span><span class="o">=</span><span class="n">jinja2</span><span class="o">.</span><span class="n">DictLoader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_template_dict</span><span class="p">),</span>
            <span class="n">trim_blocks</span><span class="o">=</span><span class="n">trim_blocks</span><span class="p">,</span>
            <span class="n">lstrip_blocks</span><span class="o">=</span><span class="n">lstrip_blocks</span><span class="p">,</span>
            <span class="o">**</span><span class="n">env_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_filters</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_render_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_render_context</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_formats</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">get_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">user_config</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;All jinja filters.&quot;&quot;&quot;</span>

        <span class="nd">@pass_eval_context</span>
        <span class="k">def</span> <span class="nf">title_fill</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fill_char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fill_char</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="nd">@pass_eval_context</span>
        <span class="k">def</span> <span class="nf">classname</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="nd">@pass_eval_context</span>
        <span class="k">def</span> <span class="nf">render_object</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">render_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
        <span class="c1"># TODO: want this to be positional-only; fallback here for pypy</span>
        <span class="n">template</span> <span class="o">=</span> <span class="n">_template</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_render_context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;render_ctx&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="n">template</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_render_object_fallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_obj</span><span class="p">,</span> <span class="n">_option</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
        <span class="c1"># TODO: want this to be positional-only; fallback here for pypy</span>
        <span class="n">obj</span><span class="p">,</span> <span class="n">option</span> <span class="o">=</span> <span class="n">_obj</span><span class="p">,</span> <span class="n">_option</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Sequence</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj_idx</span><span class="p">,</span> <span class="n">LoadContext</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj_idx</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">):</span>
                <span class="c1"># Special-case FullLoadContext</span>
                <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span> <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">)</span>

            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]: &quot;</span> <span class="o">+</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">obj_idx</span><span class="p">,</span> <span class="n">_option</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">),</span>
                    <span class="s1">&#39;    &#39;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">obj_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Mapping</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&quot;: &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_option</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">cls</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_formats</span><span class="p">:</span>
                <span class="c1"># TODO: lazy method here with &#39;fields&#39;</span>
                <span class="n">serialized</span> <span class="o">=</span> <span class="n">apischema</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">serialized</span>
                <span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_formats</span><span class="p">[</span><span class="bp">cls</span><span class="p">]</span> <span class="o">=</span> <span class="n">template_from_dataclass</span><span class="p">(</span>
                    <span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">option</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_options</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fallback_formats</span><span class="p">[</span><span class="bp">cls</span><span class="p">],</span>
                <span class="o">**</span><span class="n">context</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">render_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_obj</span><span class="p">,</span> <span class="n">_option</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
        <span class="c1"># TODO: want this to be positional-only; fallback here for pypy</span>
        <span class="n">obj</span><span class="p">,</span> <span class="n">option</span> <span class="o">=</span> <span class="n">_obj</span><span class="p">,</span> <span class="n">_option</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_options</span>

        <span class="k">if</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">is_dataclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">fields</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
                <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;obj&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_jinja_format_</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="o">...</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_render_object_fallback</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Jinja template context dictionary - helper functions.&quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="n">func</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">context</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







<h6 id="whatrecord.format.FormatContext-methods">Methods</h6>


  <div class="doc doc-object doc-method">



<h7 id="whatrecord.format.FormatContext.get_filters" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">FormatContext</span><span class="o">.</span><span class="n">get_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">user_config</span><span class="p">)</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>All jinja filters.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_filters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">user_config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;All jinja filters.&quot;&quot;&quot;</span>

    <span class="nd">@pass_eval_context</span>
    <span class="k">def</span> <span class="nf">title_fill</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">fill_char</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fill_char</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="nd">@pass_eval_context</span>
    <span class="k">def</span> <span class="nf">classname</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="nd">@pass_eval_context</span>
    <span class="k">def</span> <span class="nf">render_object</span><span class="p">(</span><span class="n">eval_ctx</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">render_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="whatrecord.format.FormatContext.get_render_context" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">FormatContext</span><span class="o">.</span><span class="n">get_render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>


</h7>

    <div class="doc doc-contents ">

      <p>Jinja template context dictionary - helper functions.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_render_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Jinja template context dictionary - helper functions.&quot;&quot;&quot;</span>
    <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span> <span class="n">func</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">helpers</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">context</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>


<h4 id="whatrecord.format-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.format.template_from_dataclass" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">template_from_dataclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">render_option</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Generate a console-friendly render template from a dataclass.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/format.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">template_from_dataclass</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">render_option</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a console-friendly render template from a dataclass.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="n">name_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">)</span>
    <span class="n">field_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="s2">&quot;{</span><span class="si">% i</span><span class="s2">f &quot;</span> <span class="o">+</span> <span class="n">field</span> <span class="o">+</span> <span class="s2">&quot; | string | length &gt; 0 %}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span>
        <span class="n">field</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="n">name_length</span><span class="p">)</span> <span class="o">+</span>
        <span class="s2">&quot;: {</span><span class="si">% s</span><span class="s2">et field_text = render_object(&quot;</span> <span class="o">+</span> <span class="n">field</span> <span class="o">+</span> <span class="s2">&quot;, render_option) %}&quot;</span>
        <span class="s2">&quot;{{ field_text | indent(name_length + 2) }}&quot;</span>
        <span class="s2">&quot;{</span><span class="si">% e</span><span class="s2">ndif %}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">% set name_length = </span><span class="si">{</span><span class="n">name_length</span><span class="si">}</span><span class="s2"> %</span><span class="se">}}\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2">% set render_option = </span><span class="si">{</span><span class="n">render_option</span><span class="si">}</span><span class="s2"> %</span><span class="se">}}\n</span><span class="s2">&quot;</span>
        <span class="o">+</span> <span class="n">field_text</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.graphql" class="doc doc-heading">
        <code>whatrecord.graphql</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.settings" class="doc doc-heading">
        <code>whatrecord.settings</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">





















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="whatrecord.util" class="doc doc-heading">
        <code>whatrecord.util</code>



</h3>

    <div class="doc doc-contents first">




  <div class="doc doc-children">










<h4 id="whatrecord.util-functions">Functions</h4>

  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.check_files_up_to_date" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">check_files_up_to_date</span><span class="p">(</span><span class="n">file_to_hash</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Check if the provided files are up-to-date by way of recorded hash vs</p>
<p>current hash.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>file_to_hash</code></td>
        <td><code>Dict[Union[str, pathlib.Path], str]</code></td>
        <td><p>File path to hash.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>bool</code></td>
      <td><p>If all files maintain their stored hashes, returns True.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">check_files_up_to_date</span><span class="p">(</span>
    <span class="n">file_to_hash</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">AnyPath</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the provided files are up-to-date by way of recorded hash vs</span>
<span class="sd">    current hash.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    file_to_hash : Dict[Union[str, pathlib.Path], str]</span>
<span class="sd">        File path to hash.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    up_to_date : bool</span>
<span class="sd">        If all files maintain their stored hashes, returns True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">file_hash</span> <span class="ow">in</span> <span class="n">file_to_hash</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">get_file_sha256</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="o">!=</span> <span class="n">file_hash</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.find_binary_from_hashbang" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">find_binary_from_hashbang</span><span class="p">(</span><span class="n">startup_script</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">],</span> <span class="n">must_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Find the binary associated with a given startup script by looking at its</p>
<p>shebang.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[str]</code></td>
      <td><p>The path to the binary, if available.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">find_binary_from_hashbang</span><span class="p">(</span>
    <span class="n">startup_script</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]],</span>
    <span class="n">must_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the binary associated with a given startup script by looking at its</span>
<span class="sd">    shebang.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    binary_path : str or None</span>
<span class="sd">        The path to the binary, if available.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">startup_script</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">startup_script</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">first_line</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">first_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#!&quot;</span><span class="p">):</span>
        <span class="n">parent_dir</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">startup_script</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">binary</span> <span class="o">=</span> <span class="n">parent_dir</span> <span class="o">/</span> <span class="n">first_line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#!&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">must_exist</span> <span class="ow">or</span> <span class="n">binary</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">binary</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.get_bytes_sha256" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_bytes_sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Hash a byte string with the SHA-256 algorithm.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_bytes_sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hash a byte string with the SHA-256 algorithm.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.get_file_sha256" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_file_sha256</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">])</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Hash a binary with the SHA-256 algorithm.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_file_sha256</span><span class="p">(</span><span class="n">binary</span><span class="p">:</span> <span class="n">AnyPath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Hash a binary with the SHA-256 algorithm.&quot;&quot;&quot;</span>
    <span class="c1"># This doesn&#39;t do any sort of buffering; but our binaries are pretty small</span>
    <span class="c1"># in comparison to what we&#39;re storing as metadata, anyway</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.lines_between" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">lines_between</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">include_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>From a block of text, yield all lines between <code>start_marker</code> and</p>
<p><code>end_marker</code></p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>text</code></td>
        <td><code>str</code></td>
        <td><p>The block of text</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>start_marker</code></td>
        <td><code>str</code></td>
        <td><p>The block-starting marker to match</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>end_marker</code></td>
        <td><code>str</code></td>
        <td><p>The block-ending marker to match</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>include_blank</code></td>
        <td><code>bool</code></td>
        <td><p>Skip yielding blank lines</p></td>
        <td><code>False</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Generator[str, NoneType, NoneType]</code></td>
      <td><p>Line of text found between the markers.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lines_between</span><span class="p">(</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_marker</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">include_blank</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    From a block of text, yield all lines between `start_marker` and</span>
<span class="sd">    `end_marker`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The block of text</span>
<span class="sd">    start_marker : str</span>
<span class="sd">        The block-starting marker to match</span>
<span class="sd">    end_marker : str</span>
<span class="sd">        The block-ending marker to match</span>
<span class="sd">    include_blank : bool, optional</span>
<span class="sd">        Skip yielding blank lines</span>

<span class="sd">    Yields</span>
<span class="sd">    ------</span>
<span class="sd">    line : str</span>
<span class="sd">        Line of text found between the markers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">found_start</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">start_marker</span> <span class="o">=</span> <span class="n">start_marker</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">end_marker</span> <span class="o">=</span> <span class="n">end_marker</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
        <span class="n">line_lowercase</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line_lowercase</span> <span class="o">==</span> <span class="n">start_marker</span><span class="p">:</span>
            <span class="n">found_start</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">found_start</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line_lowercase</span> <span class="o">==</span> <span class="n">end_marker</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">line_lowercase</span> <span class="ow">or</span> <span class="n">include_blank</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">line</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.read_text_file_with_hash" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">read_text_file_with_hash</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;latin-1&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></code>


</h5>

    <div class="doc doc-contents ">

      <p>Hash a binary with the SHA-256 algorithm.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">read_text_file_with_hash</span><span class="p">(</span>
    <span class="n">fn</span><span class="p">:</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;latin-1&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Hash a binary with the SHA-256 algorithm.&quot;&quot;&quot;</span>
    <span class="c1"># This doesn&#39;t do any sort of buffering; but our binaries are pretty small</span>
    <span class="c1"># in comparison to what we&#39;re storing as metadata, anyway</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="n">contents</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">sha256</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">contents</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.run_gdb" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">run_gdb</span><span class="p">(</span><span class="n">script</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="bp">cls</span><span class="p">:</span> <span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdb_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">~</span><span class="n">T</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Run a script and deserialize its output.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>script</code></td>
        <td><code>str</code></td>
        <td><p>The script name to run (whatrecord.<strong>script</strong>, omitting .py)</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>binary</code></td>
        <td><code>Union[pathlib.Path, str]</code></td>
        <td><p>The binary file to load into GDB.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>cls</code></td>
        <td><code>~T</code></td>
        <td><p>The dataclass type to deserialize gdb's output to.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>args</code></td>
        <td><code>Optional[List[str]]</code></td>
        <td><p>List of string arguments to pass to gdb.</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>gdb_path</code></td>
        <td><code>Optional[str]</code></td>
        <td><p>The path to the gdb binary.  Defaults to <code>WHATRECORD_GDB_PATH</code>
from the environment (<code>gdb</code>).</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">run_gdb</span><span class="p">(</span>
    <span class="n">script</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">binary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="bp">cls</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">gdb_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_cache</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a script and deserialize its output.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    script : str</span>
<span class="sd">        The script name to run (whatrecord.__script__, omitting .py)</span>

<span class="sd">    binary : str or pathlib.Path</span>
<span class="sd">        The binary file to load into GDB.</span>

<span class="sd">    cls : type</span>
<span class="sd">        The dataclass type to deserialize gdb&#39;s output to.</span>

<span class="sd">    args : list, optional</span>
<span class="sd">        List of string arguments to pass to gdb.</span>

<span class="sd">    gdb_path : str, optional</span>
<span class="sd">        The path to the gdb binary.  Defaults to ``WHATRECORD_GDB_PATH``</span>
<span class="sd">        from the environment (``gdb``).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cache_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span><span class="p">)</span>
    <span class="n">binary_hash</span> <span class="o">=</span> <span class="n">get_file_sha256</span><span class="p">(</span><span class="n">binary</span><span class="p">)</span>

    <span class="n">hash_filename</span> <span class="o">=</span> <span class="n">cache_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">binary_hash</span><span class="si">}</span><span class="s2">.json&quot;</span>
    <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">settings</span><span class="o">.</span><span class="n">CACHE_PATH</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cache_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">use_cache</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hash_filename</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                <span class="o">...</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Failed to load cached gdb information from disk; &quot;</span>
                    <span class="s2">&quot;re-running gdb (</span><span class="si">%s</span><span class="s2">, filename=</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="n">ex</span><span class="p">,</span>
                    <span class="n">hash_filename</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&quot;&#39;</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="n">script_path</span> <span class="o">=</span> <span class="n">MODULE_PATH</span> <span class="o">/</span> <span class="s2">&quot;plugins&quot;</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script</span><span class="si">}</span><span class="s2">.py&quot;</span>
    <span class="n">gdb_path</span> <span class="o">=</span> <span class="n">gdb_path</span> <span class="ow">or</span> <span class="n">settings</span><span class="o">.</span><span class="n">GDB_PATH</span>
    <span class="n">to_execute</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">gdb_path</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
        <span class="sa">f</span><span class="s2">&quot;--batch-silent &quot;</span>
        <span class="sa">f</span><span class="s1">&#39;--command &quot;</span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;--args &quot;</span><span class="si">{</span><span class="n">binary</span><span class="si">}</span><span class="s1">&quot; </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="p">)</span>

    <span class="n">json_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_script_with_json_output</span><span class="p">(</span><span class="n">to_execute</span><span class="p">)</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">json_data</span> <span class="ow">or</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">hash_filename</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">apischema</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">json_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">ex</span><span class="o">.</span><span class="n">json_data</span> <span class="o">=</span> <span class="n">json_data</span>
        <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h5 id="whatrecord.util.run_script_with_json_output" class="doc doc-heading">
<code class="highlight language-python"><span class="n">whatrecord</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">run_script_with_json_output</span><span class="p">(</span><span class="n">script_line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">log_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-async"><code>async</code></small>
  </span>

</h5>

    <div class="doc doc-contents ">

      <p>Run a script and get its JSON output.</p>

        <details class="quote">
          <summary>Source code in <code>whatrecord/util.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">run_script_with_json_output</span><span class="p">(</span>
    <span class="n">script_line</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">encoding</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="n">log_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Run a script and get its JSON output.&quot;&quot;&quot;</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_shell</span><span class="p">(</span>
        <span class="n">script_line</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
    <span class="p">)</span>

    <span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">stderr</span> <span class="ow">and</span> <span class="n">log_errors</span><span class="p">:</span>
        <span class="n">stderr_text</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">indent</span><span class="p">(</span><span class="n">stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">),</span> <span class="s2">&quot;    ! &quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Standard error output while running script (</span><span class="si">%r</span><span class="s2">):</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">script_line</span><span class="p">,</span> <span class="n">stderr_text</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">stdout</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">stdout</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">log_errors</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;No standard output while running script (</span><span class="si">%r</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="n">script_line</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../plugins/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Plugins" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Plugins
            </div>
          </div>
        </a>
      
      
        
        <a href="../iocsh/" class="md-footer__link md-footer__link--next" aria-label="Next: IOC Shell-Related" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              IOC Shell-Related
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      (C) 2021 SLAC National Accelerator Laboratory
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.22074ed6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.01de222e.min.js"></script>
      
    
  </body>
</html>